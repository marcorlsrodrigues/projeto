ep.registerInstance("ep.controller.page.translation","ep.base.PageController",function(){function s(v,z,A,t){var x={id:v,url:z,srcLanguage:A,destLanguage:t,timer:null,endPoll:false};var y={id:v,startPolling:function(){x.pollTimer=window.setTimeout(u,2000);},stopPolling:function(){x.endPoll=true;}};function u(){var B=("JobId="+x.id).toQueryParams();B.RetrievalUrl=x.url;B.SourceLanguage=x.srcLanguage;B.DestinationLanguage=x.destLanguage;B.CacheBuster=new Date().getTime();jQuery.ajax({type:"GET",url:ep.utilities.replaceEPCommand("translation/poll"),data:B,complete:w});}function w(E){var C=jQuery.parseJSON(E.responseText);var B=C.Job;var D=C.Text;if(B.Status===0){if(y.onPoll){y.onPoll(y);}if(!x.endPoll){x.pollTimer=window.setTimeout(u,2000);}}else{if(B.Status===1){if(y.onComplete){y.onComplete(B,D,C);}}}}return y;}var d={button:null,parent:null,progress:null,progressInner:null,translated:null,ftContainer:null};var o;var e;var c;var b;var a;function k(){b+=100;c+=100;if(b<=e){d.progressInner.style.width=((b/e)*100)+"%";}}function m(){d.progressInner.style.width="0%";jQuery(d.progress).show();e=10000;b=0;c=0;if(o){window.clearInterval(o);}o=window.setInterval(k,100);}function n(){jQuery(d.progress).hide();if(o){window.clearInterval(o);o=null;}}function l(u){var t=jQuery(document.body).find(".full-text-container")[0];if(t){if(!d.parent){d.parent=t.parentNode;}if(d.translated){d.parent.removeChild(d.translated);d.translated=null;}jQuery(t).hide();}}function i(){g();f();jQuery(d.ftContainer).removeClass("translated");if(d.parent){jQuery(d.parent).find(".full-text-container").show();}n();if(d.translated){d.parent.removeChild(d.translated);d.translated=null;}d.button.disabled=false;}function j(t){}function h(t,w,u){jQuery(d.ftContainer).addClass("translated");n();var v=jQuery("<div/>");v.html(w);d.translated=v.find(".full-text-container")[0];d.parent.insertBefore(d.translated,jQuery(".content-footer")[0]||null);jQuery(d.translated).addClass("translation");d.button.disabled=false;if(u.ErrorMessage){r(u.ErrorMessage);}if(u.DisclaimerLine1){q(u.DisclaimerLine1,u.DisclaimerLine2,u.DisclaimerLine3);}ep.publish("ep_translationFinished",t);}function r(t){jQuery("#translationErrorMessage").html(t);jQuery("#translationErrorContainer").show();}function g(){jQuery("#translationErrorContainer").hide();}function q(t,u,v){jQuery("#translationDisclaimerLine1").html(t);jQuery("#translationDisclaimerLine2").html(u);jQuery("#translationDisclaimerLine3").html(v);jQuery("#translationDisclaimerContainer").show();}function f(){jQuery("#translationDisclaimerContainer").hide();}var p={translate:function(u){g();f();if(u==="English"){i();return;}d.button.disabled=true;var t=("language="+u).toQueryParams();t.CacheBuster=new Date().getTime();if(a){a.stopPolling();}l(u);m();jQuery.ajax({type:"GET",url:ep.utilities.replaceEPCommand("translation/translate"),data:t,dataType:"json",success:function(w){var v=w.Job;var x=w.Text;a=new s(v.JobId,v.RetrievalUrl,v.SourceLanguage,v.DestinationLanguage);a.Status=v.Status;if(a.Status===1){h(v,x,w);return;}e=v.EstimatedDuration+c;a.onComplete=h;a.onPoll=j;a.startPolling();}});},onDomLoad:function(){d.button=jQuery("#translateBtn")[0];d.progressInner=jQuery("#translationProgressBar")[0];d.progress=jQuery("#translationProgressContainer")[0];var t=jQuery("#transLanguage")[0];d.ftContainer=t.parentNode;if(d.button&&t){t.selectedIndex=0;jQuery(d.button).click(function(u){var v=t.selectedIndex;if(v===0){return;}ep.controller.page.translation.translate(t[v].value);});jQuery("#translateOriginal").click(i);}}};return p;}());