var ep = window.ep || {}; ep.bundles = ep.bundles || []; ep.bundles = ep.bundles.concat('bundled/epautocomplete.js','ep/widgets/epautocomplete/epautocomplete.js', 'ep/widgets/epautocomplete/epautocomplete-ehost.js');
(function(a){ep.require("ep/jqueryplugins/bididirfixer.js",function(){a.widget("ui.epautocomplete",{options:{data:{url:"autosuggest",termKey:"term",queryParams:{},massageData:false,searchOnSelect:false,highlightClass:null,truncateClass:"auto-complete-truncate",noWrapClass:"auto-complete-no-wrap",completions:{wrap:true,truncate:false,maxWidth:50},ajaxHandler:function(){},jQueryOverrides:{}}},_create:function(){var e=this,b=a(this.element),c=a.extend({},this.options.data),d=JSON.stringify;b.autocomplete(a.extend({source:function(f,g){c.queryParams[c.termKey]=f.term;a.each(c.queryParams,function(h,j){var i=this;if(a.isPlainObject(i)){c.queryParams[h]=d(i);}else{if(a.isArray(i)){c.queryParams[h]=d(i);}}});c.ajaxHandler.call(this,f,g,c.queryParams,function(i){var j=i.error;if(!j){e.curResponseData=i;if(c.massageData){var h=[];if(i.terms&&i.terms.length){if(c.displayGroups){a.each(c.displayGroups,function(n,m){var l=a.grep(i.terms,function(o){return m.idx===o.domain;});if(l&&l.length){l.unshift({domain:m.idx,fragments:null,score:0,term:m.title,isHeader:true});h=a.merge(h,l);}});}else{h=i.terms;}}var k=(function(){var l=[];if(i.terms&&i.terms.length){if(h&&h.length){l=a.map(h,function(m){return{value:m.term,fragments:m.fragments,domain:m.domain,isHeader:(m.isHeader)?true:false};});}else{l.push(i.terms.term);}}return l;})();g(k);}else{g(i);}}});},open:function(j,k){var g=a(this),f=g.autocomplete("widget"),i={},h=c.completions;f.find("a").bidiDirFixer();a(this).bidiDirFixer();i.minWidth=g.innerWidth();f.addClass(c.highlightClass);if(h.truncate){i.maxWidth=h.maxWidth+"%";}if(!h.wrap){i.width="auto";f.addClass(c.noWrapClass);}if(a('html[dir="rtl"]').length>0){i.left="auto";i.right=(a(window).width()-(g.offset().left+g.outerWidth()))+"px";}f.css(i);if(a.browser.msie&&parseInt(a.browser.version,10)<8){f.width(f.width());}a(window).on("resize",function(){f.css(i);});},close:function(f,g){a(this).autocomplete("widget").removeClass(c.highlightClass);},select:function(f,h){if(c.onSelectCallback&&e.curResponseData.terms){var g;g=_.find(e.curResponseData.terms,function(i){return(i.term===h.item.value);});if(g){c.onSelectCallback({term:g.term,domain:g.domain,metadata:g.metadata});}}if(c.searchOnSelect){b.val(h.item.value);a("[id$='SearchButton']").click();}}},c.jQueryOverrides));b.data("autocomplete")._renderItem=function(i,g){var h=function(l){var j=(c.completions.truncate)?c.truncateClass:"";var k=a("<li></li>").data("item.autocomplete",g);if(g.isHeader){k.addClass("autocomplete-heading color-p2").html(l);}else{k.append(a("<a class='"+j+"'></a>").html(l));}return k.appendTo(i);};if(c.massageData){var f=function(){var j=g.fragments,k="";if(j){a.each(j,function(){var l=(c.highlightClass)?'<strong class="'+c.highlightClass+'">':"<strong>";if(this.user===true){k+=l+this.text+"</strong>";}else{k+=this.text;}});}else{k=g.value;}return k;};return h(f());}else{return h(g.value);}};},_init:function(){},destroy:function(){a.Widget.prototype.destroy.call(this);}});});})(jQuery);(function(a){a(function(){ep.require("ep/widgets/epautocomplete/epautocomplete.js",function(){var d=8,c=10;function b(h,i){var g=a("[data-auto-complete]"),f=g.first().closest("form");g.each(function(){var k=a(this),j=(k.prop("tagName")==="INPUT")?k:k.find("input.auto-complete"),l;if(k.data("auto-complete")){l=a.extend(true,{},k.data("auto-complete"));if(h){l.queryParams.idx=h.queryParams.idx;}l.handlePrototype=true;l.ajaxHandler=function(o,p,n,m){a.get(l.url,n,function(q){m(q);},"json");};if(i){j.epautocomplete("destroy");}l.onSelectCallback=function(n){var m=ep.searchInfoDetails||{type:"ACT",details:[]},o=m.details.length,p={term:n.term,d:n.domain};if(n.metadata){_.each(n.metadata.split(","),function(r,q){p["m"+q]=_.escape(r);});}m.details[o]=p;ep.searchInfoDetails=m;};j.epautocomplete({data:l});k.data("auto-complete",l);}});}ep.subscribe("ep:autosuggest:limiter",function(g){var h=g.curSelected,f=ep.utilities.buildAjaxRequestPath("AutoComplete/GetSettings");if(h!==g.defaultId){a.ajax({url:f,data:{contentType:h},success:function(i){if(_.isString(i)){i=JSON.parse(i);}b(i,true);}});}else{b(null,true);}return false;});function e(){try{b();}catch(f){if(--d){setTimeout(e,c);c*=2;}}}e();});});})(jQuery);