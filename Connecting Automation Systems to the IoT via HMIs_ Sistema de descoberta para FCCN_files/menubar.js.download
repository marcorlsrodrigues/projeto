var KEY_SPACE=32;var KEY_INSERT=45;if(!ep.menu){ep.menu={};}ep.menu.InitializeMenubar=function(b){if((navigator.appName.toLowerCase().indexOf("explorer")!==-1)&&(navigator.userAgent.toLowerCase().indexOf("msie 6")!==-1)){ep.menu.isIE6=true;}var a=jQuery("#"+b);if(a.length){a.attr("role","menubar");a.find('span[class != "hidden"]').attr({"aria-haspop":"true",tabIndex:-1});a.find("dt").each(function(e,d){d=jQuery(d);var c=d.parent("dl").first();if(c[0]!==a[0]){c.attr("role","menu");d.addClass(ep.menu.isIE6?"bg1":"bar4 submenu-link");}d.attr("role","menuitem");d.mouseover(function(){d.addClass("mouse-over");});d.mouseout(function(){d.removeClass("mouse-over");});if(d.next().length&&d.next().is("DD")){d.mouseover(function(f){ep.menu.OpenMenu(f.currentTarget,f);});d.next().mouseleave(function(f){ep.menu.CloseMenu(f.currentTarget,f);});}});a.find("a").keydown(ep.menu.MenuItemAction);a.find("dt.submenu-heading span").keydown(ep.menu.MenuItemAction);a.find("dt.toolbar-link").keydown(ep.menu.ToolbarAction);a.find("dt.first-item").keydown(ep.menu.ToolbarAction);}};ep.menu.ToolbarAction=function(g){var c=g.which;var f=jQuery.ui.keyCode;var b=jQuery(g.target);if(!b.is("DT")){b=b.parent("dt").first();}var e=b.parent("dd").length;if(c===f.ENTER||c===f.SPACE||c===f.UP||c===f.DOWN){if(b.next().is("DD")){ep.menu.OpenMenu(b,g);}}else{if(c===f.LEFT||c===f.RIGHT){ep.menu.CloseMenu();g.preventDefault();var a;if(b.is("DT")){a=b;}else{a=b.parent("dt").first();}var d;if(c===f.LEFT){d=a.prev("dt");if(!d.length){d=a.parents("dl").first().children().last();if(!d.is("DT")){d=d.prev("dt");}}}else{d=a.next("dt");if(!d.length){d=a.parents("dl").first().children().first();}}if(d.length){d.children().first().focus();}}else{if(c===f.ESCAPE){if(ep.menu.activeMenu){jQuery(ep.menu.activeMenu).prev().children().first().focus();}ep.menu.CloseMenu();g.preventDefault();}}}};ep.menu.MenuItemAction=function(j){var b=j.which;var i=jQuery.ui.keyCode;var a=jQuery(j.target).parent("dt").first();if(b===i.RIGHT||b===i.SPACE){var d=a.next();if(b===i.RIGHT&&d.length&&d.is("DD")){ep.menu.OpenMenu(a,j);}else{var h;if(ep.menu.activeMenu){h=jQuery(ep.menu.activeMenu).prev();}else{if(b===i.RIGHT){h=a;}}var g=jQuery(h).next("dt");if(!g.length){g=h.parent().children().first();}if(g.length){g.children().first().focus();j.preventDefault();}ep.menu.CloseMenu();}}else{if(b===i.UP){var e=a.prev("dt");if(!e.length){e=a.parents("dl").first().children().last();if(!e.is("DT")){e=e.prev("dt");}}e.children().first().focus();j.preventDefault();}else{if(b===i.DOWN){var f=a.next("dt");if(!f.length){f=a.parents("dl").first().children().first();}f.children().first().focus();j.preventDefault();}else{if(b===i.ESCAPE||b===i.LEFT){if(ep.menu.activeMenu&&ep.menu.activeMenu.activeSubMenu){jQuery(ep.menu.activeMenu.activeSubMenu).prev("dt").children().first().focus();jQuery(ep.menu.activeMenu.activeSubMenu).hide();ep.menu.activeMenu.activeSubMenu=null;}else{var c;if(ep.menu.activeMenu){c=jQuery(ep.menu.activeMenu).prev("dt");ep.menu.CloseMenu();}else{c=a;}if(b===i.LEFT){if(c.prev("dt").length){c=c.prev("dt");}else{c=a.parents("dl").first().children().last();if(!c.is("DT")){c=c.prev("dt");}}}c.children().first().focus();}j.preventDefault();}}}}};ep.menu.CancelClose=function(){ep.menu.ignoreClose=true;};ep.menu.CloseMenu=function(){if(!ep.menu.ignoreClose){if(ep.menu.activeMenu){if(ep.menu.activeMenu.activeSubMenu){if(ep.menu.isIE6){ep.menu.cleanupIE6fix(ep.menu.activeMenu.activeSubMenu);}jQuery(ep.menu.activeMenu.activeSubMenu).hide();ep.menu.activeMenu.activeSubMenu=null;}if(ep.menu.isIE6){ep.menu.cleanupIE6fix(ep.menu.activeMenu);}jQuery(ep.menu.activeMenu).hide();ep.menu.activeMenu=null;}jQuery(document.body).unbind("click",ep.menu.CloseMenu);}else{ep.menu.ignoreClose=false;}};ep.menu.OpenMenu=function(i,j){i=jQuery(i);var f=i.next();if(ep.menu.activeMenu&&i.parents().index(ep.menu.activeMenu)>=0){if(ep.menu.activeMenu.activeSubMenu){if(ep.menu.isIE6){ep.menu.cleanupIE6fix(ep.menu.activeMenu.activeSubMenu);}jQuery(ep.menu.activeMenu.activeSubMenu).hide();}ep.menu.activeMenu.activeSubMenu=f[0];var b=i.position();f.css({position:"absolute",top:b.top+"px",left:i.width()+1+"px"});if(ep.menu.isIE6){ep.menu.ApplyIE6MenuFix(f);}}else{if(ep.menu.activeMenu){jQuery(ep.menu.activeMenu).hide();if(ep.menu.activeMenu.activeSubMenu){if(ep.menu.isIE6){ep.menu.cleanupIE6fix(ep.menu.activeMenu.activeSubMenu);}jQuery(ep.menu.activeMenu.activeSubMenu).hide();}}ep.menu.activeMenu=f[0];var c=i.position();var d=c.left;var l=f.width();if(jQuery("#LanguageMenubar").length&&i.parents().index("LanguageMenubar")>=0){var m=c.left;var n=m+i.width();d=Math.floor(n-((n-m)/2)-(l/3));var a=jQuery("#outer-container, #outerContainer").first();if(a.length){var g=a.find(".toolbar").first();var h=g.width();var k=jQuery(window).width();var e=Math.max(k,h);if(e<(d+l)){d=e-l-5;}}}f.css({position:"absolute",top:c.top+i.height()+4+"px",left:d+"px"});if(ep.menu.isIE6){ep.menu.ApplyIE6MenuFix(f);}}f.show();f.click(ep.menu.CancelClose);jQuery(document.body).click(ep.menu.CloseMenu);if(j){j.preventDefault();f.children("dt *").first().focus();}return false;};ep.menu.ApplyIE6MenuFix=function(f){ep.ie6SelectFix();var a="menuIEFix";if(jQuery(f).parents("dd[@role='menu']").length){a+="_sub";}var d=jQuery("#"+a);var c=f.getDimensions();var e=jQuery(f).offset();if(!d.length){d=jQuery("<iframe/>").attr({id:a,scrolling:"no",frameBorder:"0"});var b=jQuery("#SearchNavigationMenubar, #LanguageMenubar");if(b.length){b.append(d);}}d.css({position:"absolute",width:c.width+2+"px",height:c.height+2+"px",top:e.top+"px",left:e.left+"px"});};ep.menu.cleanupIE6fix=function(c){ep.ie6SelectFix(true);var a="menuIEFix";if(c.parents("dd[@role='menu']").length){a+="_sub";}var b=jQuery("#"+a);if(b.length){b.remove();b=null;}};ep.menu.OnResize=function(){var a=jQuery("#outer-container");if(!a.length){return;}aMenuWidth=ep.menu.getMenuWidth(a);if(!aMenuWidth){return;}var f=jQuery(document).width();var e=a.find(".toolbar").first();var c=a.find(".find-field-simple").first();var b=0;if(c.length){b=c.width();}var d=Math.max(b,aMenuWidth);if(d>f){e.width(d+10);}else{e.css({width:"100%"});}};ep.menu.getMenuWidth=function(a){var b=0;jQuery(a).find(".toolbar li, .authorities-menu-bar").each(function(){if(jQuery(this).css("display")==="block"){b=b+jQuery("#SearchNavigationMenubar").width();}else{b=b+jQuery(this).width();}});return b;};ep.menu.init=function(){var a=jQuery("#SearchNavigationMenubar, #LanguageMenubar");if(a.length){ep.menu.InitializeMenubar("SearchNavigationMenubar");}if((a.length>1)||(a.selector.search("#LanguageMenubar"))){ep.menu.InitializeMenubar("LanguageMenubar");}jQuery(window).resize(ep.menu.OnResize);};ep.domLoad(ep.menu.init);(function(a){a(function(){a("body").delegate("dt.toolbar-link a[data-json],dt.submenu-link a[data-json]",{click:function(c){b.navigateToStartPageWithToolbar(c);},keypress:function(c){if(c.keyCode==="13"){b.navigateToStartPageWithToolbar(c);}}});});var b=function(){return{navigateToStartPageWithToolbar:function(e){var c=a(e.currentTarget).data("json");var d=ep.utilities.buildAjaxRequestPath("search/basic")+"&tid="+c.tid+"&sdb="+c.sdb;window.location.href=d;e.preventDefault();}};}();})(jQuery);