function racemeTooltip(t,i){this.rootsvg=t,this.tooltip=(new Grape).addClass("viz_tooltip"),this._settings=i||{},this.tooltip_tx=new Grape,this.tooltip_bg=new Grape,this._opacity_tooltip=1,"number"==typeof this._settings.tooltip_alpha&&this._settings.tooltip_alpha>=0&&this._settings.tooltip_alpha<=1&&(this._opacity_tooltip=this._settings.tooltip_alpha),this._color_text="rgb(245,246,247)",this._background_color="rgb(65,67,68)",raceme._getRGB(this._settings.tooltip_background_color)!==!1&&(this._background_color=this._settings.tooltip_background_color),this._opacity_tooltip<.4&&(this._color_text="rgb(20,20,20)"),this._tooltip_align="left",!this._settings.tooltip_align||"left"!=this._settings.tooltip_align&&"right"!=this._settings.tooltip_align&&"center"!=this._settings.tooltip_align||(this._tooltip_align=this._settings.tooltip_align),this.tooltip.hide().enableEvents(!1).addChild(this.tooltip_bg).addChild(this.tooltip_tx),this.rootsvg.addChild(this.tooltip),this.targetGrape=null,this.texttooltip="";var o=this.rootsvg.by("title"),e=this;o.each(function(){var t=this.text();this.getParent().addClass("tooltipeable"),this.getParent().mouseover(function(i){this.by("title").remove(),e._show(this,t)})})}racemeTooltip.fn=racemeTooltip.prototype,racemeTooltip.fn.update=function(){this.targetGrape&&this.tooltip.opacity()>0&&this._show(this.targetGrape,this.texttooltip,!0)},racemeTooltip.fn._show=function(t,i,o){var e=this;if(this.targetGrape=t,"undefined"==typeof o&&(o=!1),this.texttooltip=i,this.tooltip.attr("opacity",0),this.tooltip.show(),i=raceme.defaultValue(i,""),""!=raceme._clearString(i)){var s=5;this.tooltip_tx.clear(),this.tooltip_tx.label(i,0,0,this._color_text,15,this._tooltip_align,"top"),0==o&&t.mouseout(function(t){"hidden"!=this.style("visibility")&&(e.tooltip.stop(),e.tooltip.hide(),e.tooltip.opacity(0),this.removeEvent("mouseout"))});var h=150,l=this.tooltip_tx.getBBox(),a={};if("path"==t.tagName())if(a.width=0,a.height=0,h=0,t.hasAttr("data-center-x")){var n=t.point(t.attr("data-center-x"),t.attr("data-center-y"));centerx=n.x,centery=n.y}else{var r=t.getPolygon().centroid();centerx=r.x,centery=r.y}else a=t.getBBox(),centerx=t.point().x+a.width/2,t._is_invisible||t._is_filled_rectangle?centery=t.point().y+a.height/2:centery=t.point().y;var p=this.rootsvg.viewbox(),_=centerx,g=p.width-centerx;if(_>2*s&&g>2*s){this.tooltip_tx.x(centerx),this.tooltip_bg.clear(),this.tooltip_bg.x(centerx).y(centery);var c=!1,x=this._drawBox(this.tooltip_bg,l.width+30,l.height+15,s,c,_,g);if(this.tooltip_tx.x(this.tooltip_tx.x()-x),centery-l.height-4*s<p.y?(c=!0,this.tooltip_bg.clear(),this._drawBox(this.tooltip_bg,l.width+30,l.height+15,s,c,_,g),t._is_invisible||t._is_filled_rectangle||t._ishiddenbar||(centery+=a.height),centery+l.height+30+s>p.y+p.height&&(centery-=a.height/2),this.tooltip_bg.y(parseInt(centery+(l.height+25)/2)),this.tooltip_tx.y(parseInt(centery+(2*s+13)))):(this.tooltip_bg.y(parseInt(centery-(l.height+25)/2)),this.tooltip_tx.y(parseInt(centery-s/2-this.tooltip_tx.getBBox().height))),"left"==this._tooltip_align||-1!=i.indexOf("|")?this.tooltip_tx.x(this.tooltip_tx.x()-l.width/2):"right"==this._tooltip_align&&this.tooltip_tx.x(this.tooltip_tx.x()+l.width/2),0==o){var d;d=0==c?0==h?-10:-16:0==h?10:16,this.tooltip.opacity(0).y(d).animate(200,h).ease("out").opacity(1).y(0)}}else this.tooltip.hide()}},racemeTooltip.fn._drawBox=function(t,i,o,e,s,h,l){var a=0;return i/2>h?a=h-i/2:i/2>l&&(a=-(l-i/2)),t.beginFill(this._background_color,this._opacity_tooltip).rect(-i/2-1-a,-o/2-1,i+2,o+2,2,2),t.lineStyle(0),0==s?t.beginPath().moveTo(0,o/2+e).lineTo(e,o/2).lineTo(-e,o/2).endPath(!0):t.beginPath().moveTo(0,-o/2-e).lineTo(e,-o/2).lineTo(-e,-o/2).endPath(!0),a};