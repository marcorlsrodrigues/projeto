ReadSpeaker.ui=function(){var g=null,q=[],D=[],J=!1,F=function(a){a=a||window.event;a.returnValue=!1;if(a=a.originalEvent){a.cancelBubble=!0,a.returnValue=!1;}a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation();},C=function(){rspkr.log("[rspkr.ui] Attempting to add click events.");var n=$rs.get("."+rspkr.ui.rsbtnClass+" .rsbtn_play"),e=null;$rs.isArray(n)||(n=[n]);for(var l=0,k=n.length;l<k;l++){if($rs.unregEvent(n[l],"click",ReadSpeakerDefer.clickhandler),e=n[l]?$rs.getAttr(n[l],"data-rsevent-id"):"_bogus_",rspkr.l.f.eq.store[e]&&rspkr.l.f.eq.store[e].click){rspkr.log("[rspkr.ui] Click event already existed on "+n[l],2);}else{$rs.regEvent(n[l],"click",function(a){F(a);window.readpage(this);});rspkr.ui.addFocusHandler(n[l],!0,n[l].parentNode);rspkr.log("[rspkr.ui] Added click event to: "+n[l],1);try{$rs.getAttr(n[l],"role")||$rs.setAttr(n[l],"role","button");}catch(m){rspkr.log("[rspkr.ui] Could not add role attribute.",2);}}}},h=function(){rspkr.log("[rspkr.ui] Initiating global callbacks");rspkr.ui.rsbtnClass=rspkr.cfg.item("ui.rsbtnClass")||"rsbtn";window.readpage=function(f,b){if(rspkr.ui.initrun){if(/ios|ipad|iphone|ipod|android|windows phone/i.test(window.navigator.userAgent)){var e=window.rspkr;e.audio=new Audio;e.audio.play();e.audio.pause();}rspkr.ui.showPlayer(f,b);}};window.rshlexit=function(b){rspkr.HL.chunking&&rspkr.HL.chunking.destroy();void 0!==b&&"false"!==b||g.stop();setTimeout(function(){rspkr.c.dispatchEvent("onAfterSyncExit",window);},1000);};window.rshlinit=E().sync.init;window.rshlsetContent=E().sync.setContent;window.rshlsetId=E().sync.setId;window.rshlsync=function(l,e){for(var k=l.split(","),f=e.split(","),m=0,n=l.length;m<n;m++){E().sync.execute(k[m],f[m]);}};window.rshlcontinue=function(){function l(r){if(!rspkr.HL.chunking.entracte.src){r=encodeURIComponent(decodeURIComponent(rs.cfg.getPhrase(r)));var m={noads:1},p;for(p in rspkr.c.data.params){rspkr.c.data.params.hasOwnProperty(p)&&(m[p]=rspkr.c.data.params[p]);}p=rspkr.Common.data.selectedText;var n=rspkr.Common.data.selectedHTML;rspkr.Common.data.selectedText=r;rspkr.Common.data.selectedHTML="";m.text=r;m.output="audio";r=rspkr.c.buildReadSpeakerCall(m);rspkr.HL.chunking.entracte.src=r;rspkr.Common.data.selectedText=p;rspkr.Common.data.selectedHTML=n;}rspkr.HL.chunking.entracte.volume=parseFloat((rspkr.st.get("hlvol")||100)/100);rspkr.HL.chunking.entracte.play();}if(rspkr.HL.chunking){rspkr.log("[rspkr.ui.rshlcontinue]");rspkr.HL.chunking.chunkEnded=!0;var e=$rs.get("#sync"+rspkr.HL.html5.synclist[rspkr.HL.html5.synclist.length-1][2]);$rs.isArray(e)&&!e.length?(e=0,document.body&&document.body.scrollTop?e=document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop?e=document.documentElement.scrollTop:window.pageYOffset&&(e=window.pageYOffset),e={left:rs.ui.viewport.width/2,top:rs.ui.viewport.height/2+e}):e=$rs.offset(e);if(rspkr.HL.chunking.continueHref){var k=rspkr.cfg.item("cb.chunking.pause",void 0,!0);if(-1==rspkr.HL.chunking.continueTime){if(rspkr.log("[rspkr.ui.rshlcontinue] Waiting for user interaction"),rs.ui.getActivePlayer().pause(),$rs.addClass(rspkr.ui.getActivePlayer().getContainer(),"rsautopaused"),l("chunkcontinue"),k&&"function"==typeof k){rspkr.log("[rspkr.ui.rshlcontinue] Running custom callback",3),k();}else{rspkr.log("[rspkr.ui.rshlcontinue] Showing default continue button");k=document.createElement("div");k.innerHTML=rspkr.cfg.item("ui.popupbutton").join("");$rs.addClass(k,rspkr.ui.rsbtnClass+" rspopup rsresume");var f=$rs.findIn(k,"a");f.removeAttribute("href");$rs.regEvent(f,"click",function(){rspkr.c.dispatchEvent("onChunkResume",window);});$rs.findIn(f,".rsbtn_text").innerHTML="<span>"+rs.cfg.getPhrase("chunkbutton")+"</span>";document.body.appendChild(k);k.style.display="block";e.left+=15;f=e.left+$rs.width(k)-$rs.width(window);0<f&&(e.left-=f);k.style.left=e.left+"px";k.style.top=e.top+15+"px";}}else{0==rspkr.HL.chunking.continueTime?(rspkr.log("[rspkr.ui.rshlcontinue] Autoplay"),rspkr.c.dispatchEvent("onChunkResume",window)):isNaN(rspkr.HL.chunking.continueTime)?rspkr.log("[rshlcontinue] Invalid time parameter!",3):(rspkr.log("[rspkr.ui.rshlcontinue] Autoplay with "+rspkr.HL.chunking.continueTime+" seconds delay"),5<=rspkr.HL.chunking.continueTime&&l("chunkwait"),k&&"function"==typeof k&&k(rspkr.HL.chunking.continueTime),rspkr.HL.chunking.stall=!0,setTimeout(function(){rspkr.HL.chunking.stall=!1;},1000*rspkr.HL.chunking.continueTime),rspkr.HL.chunking.timer=setTimeout(function(){rspkr.c.dispatchEvent("onChunkResume",window);},1000*rspkr.HL.chunking.continueTime));}}else{rspkr.log("[rshlcontinue] No continue href found!");}}};var a=rspkr.c.data.browser;a&&(/iphone|ipad|ios|android|windows phone/i.test(a.OS)||"android"==a.name.toLowerCase())?($rs.regEvent(document.body,"touchstart",function(b){rspkr.ui.setPointerPos(b);return !0;}),$rs.regEvent(document.body,"touchend",function(b){rspkr.ui.setPointerPos(b);rspkr.c.data.setSelectedText(b);return !0;}),$rs.regEvent(document,"selectionchange",function(b){rspkr.c.data.setSelectedText(b);return !0;})):($rs.regEvent(document.body,"mousedown",function(b){rspkr.ui.setPointerPos(b);return !0;}),$rs.regEvent(document.body,"mouseup",function(b){"opera"===a.name.toLowerCase()?setTimeout(function(){rspkr.c.data.setSelectedText(b);},50):rspkr.c.data.setSelectedText(b);return !0;}),$rs.regEvent(window,"mouseup",function(b){"opera"===a.name.toLowerCase()?setTimeout(function(){rspkr.c.data.setSelectedText(b);},50):rspkr.c.data.setSelectedText(b);return !0;}),$rs.regEvent(document.body,"keydown",rspkr.ui.setPointerPos),$rs.regEvent(document.body,"keyup",function(b){rspkr.c.data.setSelectedText(b);return !0;}));},I=function(){document.removeEventListener?document.removeEventListener("click",window.ReadSpeakerDefer.clickhandler,!1):document.detachEvent&&document.detachEvent("onclick",window.ReadSpeakerDefer.clickhandler);if(ReadSpeakerDefer.deferred){var c=ReadSpeakerDefer.deferred,b=null;if("a"!=c.tagName.toLowerCase()){for(b=c;"body"!=b.tagName.toLowerCase()&&(b=b.parentNode,"a"!=b.tagName.toLowerCase());){}c=b;}ReadSpeakerDefer.isRSLink(c)&&(rspkr.log("[rspkr.ui] Activating deferred element: "+c),$rs.removeClass(c.parentNode,"rsdeferred"),rspkr.ui.showPlayer(c));ReadSpeakerDefer.deferred=null;}},G=null,o=function(){G&&$rs.isVisible(G)&&(rspkr.log("[rspkr.ui.updateFocus] "+G.outerHTML),H(G));},H=function(a){$rs.focus&&"function"==typeof $rs.focus&&a&&$rs.focus(a);},j=function(c){if("iconon"==rspkr.st.get("hlicon")&&!J){var b=D.push(new z)-1;D[b].id=b;D[b].show(c);J=!0;}},i=function(){"iconon"==rspkr.st.get("hlicon")&&J&&(D.pop().hide(),J=!1);},z=function(){var p=0,v=0,t=null,y=52,w=null,K=null,P=null,M=function(b){b=b||t;$rs.addClass(b,rspkr.ui.rsbtnClass+" rspopup");rspkr.cfg.item("general.useCompactPopupButton")&&$rs.addClass(b,"rscompact");},A=function(b){$rs.unregEvent(t,"mouseout",L);window.clearTimeout(w);var l,e=t.clientWidth+10,k;K=rspkr.ui.showPlayer(P,t,!0);k=K.getWidth();l=parseInt($rs.offset(t).left);(l=rspkr.ui.viewport.width+$rs.scrollLeft(document)-l)<k&&(l=parseInt($rs.css(t,"left"))-(k-(e-10)),$rs.css(t,"left",l+"px"));J=!1;$rs.unregEvent(P,"click",A);$rs.regEvent(P,"click",function(c){F(c);return K.restart();});F(b);return !1;},L=function(){w||(w=window.setTimeout(function(){Q();},rspkr.cfg.item("general.popupCloseTime")||2000));},N=function(){w&&(window.clearTimeout(w),w=null);},O=function(b,c){var e=document.body.getBoundingClientRect();$rs.css(t,{top:c-e.top+"px",left:b-e.left+"px",width:y+"px"});},Q=function(){$rs.css(t,{display:"none",top:0,left:0});N();D.splice(null,1);J=!1;t.parentElement.removeChild(t);},R=rspkr.c.findFirstRSButton(),t=document.createElement("div");t.id=rspkr.getID();t.innerHTML=rspkr.cfg.item("ui.popupbutton").join("");M();P=$rs.findIn(t,".rsbtn_play");$rs.setAttr(P,"href",R?$rs.getAttr(R,"href"):null);(R=rspkr.cfg.item("general.popupHref"))&&$rs.setAttr(P,"href",R);var R=$rs.getAttr(P,"href").match(/lang=([^&;]*)/i).pop(),u=$rs.findIn($rs.get(t),".rsbtn_play span.rsbtn_text span");u&&(u.textContent=u.innerText=rspkr.cfg.getPhrase("listen",R,"en_us"));$rs.setAttr(P,"title",rspkr.cfg.getPhrase("listentoselectedtext",R,"en_us"));$rs.regEvent(P,"click",A);document.body.appendChild(t);return{setPos:O,show:function(a){N(a);if(a&&"none"==$rs.css(t,"display")){var b=t.cloneNode(!0);b.id=rspkr.getID();$rs.css(b,{display:"block",position:"absolute",top:0,left:0});document.body.appendChild(b);y=$rs.outerWidth(b)+3;document.body.removeChild(b);b=a.clientX||a.pageX||rspkr.ui.pointerX;a=a.clientY||a.pageY||rspkr.ui.pointerY;v=a>rspkr.ui.pointerY?a-$rs.scrollTop(document)+36>rspkr.ui.viewport.height-46?a-66:a+30:10>a-$rs.scrollTop(document)-66?a+30:a-51;p=10>b-$rs.scrollLeft(document)?b+10:b-$rs.scrollLeft(document)>rspkr.ui.viewport.width-(y+10)?rspkr.ui.viewport.width+$rs.scrollLeft(document)-(y+10):b+0;O(p,v);}$rs.regEvent(t,"mouseout",L);$rs.regEvent(t,"mouseover",N);L(null);M();$rs.css(t,"display","block");},hide:Q,id:null};},x={update:function(f,e,a){"hlspeed"===f&&e!==a&&(f=f.replace("hl",""),rspkr.c.converter[f]&&"function"==typeof rspkr.c.converter[f]&&(e=rspkr.c.converter[f](e)),rspkr.c.data[f]=e,g&&g.stop(),rspkr.pl.releaseAdapter());}},B=function(k,m,l,p,n,r){$rs.css(k,"background-color","rgb("+m+","+l+","+p+")");p<n?(p+=10,window.setTimeout(function(){B(k,m,l,p,n,r);},50)):r&&"function"===typeof r&&r.apply(k,[]);},E=function(){return rspkr.XP?rspkr.XP:rspkr.HL;};_expand=function(b){"string"==typeof b&&(b=$rs.get(b));$rs.isArray(b)||(b=[b]);for(var e=0;e<b.length;e++){rspkr.ui.Player(b[e]).show(!0);}};_animate=function(){var k=rs.cfg.item("ui.animate");if(k){var m,l=15,p=500;"object"==typeof k?(k.id&&(m=$rs.get(k.id)),k.count&&(l=k.count),k.interval&&(p=k.interval)):"string"===typeof k&&(m=$rs.get(k));if("boolean"===typeof k&&k||$rs.isArray(m)&&0==m.length||!m){m=$rs.get("."+rs.ui.rsbtnClass);}$rs.isArray(m)||(m=[m]);var n=l,r=setInterval(function(){0==n&&($rs.removeClass(m,"rsanimate"),clearInterval(r));1==n--%2?$rs.addClass(m,"rsanimate"):$rs.removeClass(m,"rsanimate");},p);}};return{meta:{revision:"3975"},initrun:!1,init:function(){var b=rspkr.Common.addEvent;b("onAfterModsLoaded",h);b("onReady",C);b("onReady",I);b("onReady",_animate);b("onSelectedText",j);b("onDeselectedText",i);b("onSettingsChanged",x.update);b("onAfterSyncInit",o);this.initrun=!0;rspkr.Common.dispatchEvent("onUIInitialized");rspkr.log("[rspkr.ui] Initialized!");},addFocusHandler:function(k,m,l){var p=m,n=l,n=n||k;void 0===p&&(p=!0);$rs.focusIn&&"function"==typeof $rs.focusIn&&($rs.focusIn(k,function(){$rs.addClass(n,"rsfocus");!0===p&&(G=k);rspkr.Common.dispatchEvent("onFocusIn",window,[k,n]);}),$rs.focusOut(k,function(){$rs.removeClass(n,"rsfocus");rspkr.Common.dispatchEvent("onFocusOut",window,[k,n]);}));},focus:function(b){H(b);},updateFocus:function(){o();},showOverlay:function(k,a){var n=k,m;m=a||g.getContainer();var r=$rs.findIn(m,".rsbtn_status");0===r.length&&(r=document.createElement("span"),r.className="rsbtn_status_overlay",r.innerHTML='<span class="rsbtn_status"></span>',$rs.findIn(m,".rsbtn_exp").appendChild(r),r=$rs.findIn(m,".rsbtn_status"));$rs.css($rs.findIn(m,".rsbtn_status_overlay"),"display","block");if("nosound"===n){n='<a class="rsbtn_nosound">'+rspkr.cfg.getPhrase("nosound")+"</a>",r.innerHTML=n,(n=$rs.findIn(m,".rsbtn_nosound"))&&$rs.regEvent(n,"click",function(){return g.nosound();});}else{if("loaderror"===n){var n=rspkr.c.data.getSaveData("link"),p=document.createElement("a");p.className="rsbtn_loaderror";p.innerHTML="[?]";p.href=n;$rs.regEvent(p,"click",function(b){rspkr.ui.Lightbox.show("<iframe src='"+p.href+"' style='height:100%'></iframe>",null,!1,null,300);F(b);});r.innerHTML=rspkr.cfg.getPhrase("loaderror")||"An error has occurred, try again";r.appendChild(p);}else{r.innerHTML=n;}}},settings:x,rsbtnClass:"",addClickEvents:function(){C();},initGlobalCallbacks:function(){h();},showPopupIcon:function(b){j(b);},processDeferred:function(){I();},showPlayer:function(f,a,m){var r;g:{var p=m;rspkr.log("[rspkr.ui.showPlayer]");p=p||!1;if("string"==typeof f){a:{m=$rs.get("a");for(var n=0,t=m.length;n<t;n++){if(m[n].href&&m[n].href==f){m=m[n];break a;}}m=!1;}}else{m=f;}m=(n=m)?$rs.closest(n,".rsexpanded"):void 0;m=$rs.hasClass(m,"pre-expanded")?void 0:m;t=rspkr.HL.chunking?rspkr.HL.chunking.currentChunkNumber:1;if(m&&!$rs.isArray(m)&&rspkr.ui.getActivePlayer()&&1==t&&rspkr.ui.getActivePlayer().getContainer()==m){rspkr.log("Player already active, calling Player.restart() instead"),rspkr.ui.getActivePlayer().restart(),r=void 0;}else{rspkr.HL.chunking&&rspkr.HL.chunking.destroy();rspkr.HL.chunking&&rspkr.HL.chunking.html5support&&(rspkr.HL.chunking.entracte=new Audio,/ios|ipad|iphone|ipod|android|windows phone/i.test(window.navigator.userAgent)&&(rspkr.HL.chunking.entracte.play(),rspkr.HL.chunking.entracte.pause()));rspkr.c.dispatchEvent("onBeforeParamsSet",window,[n]);m="string"==typeof f?f:$rs.getAttr(n,"href");t=null;"string"==typeof f&&(f=m.match(/readid=[^&]+/gi),t=m.match(/readclass=[^&]+/gi),f&&0<f.length&&rspkr.HL.Restore.Storage.readId.push(f[0].replace("readid=","").split(",")),t&&0<t.length&&rspkr.HL.Restore.Storage.readClass.push(t[0].replace("readclass=","").split(",")));rspkr.c.data.selectedHTML="";rspkr.c.data.setParams(m);void 0!==$rs.getAttr(n,"data-target")&&null!==$rs.getAttr(n,"data-target")&&(f=$rs.getAttr(n,"data-target"),f=$rs.get(f),"object"===typeof f&&(a=f));a&&!p?(t=$rs.get(a),$rs.addClass(t,rspkr.ui.rsbtnClass+" rsfloating"),rspkr.basicMode&&($rs.removeClass(t,"rshidden"),$rs.addClass(t,rspkr.ui.rsbtnClass+" rsvisible"))):t=$rs.closest(n,"div."+rspkr.ui.rsbtnClass);if(!0===rspkr.cfg.item("survey.allowed")){if(a=rspkr.c.cookie,p=rspkr.cfg.item("survey.cookieName")||"rspkrsurvey",f=rspkr.cfg.item("survey.cookieLifetime")||15552000000,n=rspkr.c.data.params,"1"===a.readKey(p,"nmbrdisplays")){rspkr.ui.Lightbox.show(rspkr.cfg.item("survey.url")+"?customerid="+n.customerid+"&lang="+n.lang,rspkr.st.r().replaceTokens(rspkr.cfg.item("ui.survey.buttons").join(),{rsSURVEY_BUTTON_CLOSErs:rspkr.cfg.getPhrase("close")}),!0,function(){$rs.regEvent($rs.get("#rssurvey_button_close"),"click",rspkr.u.Lightbox.hide);},500);rspkr.log(a.updateKey(p,"nmbrdisplays","displayed",f),4);r=void 0;break g;}else{void 0===a.readKey(p,"nmbrdisplays")&&rspkr.log(a.updateKey(p,"nmbrdisplays","1",f),4);}}a:{a=t;for(r in q){if(q[r]&&q[r].getContainer&&q[r].getContainer()==a){r=q[r];break a;}}r=new rspkr.ui.Player(a);q.push(r);}if(g&&g!=r||g&&m!==g.getHref()){g.close(!0),rspkr.c.dispatchEvent("onUIClosePlayer",g.getContainer(),[0<rspkr.c.data.selectedText.length?"textsel":"nosel"]);}a=(a=g)?a.getID():null;rspkr.c.dispatchEvent("onUIShowPlayer",window,[a,r.getID()]);r.setHref(m);g=r;r.show();r=g;}}return r;},expand:function(b){_expand(b);},pointerX:0,pointerY:0,setPointerPos:function(b){b.pageX&&(rspkr.ui.pointerX=b.pageX);b.pageY&&(rspkr.ui.pointerY=b.pageY);b.originalEvent&&b.originalEvent.touches&&b.originalEvent.touches[0]&&b.originalEvent.touches[0].pageX&&(rspkr.ui.pointerX=b.originalEvent.touches[0].pageX);b.originalEvent&&b.originalEvent.touches&&b.originalEvent.touches[0]&&b.originalEvent.touches[0].pageY&&(rspkr.ui.pointerY=b.originalEvent.touches[0].pageY);return !0;},viewport:{width:$rs.width(window),height:$rs.height(window)},popups:D,hl:function(b,e){window.setTimeout(function(){B(b,255,255,100,255,e);},200);},scroll:{INTERVAL:null,STEPS:25,scrollToElm:function(b){$rs.isVisible(b)&&this.initScroll(b);},scrollToAnchor:function(k){for(var m=$rs.get("a"),l=null,n=0;n<m.length;n++){var p=m[n];if(p.name&&p.name==k){l=p;break;}}this.initScroll(l);},initScroll:function(f){if(f){for(var l=f.offsetTop,k=f;k.offsetParent&&k.offsetParent!=document.body;){k=k.offsetParent,l+=k.offsetTop;}l-=50;rs.cfg.item("ui.autoscrollOffset")&&!isNaN(rs.cfg.item("ui.autoscrollOffset"))&&(l-=rs.cfg.item("ui.autoscrollOffset"));clearInterval(rspkr.u.scroll.INTERVAL);var k=rspkr.u.scroll.getCurrentYPos(),m=parseInt((l-k)/rspkr.u.scroll.STEPS);rspkr.u.scroll.INTERVAL=setInterval(function(){rspkr.u.scroll.scrollWindow(m,l,f);},10);}else{document.location.hash=f;}},getCurrentYPos:function(){return document.body&&document.body.scrollTop?document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:window.pageYOffset?window.pageYOffset:0;},scrollWindow:function(k,m,l){var n=rspkr.u.scroll.getCurrentYPos(),p=n<m;window.scrollTo(0,n+k);k=rspkr.u.scroll.getCurrentYPos();if(p!=k<m||n==k){window.scrollTo(0,m),clearInterval(rspkr.u.scroll.INTERVAL),"string"==typeof l&&(location.hash=l);}}},activePlayer:g,getActivePlayer:function(){return g;}};}();ReadSpeaker.ui.Slider=function(){var b=this,h={handleClass:"",width:0,height:0,left:0,top:0,steps:-1,stepsize:-1,dir:"h",initval:-1,drop:null,start:null,dragging:null,click:null,labelDragHandle:"",labelStart:"",labelEnd:"",nudge:1},j={rsid:void 0,parent:void 0,ref:void 0},q=void 0,k=void 0,i=void 0,c=void 0,o=void 0,l=!1,g=0,m=function(e){e=e||window.event;e.returnValue=!1;if(e=e.originalEvent){e.cancelBubble=!0,e.returnValue=!1;}e&&e.preventDefault&&e.preventDefault();e&&e.stopPropagation&&e.stopPropagation();};this.initElement=function(e){if(!l){"string"==typeof e&&(e=document.getElementById(e));e.innerHTML+='<a href="javascript:void(0);" role="slider" class="keyLink" style="display:block; border:0;">&#160;</a>';var f=e.getElementsByTagName("a"),f=f[f.length-1],p=-1<h.steps?h.steps:100;f.relatedElement=e;$rs.setAttr(f,"title",h.labelDragHandle);try{$rs.setAttr(f,"aria-label",h.labelDragHandle),$rs.setAttr(f,"aria-orientation","h"==h.dir?"horizontal":"vertical"),$rs.setAttr(f,"aria-valuemin",0),$rs.setAttr(f,"aria-valuemax",p),$rs.setAttr(f,"aria-valuenow",h.initval||0);}catch(n){}g=h.initval;$rs.regEvent(e,"mousedown",this.startDragMouse);$rs.regEvent(f,"click",function(r){m(r);});$rs.regEvent(f,"keyup",this.startDragKeys);$rs.regEvent(f,"dragstart",function(r){m(r);});$rs.regEvent(e,"touchstart",this.touchStart);$rs.regEvent(j.parent,"mousedown",this.mouseClick);}};this.mouseClick=function(f){if(!l&&!$rs.hasClass(j.ref,"dragged")){var a=b.findPos(f.target),n=f.clientX-(a.left-h.left);f=f.clientY-(a.top-h.top);i=a.left;c=a.top;a=b.getCurrentVal({left:n,top:f});"function"==typeof h.click&&h.click(a,j);return !1;}};this.findPos=function(e){var f=curTop=0;if(e.offsetParent){do{f+=e.offsetLeft,curTop+=e.offsetTop;}while(e=e.offsetParent);return{left:f,top:curTop};}};this.startDragMouse=function(e){rspkr.log("[rspkr.ui.Slider] startDragMouse");if(!l){b.startDrag(this);var a=e||window.event;q=a.clientX;k=a.clientY;$rs.regEvent(document.body,"mousemove",b.dragMouse);$rs.regEvent(document.body,"mouseup",b.releaseElement);}m(e);return !1;};this.startDragKeys=function(a){rspkr.log("[rspkr.ui.Slider] startDragKeys "+(a||window.event).keyCode);b.startDrag(this.relatedElement);$rs.regEvent(document.body,"keydown",b.dragKeys);$rs.regEvent(document.body,"keypress",b.switchKeyEvents);$rs.addClass(this.relatedElement,"rskeycontrolled");m(a);};this.touchStart=function(a){a=a.originalEvent;rspkr.log("[rspkr.ui.Slider] touchStart");l||(b.startDrag(a.target),q=a.touches[0].pageX,k=a.touches[0].pageY,$rs.regEvent(a.target,"touchmove",b.touchMove),$rs.regEvent(a.target,"touchend",b.releaseElement));return !1;};this.startDrag=function(a){rspkr.log("[rspkr.ui.Slider] startDrag");o&&b.releaseElement();i=a.offsetLeft;c=a.offsetTop;o=a;$rs.addClass(o,"dragged");"function"==typeof h.start&&h.start(j);};this.dragMouse=function(a){a=a||window.event;b.setPosition(a.clientX-q,a.clientY-k);b.valueChanged=!0;return !1;};this.touchMove=function(a){a=a.originalEvent?a.originalEvent:a;m(a);b.setPosition(a.touches[0].pageX-q,a.touches[0].pageY-k);b.valueChanged=!0;return !1;};this.dragKeys=function(a){switch((a||window.event).keyCode){case 37:case 63234:b.valueChanged=!0;g-=h.nudge;break;case 38:case 63232:b.valueChanged=!0;g+=h.nudge;break;case 39:case 63235:b.valueChanged=!0;g+=h.nudge;break;case 40:case 63233:b.valueChanged=!0;g-=h.nudge;break;case 13:case 27:return b.releaseElement(),!1;case 9:return b.releaseElement(),!0;default:return rspkr.log("[rspkr.ui.Slider] return TRUE"),!0;}!0===b.valueChanged&&(rspkr.c.dispatchEvent("onUISliderMove"),"function"==typeof h.dragging&&h.dragging(b.getCurrentVal({skipValueCalculation:!0}),j));m(a);rspkr.log("[rspkr.ui.Slider] ready to return!");return !1;};this.setPosition=function(f,a){var n,t=!1;n=f;var u=i,v=h.left,p=h.width,w="left";"v"==h.dir&&(n=a,u=c,v=h.top,p=h.height,w="top");n=u+n;-1<h.stepsize&&((n+v)%h.stepsize?n=h.stepsize*Math.ceil(n/h.stepsize)+v:t=!0);n>p+v?n=p+v:n<v&&(n=v);t||(o.style[w]=n+"px","function"==typeof h.dragging&&h.dragging(b.getCurrentVal(),j));};this.switchKeyEvents=function(){$rs.unregEvent(document.body,"keydown",b.dragKeys);$rs.unregEvent(document.body,"keypress",b.switchKeyEvents);$rs.regEvent(document.body,"keypress",b.dragKeys);};this.releaseElement=function(){rspkr.log("[rspkr.ui.Slider] releaseElement");$rs.unregEvent(document.body,"mousemove",b.dragMouse);$rs.unregEvent(document.body,"mouseup",b.releaseElement);$rs.unregEvent(document.body,"keypress",b.dragKeys);$rs.unregEvent(document.body,"keypress",b.switchKeyEvents);$rs.unregEvent(document.body,"keydown",b.dragKeys);$rs.unregEvent(o,"touchmove",b.touchMove);$rs.unregEvent(o,"touchend",b.releaseElement);$rs.removeClass(o,"dragged");$rs.removeClass(o,"rskeycontrolled");$rs.removeClass(o,"rsmousecontrolled");var a=b.getCurrentVal();o=null;"function"==typeof h.drop&&!0===b.valueChanged&&h.drop(a,j);b.valueChanged=!1;rs.ui.getActivePlayer()&&rs.ui.getActivePlayer().setProgress();return !1;};this.getCurrentVal=function(e){var f,p=h.width;f="left";var n=h.left;"v"==h.dir&&(p=h.height,f="top",n=h.top);var r=-1<h.steps?h.steps:100,p=-1<h.stepsize?h.stepsize:p/r;e=e?e[f]:$rs.css(j.ref,f).replace(/px/i,"");pos=Math.round(e)-n;f=Math.round(pos/p);"v"==h.dir&&(f=r-f);rspkr.log("[rspkr.ui.Slider] currentval: "+f);return e&&e.skipValueCalculation||isNaN(f)?g=Math.max(Math.min(g,r),0):g=f;};return{init:function(f,a){"string"==typeof f&&(f=document.getElementById(f));if(f){var p=f.id||"data-readspeaker-slider-id-"+Math.floor(20000*Math.random());f.setAttribute&&f.setAttribute("data-readspeaker-slider-id-","data-readspeaker-slider-parent-"+p);var r={width:function(){return $rs.width(f);},height:function(){return $rs.height(f);}};if("object"==typeof a){for(var t in a){a.hasOwnProperty(t)&&void 0!==h[t]&&(h[t]=a[t]);}}t=!1;var u;"rsbtn_volume_slider"===f.className&&"jquery"===rspkr.l.f.currentLib()&&1.5>parseFloat(jQuery.fn.jquery)&&(u=f.parentNode.style.display,f.parentNode.style.display="block",t=!0);h.width=r.width();h.height=r.height();t&&(f.parentNode.style.display=u);-1<h.steps&&(h.stepsize=("h"==h.dir?h.width:h.height)/h.steps);r=document.createElement("span");r.setAttribute("data-readspeaker-slider-id-",p);r.className=h.handleClass||"rsbtn_progress_handle rsimg";f.appendChild(r);j.rsid=p;j.parent=f;j.ref=r;p=$rs.css(r,"left");null!==p&&(h.left=parseInt(p.replace(/px/i,"")));p=$rs.css(r,"top");null!==p&&(h.top=parseInt(p.replace(/px/i,"")));-1<h.initval&&this.jumpTo(h.initval);h.labelStart&&(p=document.createElement("span"),p.className="slider-label-start",p.innerHTML=h.labelStart,f.appendChild(p));h.labelEnd&&(p=document.createElement("span"),p.className="slider-label-end",p.innerHTML=h.labelEnd,f.appendChild(p));b.initElement(r);}},jumpTo:function(f){if(isNaN(f)){return !1;}var p=101,r=f;-1<h.steps&&(f=Math.round(f),p=h.steps+1);if(-1<f&&f<p){var t=h.width,u=h.left,v="left";"v"==h.dir&&(t=h.height,u=h.top,v="top",f=p-1-f);j.ref.style[v]=t/(p-1)*f+u+"px";$rs.setAttr($rs.findIn(j.ref,"a.keyLink"),"aria-valuenow",r);}},setCurrentValue:function(e){g=e;},getInstance:function(){return j;},getContainer:function(){return j.parent;},releaseElement:function(){b.releaseElement();},startDragKeys:function(e,a){b.startDragKeys.call(e,a);},disabled:function(){if(arguments){l=arguments[0];}else{return l;}}};};ReadSpeaker.ui.Player=function(h){var G=function(b){b=b||window.event;b.returnValue=!1;if(b=b.originalEvent){b.cancelBubble=!0,b.returnValue=!1;}b&&b.preventDefault&&b.preventDefault();b&&b.stopPropagation&&b.stopPropagation();},M=rspkr.getID(),S=this,O=[],L=0,i=!1,R=null,P=!1,B={_play:null,_pause:null,_stop:null,_vol:null,_settings:null,_dl:null,_closer:null,_powered:null,_get:function(a,f){var g;a="_"+a;g=h?this[a]&&0<this[a].length?this[a]:this[a]=$rs.findIn(h,f):null;return g==[]?null:g;},play:function(){return this._get("play",".rsbtn_play");},pause:function(){return this._get("pause",".rsbtn_pause");},stop:function(){return this._get("stop",".rsbtn_stop");},vol:function(){return this._get("vol",".rsbtn_volume");},settings:function(){return this._get("settings",".rsbtn_settings");},dl:function(){return this._get("dl",".rsbtn_dl");},pin:function(){return this._get("pin",".rsbtn_pin");},powered:function(){return this._get("powered",".rsbtn_powered");},closer:function(){return this._get("closer",".rsbtn_closer");},nosound:function(){return this._get("nosound",".rsbtn_nosound");},setPlayPause:function(b){rspkr.log("[rspkr.ui.Player.setPlayPause("+b+")]");b=b?$rs.getAttr(this.pause(),"data-rsphrase-play"):$rs.getAttr(this.pause(),"data-rsphrase-pause");$rs.setAttr(this.pause(),"title",rspkr.c.decodeEntities(b));$rs.findIn(this.pause(),".rsbtn_btnlabel").innerHTML=b;}},Q=!1,o=[],j={play:function(){rspkr.c.dispatchEvent("onUIBeforePlay");rspkr.log("[rspkr.ui.handlers.play]");o.progress&&o.progress.disabled(!1);j.setStateClass(h,"rsplaying");rspkr.basicMode&&j.setStateClass($rs.findIn(h,".rsbtn_exp"),"rsplaying");$rs.addClass($rs.findIn(h,".rsbtn_progress_container"),"rsloading");B.setPlayPause(!1);if(rspkr.ui.getActivePlayer()&&rspkr.ui.getActivePlayer().getContainer()==h){rspkr.pl.play(),P&&rspkr.pl.getProgress.apply(rspkr.pl,[!0,I,S]),rspkr.c.addEvent("onBeforeSyncInit",function(){P=!0;rspkr.pl.getProgress.apply(rspkr.pl,[!0,I,S]);}),"flash"===rspkr.pl.adapter&&!rspkr.displog.onVolumeAdjusted&&rspkr.pl.setVolume(parseInt(rspkr.st.get("hlvol")||"100")),rspkr.c.dispatchEvent("onUIAfterPlay"),rspkr.cfg.execCallback("cb.ui.play",h);}else{rspkr.ui.getActivePlayer()&&rspkr.ui.getActivePlayer().close();var a=$rs.findIn(h,".rsbtn_play");window.readpage(a);}},pause:function(){rspkr.log("[rspkr.ui.handlers.pause]");j.setStateClass(h,"rspaused");rspkr.basicMode&&j.setStateClass($rs.findIn(h,".rsbtn_exp"),"rspaused");B.setPlayPause(!0);rspkr.pl.pause();rspkr.pl.getProgress(!1);rspkr.c.dispatchEvent("onUIPause");rspkr.cfg.execCallback("cb.ui.pause",h);rspkr.log("ReadSpeaker.ui.pause");},stop:function(){rspkr.log("[rspkr.ui.handlers.stop]");o.progress&&o.progress.disabled(!0);j.setStateClass(h,"rsstopped");$rs.removeClass($rs.findIn(h,".rsbtn_progress_container"),"rsloading");rspkr.basicMode&&j.setStateClass($rs.findIn(h,".rsbtn_exp"),"rsstopped");B.setPlayPause(!0);$rs.setAttr(h,"data-readspeaker-current",0);o.progress&&(o.progress.jumpTo(0),J(0));rspkr.pl.stop();rspkr.pl.getProgress(!1);rspkr.c.dispatchEvent("onUIStop",h);rspkr.cfg.execCallback("cb.ui.stop",h);document.getElementById("rslightbox_contentcontainer")&&$rs.isVisible(document.getElementById("rslightbox_contentcontainer"))||B.pause().focus();rspkr.HL.chunking&&1<rspkr.HL.chunking.currentChunkNumber&&(rspkr.HL.chunking.destroy(),rspkr.pl.hasOwnProperty("releaseAdapter")&&rspkr.pl.releaseAdapter());rspkr.log("ReadSpeaker.ui.stop");},setStateClass:function(c,e){c&&($rs.removeClass(c,"rspaused rsstopped rsplaying"),$rs.addClass(c,e));},vol:function(a){var c=$rs.findIn(h,".rsbtn_volume_container"),k=$rs.findIn(h,".rsbtn_volume");a=a.originalEvent;var m=function(e){var f=e.originalEvent,f=$rs.closest(f.srcElement||f.originalTarget,".rsbtn_volume_container");if("click"===e.type){if(void 0===f||$rs.isArray(f)&&!f.length){$rs.css(c,"display","none"),$rs.unregEvent(document.body,"click",m),$rs.unregEvent(document.body,"keyup",m);}}else{"keyup"===e.type&&27===e.keyCode&&($rs.css(c,"display","none"),$rs.unregEvent(document.body,"click",m),$rs.unregEvent(document.body,"keyup",m));}};$rs.css(c,"left",k.offsetLeft+"px");$rs.css(c,"display","none"==$rs.css(c,"display")?"block":"none");"block"===$rs.css(c,"display")?($rs.regEvent(document.body,"click",m),$rs.regEvent(document.body,"keyup",m)):($rs.unregEvent(document.body,"click",m),$rs.unregEvent(document.body,"keyup",m));a&&a.stopPropagation&&a.stopPropagation();a.cancelBubble=!0;k={keyCode:13};a=$rs.findIn(c,".keyLink");try{o.vol.startDragKeys(a,k);}catch(n){rspkr.log("[rspkr.ui.handlers.vol] Error accessing object _sliders['vol']");}return !1;},settings:function(){$rs.hasClass(h,"rsplaying")&&this.pause();rspkr.ui.Lightbox.show(rspkr.st.getHTML(),rspkr.st.getButtons(),!0,function(e){var f=$rs.get("rslightbox_closer"),g=function(){document.removeEventListener?f.removeEventListener("click",g,!1):document.detachEvent&&document.detachEvent("onclick",g);rspkr.c.dispatchEvent("onSettingsClosed",window,[]);};$rs.regEvent(f,"click",g);rspkr.ui.addClickEvents();rspkr.c.dispatchEvent("onSettingsLoaded",window,[]);rspkr.cfg.execCallback("cb.ui.settingsopened",e);});},close:function(c){j.pin(!0);c=c||!1;var a=rspkr.pl,b=!1;rspkr.HL.chunking&&rspkr.HL.chunking.destroy();c||rspkr.cfg.execCallback("cb.ui.beforeclose",h);a.hasOwnProperty("getProgress")&&rspkr.pl.getProgress(!1);a.hasOwnProperty("releaseAdapter")&&rspkr.pl.releaseAdapter();$rs.setAttr(h,"data-readspeaker-current",0);o.progress&&(o.progress.jumpTo(0),J(0));$rs.removeClass(h,"rsstopped rsplaying rspaused rsexpanded");if(rspkr.basicMode){var e;(e=$rs.findIn(h,".rsbtn_play"))&&$rs.removeClass(e,"rsexpanded");}$rs.hasClass(h,"rsfloating")&&($rs.removeClass(h,rspkr.ui.rsbtnClass),rspkr.basicMode&&($rs.removeClass(h,"rsvisible"),$rs.addClass(h,"rshidden")));B.setPlayPause(!0);$rs.hasClass(h,"rspopup")&&(b=!0,$rs.removeClass(h,"rspopup"),$rs.css(h,"display","none"),h.parentNode.removeChild(h));$rs.css(h,"width","auto");delete rspkr.displog.onVolumeAdjusted;c||(rspkr.c.dispatchEvent("onUIClosePlayer",h,["userclick"]),rspkr.cfg.execCallback("cb.ui.close",h),rspkr.log("ReadSpeaker.ui.close: "+h));!c&&!1===b&&rspkr.ui.focus($rs.findIn($rs.get(h),".rsbtn_play"));},dl:function(){$rs.hasClass(h,"rsplaying")&&this.pause();var a=$rs.getAttr($rs.findIn(h,".rsbtn_play"),"href"),f=a?rspkr.c.data.getSaveData("dialog",a):rspkr.c.data.getSaveData("dialog"),g=!1;rspkr.log("[rspkr.ui.handlers.dl] Savelink: "+f);rspkr.u.Lightbox.show(this.getDlDialog(),this.getDlButtons(),!0,function(){var c=$rs.get("#rsdl_button_accept"),e=$rs.get("#rsdl_button_decline");c&&$rs.regEvent(c,"click",function(k){rspkr.u.Lightbox.hide(k);g="iOS"!==rspkr.c.data.browser.OS&&0<rspkr.c.data.selectedHTML.length?!0:"iOS"!==rspkr.c.data.browser.OS&&!0===rspkr.cfg.item("general.usePost")?!0:!1;if(!0===g){k=null;if(document.getElementById("dliframe")){k=document.getElementById("dliframe");}else{if(document.selection){try{k=document.createElement('<iframe name="dliframe">');}catch(n){k=document.createElement("iframe");}}else{k=document.createElement("iframe");}k.name="dliframe";k.setAttribute("id","dliframe");k.setAttribute("style","display: none; position: absolute;");k.style.display="none";var l=document.getElementsByTagName("body"),m=null;0<l.length&&(m=l.item(0));if(m){m.appendChild(k);}else{return;}}k.src=f;return !1;}$rs.setAttr(c,"href",f);return !0;});e&&($rs.regEvent(e,"click",function(b){G(b);rspkr.u.Lightbox.hide(b);}),setTimeout(function(){rspkr.ui.focus(e);},200));rspkr.c.dispatchEvent("onDownloadLoaded",window,[]);});},pin:function(a,t){var u=h.id+"_pinnedHome",v=document.getElementById(u);t=t?!0:!1;if(!$rs.hasClass(B.pin(),"pinned")&&!a){if($rs.addClass(B.pin(),"pinned"),!v){var y=function(c,f){return window.getComputedStyle?window.getComputedStyle(c)[f]:c.currentStyle?c.currentStyle[f]:c.style[f];},v=$rs.clone(h,!1,!0),w=h.offsetLeft,A=h.offsetTop;if(!t){v.style.width=y(h,"width").replace(/[^-\d\.]/g,"")-2+"px";v.style.height=y(h,"height").replace(/[^-\d\.]/g,"")-2+"px";for(var z="position left right top bottom margin-left margin-right margin-top margin-bottom".split(" "),D=0,e;e=z[D];D++){var C=$rs.css(h,e);$rs.setAttr(h,"data-css-"+e,C);C=y(h,e);"auto"!=C&&(v.style[e]=C);}v.className="rsbtn_pinnedHome rsbtn";for(v.id=u;v.hasChildNodes();){v.removeChild(v.lastChild);}h.parentElement.insertBefore(v,h);}h.style.position="fixed";h.style.top=A-$rs.scrollTop(document)+"px";h.style.left=w-$rs.scrollLeft(document)+"px";}}else{if($rs.hasClass(B.pin(),"pinned")||a){if($rs.removeClass(B.pin(),"pinned"),v){for(v.parentNode.removeChild(v),z="position left right top bottom margin-left margin-right margin-top margin-bottom".split(" "),D=0;e=z[D];D++){C=$rs.getAttr(h,"data-css-"+e),$rs.css(h,e,C);}}}}},getDlDialog:function(){var c=rspkr.cfg.item("ui.dldialog").join("\n"),e={};e.rsTERMS_OF_USE_HEADINGrs=rspkr.cfg.getPhrase("touheading");e.rsTERMS_OF_USE_BODYrs=rspkr.cfg.getPhrase("toubody");return rspkr.st.r().replaceTokens(c,e);},getDlButtons:function(){var c=rspkr.cfg.item("ui.dlbuttons").join("\n"),e={};e.rsTERMS_OF_USE_ACCEPTrs=rspkr.cfg.getPhrase("touaccept");e.rsTERMS_OF_USE_DECLINErs=rspkr.cfg.getPhrase("toudecline");return rspkr.st.r().replaceTokens(c,e);},nosound:function(){var b=rspkr.c.data.getSaveData("link");$rs.setAttr(B.nosound(),"href",b);return !0;}},J=function(a){a=100<a?100:a;var e=$rs.findIn(h,".rsbtn_progress_played");"object"===typeof e&&$rs.css(e,"width",a+"%");rspkr.cfg.execCallback("cb.ui.progresschanged",h,[a]);},I=function(a){if(a.length){var c=parseInt(a[0]);a=parseInt(a[1]);var m=0==a?0:Math.round(c/a*100),l=$rs.findIn(h,".rsbtn_current_time"),p=$rs.findIn(h,".rsbtn_total_time"),t,u;o.progress&&(o.progress.setCurrentValue(m),Q||(o.progress.jumpTo(m),J(m),l&&(l.innerHTML=t=K(c)),p&&(p.innerHTML=u=K(a)),rspkr.cfg.execCallback("cb.ui.timeupdated",h,[t,u])));rspkr.log("[rspkr.player.updateProgress] current time: "+c+" total time: "+a);$rs.setAttr(h,"data-readspeaker-current",c);$rs.setAttr(h,"data-readspeaker-buffered",a);0<c&&$rs.removeClass($rs.findIn(h,".rsbtn_progress_container"),"rsloading");}},K=function(e){e/=1000;var f=parseInt(e%60),g=parseInt(e/60%60);e=parseInt(e/60/60%60);return(10>e?"0"+e:e.toString())+":"+(10>g?"0"+g:g.toString())+":"+(10>f?"0"+f:f.toString());},N=function(){Q=!0;},H=function(a){rspkr.log("_dropProgress ("+a+")",5);a&&(a=a/100*$rs.getAttr(h,"data-readspeaker-buffered")/1000,rspkr.pl.setProgress(a));Q=!1;},T=function(b){H(b);},x=function(a){rspkr.log("_dropVolume, "+a,5);a=0>a?0:20*a;o.vol&&o.vol.jumpTo(a/20);rspkr.pl.setVolume(a);rspkr.st.set("hlvol",a);rspkr.cfg.execCallback("cb.ui.volumechanged",h,[a]);return !1;},F=function(a,c){if("keyLink"===a.className){var l="";$rs.hasClass(c,"rsbtn_volume_handle")?l="vol":$rs.hasClass(c,"rsbtn_progress_handle")&&(l="progress");var k={keyCode:13};o[l].startDragKeys(a,k);}else{$rs.hasClass(c,"rsbtn_volume")&&(k={keyCode:13},l=$rs.findIn(h,".rsbtn_volume_container"),l=$rs.findIn(l,".keyLink"),o.vol.startDragKeys(l,k));}},q=function(c,f){if("keyLink"===c.className){var g="";$rs.hasClass(f,"rsbtn_volume_handle")?g="vol":$rs.hasClass(f,"rsbtn_progress_handle")&&(g="progress");o[g].releaseElement();Q=!1;}};return{init:function(){O.push([this.show,[]]);},initVolume:function(){if(!$rs.isArray($rs.findIn($rs.get(h),".rsbtn_volume_slider"))){var a=rspkr.cfg,c=rspkr.st.get("hlvol")||"100",c=5*(parseInt(c)/100);o.vol=new rspkr.ui.Slider;o.vol.init($rs.findIn(h,".rsbtn_volume_slider"),{handleClass:a.item("ui.volumeHandleClass")||"rsbtn_volume_handle rsimg",dir:a.item("ui.volumeDir")||"v",steps:5,nudge:1,initval:c,dragging:x,click:x,labelDragHandle:a.getPhrase("slidervolumedesc")});a=$rs.findIn($rs.get(h),".rsbtn_volume_handle a");ui.addFocusHandler(a,!1,a.parentNode);}},show:function(a){a=a?!0:!1;var c=$rs.hasClass(h,"rsexpanded");$rs.rsid(h);h.id=M=h.id||rspkr.getID();ui=rspkr.ui;$rs.hasClass(h,rspkr.ui.rsbtnClass)||$rs.addClass(h,rspkr.ui.rsbtnClass);var b=null,b=rspkr.cfg,e=rspkr.cfg.getPhrases(rspkr.c.data.getParam("lang"));if(0==$rs.findIn(h,".rsbtn_exp").length){var f=$rs.hasClass(h,"rspopup")?b.item("ui.popupplayer"):b.item("ui.player"),b=document.createElement("div");b.className="rsbtn_exp rsimg rspart";b.innerHTML+=f.join("\n");h.appendChild(b);}b=B.pin();f="Explorer"==rspkr.c.data.browser.name&&8>rspkr.c.data.browser.version;$rs.isArray(b)&&0==b.length&&(b=void 0);b&&!f&&rspkr.cfg.item("ui.usePin")?$rs.removeClass(b,"turnedOff"):b&&b.parentElement.removeChild(b);if(e){b=function(k,l){var m=$rs.findIn(k,".rsbtn_btnlabel");$rs.isArray(m)||(m=[m]);0<m.length&&(m[0].innerHTML=l);};B.pause()&&($rs.setAttr(B.pause(),"data-rsphrase-pause",e.pause),$rs.setAttr(B.pause(),"data-rsphrase-play",e.play),$rs.setAttr(B.pause(),"title",rspkr.c.decodeEntities(e.pause)),b(B.pause(),rspkr.c.decodeEntities(e.pause)));B.stop()&&($rs.setAttr(B.stop(),"title",rspkr.c.decodeEntities(e.stop)),b(B.stop(),rspkr.c.decodeEntities(e.stop)));B.vol()&&($rs.setAttr(B.vol(),"title",rspkr.c.decodeEntities(e.volume)),b(B.vol(),rspkr.c.decodeEntities(e.volume)));B.settings()&&($rs.setAttr(B.settings(),"title",rspkr.c.decodeEntities(e.settings)),b(B.settings(),rspkr.c.decodeEntities(e.settings)));B.dl()&&($rs.setAttr(B.dl(),"title",rspkr.c.decodeEntities(e.download)),b(B.dl(),rspkr.c.decodeEntities(e.download)));if(B.powered()){var f=$rs.findIn(B.powered(),".rsbtn_btnlabel"),n=e.speechenabled.match(/.*href="([^"]*)"/i).pop(),g=e.newwindow,r=document.createElement("p");r.innerHTML=e.speechenabled;g=(r.innerText||r.textContent)+(g?" ("+g+")":"");f&&(f.innerHTML=e.speechenabled);$rs.setAttr(B.powered(),"title",g);$rs.setAttr(B.powered(),"data-readspeaker-href",n);f=$rs.getAttr(B.powered(),"data-rsevent-id");(!f||rs.l.f.eq.store[f]&&!rs.l.f.eq.store[f].click)&&$rs.regEvent(B.powered(),"click",function(){window.open($rs.getAttr(this,"data-readspeaker-href"));});}B.closer()&&($rs.setAttr(B.closer(),"title",rspkr.c.decodeEntities(e.closeplayer)),b(B.closer(),rspkr.c.decodeEntities(e.closeplayer)));}e=rspkr.c.data.browser;/safari/i.test(e.name)&&/iphone|ipad|ios/i.test(e.OS)||$rs.addClass(h,"rs-no-touch");e=$rs.findIn(h,".rsbtn_status_overlay");$rs.isArray(e)||$rs.css(e,"display","none");"fallback"===rspkr.pl.adapter&&(rspkr.ui.showOverlay("nosound",h),$rs.addClass(h,"rsstopped"));$rs.addClass(h,"rsexpanded");if(rspkr.basicMode){var p;(p=$rs.findIn(h,".rsbtn_play"))&&$rs.addClass(p,"rsexpanded");}!i&&!c&&(B.stop()&&($rs.regEvent(B.stop(),"click",function(k){G(k);j.stop();}),ui.addFocusHandler(B.stop())),B.pause()&&($rs.regEvent(B.pause(),"click",function(k){G(k);$rs.hasClass(h,"rsplaying")?j.pause():($rs.hasClass(h,"rsstopped")||$rs.hasClass(h,"rspaused"))&&j.play();}),ui.addFocusHandler(B.pause())),B.closer()&&($rs.regEvent(B.closer(),"click",function(k){G(k);j.close();}),ui.addFocusHandler(B.closer())),B.vol()&&($rs.regEvent(B.vol(),"click",function(k){G(k);j.vol(k);}),ui.addFocusHandler(B.vol())),B.dl()&&($rs.regEvent(B.dl(),"click",function(k){G(k);return j.dl(k);}),ui.addFocusHandler(B.dl())),B.settings()&&($rs.regEvent(B.settings(),"click",function(k){G(k);j.settings();}),ui.addFocusHandler(B.settings())),B.pin()&&($rs.regEvent(B.pin(),"click",function(k){G(k);j.pin();}),ui.addFocusHandler(B.pin())),p=rspkr.cfg,$rs.setAttr(h,"data-readspeaker-current",0),$rs.setAttr(h,"data-readspeaker-buffered",0),$rs.isArray($rs.findIn($rs.get(h),".rsbtn_progress_container"))||(o.progress=new rspkr.ui.Slider,o.progress.init($rs.findIn($rs.get(h),".rsbtn_progress_container"),{handleClass:p.item("ui.progressHandleClass")||"rsbtn_progress_handle rsimg",dir:p.item("ui.progressDir")||"h",nudge:5,start:N,dragging:H,click:T,labelDragHandle:p.getPhrase("sliderseek")}),c=$rs.findIn($rs.get(h),".rsbtn_progress_handle a"),ui.addFocusHandler(c,!1,c.parentNode)),$rs.isArray($rs.findIn($rs.get(h),".rsbtn_volume_slider"))||(c=rspkr.st.get("hlvol")||"100",c=5*(parseInt(c)/100),o.vol=new rspkr.ui.Slider,o.vol.init($rs.findIn(h,".rsbtn_volume_slider"),{handleClass:p.item("ui.volumeHandleClass")||"rsbtn_volume_handle rsimg",dir:p.item("ui.volumeDir")||"v",steps:5,nudge:1,initval:c,dragging:x,click:x,labelDragHandle:p.getPhrase("slidervolumedesc")}),c=$rs.findIn($rs.get(h),".rsbtn_volume_handle a"),ui.addFocusHandler(c,!1,c.parentNode)),rspkr.Common.addEvent("onFocusIn",F),rspkr.Common.addEvent("onFocusOut",q),rspkr.cfg.execCallback("cb.ui.open",h),i=!0);$rs.findIn(h,".rsbtn_powered")&&(p=$rs.findIn(h,".rsbtn_powered .rsbtn_btnlabel a"))&&((/Chrome|Safari|Opera/gi.test(rs.c.data.browser.name)||/Explorer/gi.test(rs.c.data.browser.name)&&8<=rs.c.data.browser.version)&&$rs.regEvent(p,"click",function(k){G(k);}),p.innerHTML='<span class="rsbtn_label_read">Read</span><span class="rsbtn_label_speaker">Speaker</span><span class="rsbtn_label_icon rsimg"></span>');"0"!=$rs.getAttr(h,"data-readspeaker-current")&&(rspkr.pl.releaseAdapter(),$rs.setAttr(h,"data-readspeaker-current",0));"fallback"===rspkr.pl.adapter||a?(o.progress&&o.progress.disabled(!0),j.setStateClass(h,"rsstopped"),$rs.removeClass($rs.findIn(h,".rsbtn_progress_container"),"rsloading"),rspkr.basicMode&&j.setStateClass($rs.findIn(h,".rsbtn_exp"),"rsstopped")):(j.play(),rspkr.ui.focus(B.pause()));a=(a=h)||h;a=$rs.clone(a,!0,!0);a.id=rspkr.getID();document.body.appendChild(a);$rs.css(a,{position:"absolute",top:"0",left:"0",display:"block",width:"auto"});$rs.css(a,"float","none");$rs.addClass(a,"rsexpanded");p=$rs.outerWidth(a)+3;a.style.display="none";document.body.removeChild(a);L=p;isNaN(L)||$rs.css(h,"width",L+(/[Ee]xplorer/.test(ReadSpeaker.c.data.browser.name)?1:0)+"px");$rs.hasClass(h,"rspopup")&&!rspkr.cfg.item("ui.pinnedPopup")&&!rspkr.basicMode&&j.pin(!1,!0);},close:function(b){j.close(b);},stop:function(){j.stop();},nosound:function(){return j.nosound();},pause:function(){j.pause();},play:function(){j.play();},dl:function(b){j.dl(b);},settings:function(){j.settings();},vol:function(b){j.vol(b);},pin:function(b,e){j.pin(b,e);},restart:function(){rspkr.log("[rspkr.ui.restart]");j.stop();window.setTimeout(function(){j.play();},500);return !1;},updateProgress:function(b){I(b);},setProgress:function(b){H(b);},getContainer:function(){return h;},getID:function(){return M;},getWidth:function(){return L;},setHref:function(b){R=b;},getHref:function(){return R;}};};ReadSpeaker.ui.Lightbox=function(){var b=null,j=null,l=null,x=null,m=null,k=null,g,r=[],o=function(c){c=c||window.event;c.returnValue=!1;if(c=c.originalEvent){c.cancelBubble=!0,c.returnValue=!1;}c&&c.preventDefault&&c.preventDefault();c&&c.stopPropagation&&c.stopPropagation();},i=function(){var n=$rs.css(k,"display");$rs.css(k,"display","none");var t=$rs.height(window),v=$rs.height(document),w=parseInt($rs.css(document.documentElement,"width")),A=$rs.width(document),y=$rs.absOffset(document.body),z=0,B=0;isNaN(w)&&(w=$rs.width(window));y.left&&(B=y.left);y.top&&(z=y.top);$rs.css(m,{width:(A>w?A:w)+"px",height:(v>t?v:t)+"px",top:"-"+Math.abs(z)+"px",left:"-"+Math.abs(B)+"px"});$rs.css(k,"display",n);q();},q=function(){var n=$rs.outerWidth(k),p=$rs.outerHeight(k),t=$rs.width(window),u=$rs.height(window),p=g+80+50<u?g+80:u-50;k.style.height=p+"px";$rs.get("#rslightbox_content").style.height=p-80+"px";p>u?(k.style.top=$rs.scrollTop(document)+"px",k.style.marginTop="10px"):(k.style.top=u/2+"px",k.style.marginTop=-(p/2-$rs.scrollTop(document))+"px");n>t?(k.style.left=$rs.scrollLeft(document)+"px",k.style.marginLeft="0"):(k.style.left="50%",k.style.marginLeft=-(n/2-$rs.scrollLeft(document))+"px");},h=function(c){27===c.keyCode&&rspkr.ui.Lightbox.hide();};return{init:function(){var a=rspkr.pub.Config;b=a.item("ui.overlay.overlayStyles");j=a.item("ui.overlay.contentStyles");l=a.item("ui.overlay.contentTemplate");document.querySelectorAll||(d=document,s=d.createStyleSheet(),d.querySelectorAll=function(f,n,p,t,u){u=d.all;n=[];f=f.replace(/\[for\b/gi,"[htmlFor").split(",");for(p=f.length;p--;){s.addRule(f[p],"k:v");for(t=u.length;t--;){u[t].currentStyle.k&&n.push(u[t]);}s.removeRule(0);}return n;});rspkr.log("[rspkr.ui.Lightbox] Heartbeat!");},show:function(a,t,p,u,w){for(var f=0,A=document.body.getElementsByTagName("*"),y;y=A[f];f++){-1!=y.tabIndex&&(r.push([y,y.tabIndex]),y.tabIndex=-1);}if("Explorer"!=rs.c.data.browser.name||6!=rs.c.data.browser.version){for(y=document.querySelectorAll("body > *"),f=0;A=y[f];f++){if("rslightbox_overlay"!=A.id&&"rslightbox_contentcontainer"!=A.id&&"script"!=A.tagName.toLowerCase()){var e=A.getAttribute("aria-hidden");e&&A.setAttribute("data-original-aria-hidden",e);A.setAttribute("aria-hidden","true");}}}a=a||"";p=p||!1;m?(m.style.display="",k.style.display=""):(m=document.createElement("div"),m.id="rslightbox_overlay",k=document.createElement("div"),k.id="rslightbox_contentcontainer",k.innerHTML=rspkr.st.r().replaceTokens(l.join("\n"),{rsLIGHTBOX_CLOSE_LABELrs:rspkr.cfg.getPhrase("close")}),$rs.setAttr(m,"style",b.join(";")),$rs.setAttr(k,"style",j.join(";")),document.body.appendChild(m),document.body.appendChild(k),rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.changed.addButtonEvents,context:rspkr.st.r().handlers.changed,params:[this]}));f=$rs.get("rslightbox_closer");rspkr.ui.addFocusHandler(f,!1);$rs.regEvent(f,"click",function(v){o(v);rspkr.ui.Lightbox.hide(v);});$rs.regEvent(m,"click",rspkr.ui.Lightbox.hide);$rs.regEvent(document.body,"keyup",h);(A=document.documentElement)&&document.all&&(A.style.overflowX=A.style.overflowY="hidden");if(a!=x||p){p=rspkr.cfg.getPhrase("close"),$rs.setAttr(f,"title",p),$rs.findIn(f,".rsbtn_btnlabel").innerHTML=p,$rs.get("#rslightbox_content").innerHTML="",$rs.css("#rslightbox_content","height","auto"),/^http/i.test(a)?$rs.findIn("#rslightbox_content","iframe").length||(p=document.createElement("iframe"),p.src=a,p.className="rslightbox-iframe",void 0===w&&(w=2000),$rs.get("#rslightbox_content").appendChild(p)):"<"==a.substr(0,1)&&($rs.get("#rslightbox_content").innerHTML=a),$rs.get("#rslightbox_buttons").innerHTML=t,x=a,"ar_ar"==rs.c.data.params.lang&&(-1==k.className.indexOf("rtl")&&(k.className=(k.className+" rtl").replace(/^\s+|\s+$/g,"")),$rs.setAttr($rs.findIn(k,"legend"),"align","right"));}g=void 0===w||isNaN(w)?rspkr.basicMode?$rs.get("#rslightbox_content").scrollHeight:$rs.get("#rslightbox_content").clientHeight:w;a=$rs.findIn("#rslightbox_content",".rsform-row");for(f=0;f<a.length;f++){for(t=$rs.findIn(a[f],"input, a, select"),$rs.isArray(t)||(t=[t]),A=0;A<t.length;A++){rspkr.ui.addFocusHandler(t[A],!1,a[f]);}}var c=$rs.findIn("#rslightbox_buttons",".rssettings-button-close");rspkr.ui.addFocusHandler(c,!1);$rs.regEvent(c,"click",function(v){o(v);});(a=$rs.findIn("#rsform_wrapper",".rssettings-button-gotobottom"))&&!$rs.isArray(a)&&rspkr.ui.addFocusHandler(a,!1);(a=$rs.findIn("#rslightbox_buttons",".rssettings-button-gototop"))&&!$rs.isArray(a)&&rspkr.ui.addFocusHandler(a,!1);var n=$rs.findIn("#rslightbox_content","input");$rs.isArray(n)&&0<n.length?setTimeout(function(){rspkr.ui.focus(n[0]);rspkr.Common.addEvent("onFocusIn",function(v){v.className&&$rs.hasClass(v,"rssettings-button-gototop")?rspkr.ui.focus(n[0]):v.className&&$rs.hasClass(v,"rssettings-button-gotobottom")&&rspkr.ui.focus(c);});},200):$rs.isArray(n)||setTimeout(function(){rspkr.ui.focus(n);},200);i();$rs.regEvent(window,"resize",i);"function"==typeof u&&u.apply(this,[k]);},hide:function(c){for(;0<r.length;){var e=r.pop();e[0].tabIndex=e[1];}if("Explorer"!=rs.c.data.browser.name||6!=rs.c.data.browser.version){c=document.querySelectorAll("body > *");for(var e=0,n;n=c[e];e++){var p=n.getAttribute("data-original-aria-hidden");p?(n.setAttribute("aria-hidden",p),n.removeAttribute("data-original-aria-hidden")):n.removeAttribute("aria-hidden");}}o(c);m.style.display="none";k.style.display="none";$rs.unregEvent(window,"resize",i);$rs.unregEvent($rs.get("#rslightbox_closer"),"click",rspkr.ui.Lightbox.hide);$rs.unregEvent(m,"click",rspkr.ui.Lightbox.hide);$rs.unregEvent(document.body,"keyup",h);(c=document.documentElement)&&document.all&&(c.style.overflowX=c.style.overflowY="auto");rspkr.ui.updateFocus();rspkr.c.dispatchEvent("onSettingsClosed",window,[]);},reposition:q};}();