rspkr.HL=function(){var b="",f={firstRun:0,previousWord:{},previousSent:{},lastWord:null,selectionRange:null,selectionHTML:null,selectedWordsRange:[]},h={oldWordHL:[],oldWordHLClass:[],oldSentHL:[],oldSentHLClass:[],sync:function(e,d){var j=!1,k=document.getElementById("sync"+d);0==(e&2)&&(j=0!=(e&1)?!0:!1);if(k&&k.className.replace("word","")!=k.className){if(!j&&0<this.oldWordHL.length){for(j=0;j<this.oldWordHLClass.length;j++){this.oldWordHL[j].className=this.oldWordHLClass[j];}this.oldWordHL=[];this.oldWordHLClass=[];}this.oldWordHLClass.push(k.className);this.oldWordHL.push(k);rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.wordHL(k,e);k.className=k.className.replace("sync_word","sync_word_highlighted");}else{if(k&&k.className.replace("sent","")!=k.className){if(!j&&0<this.oldSentHL.length){for(j=0;j<this.oldSentHL.length;j++){this.oldSentHL[j].className=this.oldSentHLClass[j];}this.oldSentHL=[];this.oldSentHLClass=[];}this.oldSentHLClass.push(k.className);this.oldSentHL.push(k);rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.sentHL(k,e);k.className=k.className.replace("sync_sent","sync_sent_highlighted");}}k&&rspkr.HL.Scroll.execScroll(k);},preProcess:{setRestoreContent:function(){rspkr.log("[Servermarkup.preProcess.setRestoreContent] Called!");var a=rspkr.Common.data.getParam("readid"),a=document.getElementById(a).innerHTML;rspkr.Common.data.setRestoreContent(a);}},postProcess:{fullCleanUp:function(){rspkr.log("[Servermarkup.postProcess.fullCleanUp] Called!");rspkr.HL.Restore.all();},lightCleanUp:function(){rspkr.log("[Servermarkup.postProcess.lightCleanUp] Called!");var e=rspkr.HL.serverMarkup.oldWordHL,d=rspkr.HL.serverMarkup.oldWordHLClass,j=rspkr.HL.serverMarkup.oldSentHL,l=rspkr.HL.serverMarkup.oldSentHLClass;if(0<e.length){for(var k=0;k<e.length;k++){e[k].className=d[k];}rspkr.HL.serverMarkup.oldWordHL=[];rspkr.HL.serverMarkup.oldWordHLClass=[];}if(0<j.length){for(k=0;k<j.length;k++){j[k].className=l[k];}rspkr.HL.serverMarkup.oldSentHL=[];rspkr.HL.serverMarkup.oldSentHLClass=[];}k=rspkr.Common.data.browser.syncContainer.replace(/(:|\.|\[|\]|,)/g,"\\$1");e=$rs.get(k+".sync_sent,"+k+".sync_word,"+k+".sync_sent_highlighted,"+k+".sync_word_highlighted,"+k+".sync_user,"+k+".synctemp,"+k+'[class*="ffsent"]');e=$rs.isArray(e)?e:[e];for(k=e.length-1;-1<k;k--){e[k].className=e[k].className.replace("sync_sent_highlighted","sync_sent"),e[k].className=e[k].className.replace("sync_word_highlighted","sync_word"),-1!==e[k].className.toLowerCase().indexOf("sync_user")&&(e[k].className=e[k].className.replace("sync_sent",""),e[k].className=e[k].className.replace("sync_word",""),e[k].removeAttribute("id"));}}}},g={enums:{key:"readspeaker_inline_styles",sent:"sync_sent",sent_hl:"sync_sent_highlighted",word:"sync_word",word_hl:"sync_word_highlighted"},word_index:null,sent_index:null,hlChanged:!1,setHL:function(){var e=rspkr.pub.Config,d=rspkr.Common.Settings.get("hlword")||e.item("settings.hlword"),j=rspkr.Common.Settings.get("hlsent")||e.item("settings.hlsent"),e=rspkr.Common.Settings.get("hltext")||e.item("settings.hltext");this.updateHL("hlword",d,null);this.updateHL("hlsent",j,null);this.updateHL("hltext",e,null);},updateHL:function(a,d,c){c=c||null;"hlspeed"===a&&d!==c&&(this.hlChanged=!0);d===c||"hl"!==a&&"hltoggle"!==a||(this.hlChanged=!0,rspkr.HL.sync.lightCleanUp());d!==c&&("hl"===a&&"none"!==d||"hltoggle"===a&&"hlon"===d)&&(this.setTextStyle("word",rspkr.Common.Settings.get("hlword")),this.setTextStyle("sent",rspkr.Common.Settings.get("hlsent")),this.setTextStyle("hltext",rspkr.Common.Settings.get("hltext")),this.hlChanged=!0,rspkr.HL.Type.CURRENT===rspkr.HL.Type.CLIENT_MARKUP&&rspkr.PlayerAPI.releaseAdapter());/hltext|hlword|hlsent|hlscroll/i.test(a)&&d!=c&&("hlscroll"==a?rspkr.HL.Scroll.initScroll():(this.setTextStyle(a,d),"explorer"==b&&(f.selectionRange&&"wordsent"===rspkr.st.get("hl")&&"hlsent"==a&&(f.selectionRange.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),f.selectionRange.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))),f.lastWord&&("sent"==rspkr.st.get("hl")?f.lastWord.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")):f.lastWord.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword")),f.lastWord.execCommand("forecolor",0,rspkr.Common.Settings.get("settings.hltext"))))));},setTextStyle:function(e,d,j){var l=/word/.test(e)?"word":"sent",k="background-color";j=j||g.enums.key;/underline/.test(d)?(k="text-decoration",d+=" !important; background-color: none !important"):/none/.test(d)?(k="background",d+=" !important; text-decoration: none !important; background-color: none !important"):"hltext"===e?(e=d,d=this.getStyleString(rspkr.Common.Settings.get("hlsent"),e),e=this.getStyleString(rspkr.Common.Settings.get("hlword"),e),rspkr.Common.css.replaceRule(j,"."+g.enums.word_hl,k+": "+e)):d+=" !important; text-decoration: none !important; color: "+rspkr.Common.Settings.get("hltext")+" !important";rspkr.Common.css.replaceRule(j,"."+g.enums[l+"_hl"],k+": "+d);},getStyleString:function(e,d){var j=/underline|none/i.test(e)?"none":e,k=/underline/i.test(e)?"underline":"none";return j+" !important; text-decoration: "+k+" !important; color: "+d+" !important";}};return{meta:{revision:"3975"},init:function(){var a=rspkr.Common.addEvent;a("onAfterModsLoaded",function(){a("onAPIInitAdapter",rspkr.HL.Restore.setRestoreContent);rspkr.HL.addEvents();rspkr.HL.Scroll.initScroll();b=document.selection&&(9>rspkr.Common.data.browser.version||9>document.documentMode)?"explorer":"gecko";rspkr.log("[rspkr.hl] Using engine "+b);var j=rspkr.HL.engine[b].clientExtension,e;for(e in j){f[e]=j[e];}window.addEventListener&&window.addEventListener("message",rspkr.HL.html5.receiveMessage,!1,!0);});a("onModsLoaded",{func:g.setHL,context:g});a("onSettingsChanged",{func:g.updateHL,context:g});var d=rspkr.HL,c=document.createElement("audio");d.chunking={html5support:!!c.canPlayType,close:function(){var j=$rs.get(".rsresume");$rs.isArray(j)||(j=[j]);for(var e=0,k;k=j[e];e++){k.parentElement.removeChild(k);}},silence:function(){rspkr.HL.chunking.entracte&&rspkr.HL.chunking.entracte.src&&(rspkr.HL.chunking.entracte.pause(),rspkr.HL.chunking.entracte.currentTime&&(rspkr.HL.chunking.entracte.currentTime=0));},kill:function(){rspkr.HL.chunking.timer&&clearTimeout(rspkr.HL.chunking.timer);rspkr.HL.chunking.continueHref=null;rspkr.HL.chunking.stall=null;rspkr.HL.chunking.chunkEnded=null;rspkr.HL.chunking.currentChunkNumber=1;rspkr.HL.chunking.entracte&&rspkr.HL.chunking.entracte.removeAttribute("src");},destroy:function(){rspkr.HL.chunking.silence();rspkr.HL.chunking.close();rspkr.HL.chunking.kill();}};rspkr.HL.chunking.currentChunkNumber=1;a("onChunkResume",function(){rspkr.HL.chunking.silence();var j=rspkr.ui.getActivePlayer().getContainer();if($rs.hasClass(j,"rsautopaused")||!$rs.hasClass(j,"rspaused")){if(rspkr.HL.chunking.stall){setTimeout(function(){rspkr.c.dispatchEvent("onChunkResume",window);},250);}else{$rs.removeClass(j,"rsautopaused");clearTimeout(rspkr.HL.chunking.timer);var j=rspkr.HL.chunking.continueHref.replace("%{AUDIOFORMAT}",rspkr.Common.data.browser.html5AudioFormat),e=rspkr.HL.chunking.continueHref.replace("%{AUDIOFORMAT}","html5iframe");rspkr.HL.chunking.continueHref=void 0;rspkr.HL.html5.audioUrl=j.replace(/&amp;/g,"&");rspkr.HL.html5.frameUrl=e.replace(/&amp;/g,"&");rspkr.HL.html5.initSyncFrame();rspkr.HL.html5.initAudio();rspkr.ui.getActivePlayer().play();rspkr.HL.chunking.currentChunkNumber++;}}});rspkr.log("[rspkr.HL] Initialized!");},addEvents:function(){rspkr.log("[rspkr.HL.addEvents]");var a=rspkr.Common.addEvent;a("onUIClosePlayer",rspkr.HL.sync.lightCleanUp);a("onUIClosePlayer",rspkr.HL.cleanUpHandler);a("onUIClosePlayer",function(){rspkr.hl.State.setState(rspkr.hl.State.READY);});a("onUIStop",function(){rspkr.hl.State.setState(rspkr.hl.State.STOPPED);});a("onUIBeforePlay",function(){rspkr.hl.Restore.checkContent();});rspkr.PlayerAPI&&rspkr.PlayerAPI.adapter&&"html5"===rspkr.PlayerAPI.adapter&&(rspkr.evt("onAPIInitAdapter",rspkr.HL.html5.handlers.init),rspkr.evt("onAPIPlay",rspkr.HL.html5.handlers.play),rspkr.evt("onAPIPause",rspkr.HL.html5.handlers.pause),rspkr.evt("onAPIStop",rspkr.HL.html5.handlers.stop),rspkr.evt("onAPIRewind",rspkr.HL.html5.handlers.updateTime),rspkr.evt("onAPISetProgress",rspkr.HL.html5.handlers.updateTime),rspkr.evt("onAPIReleaseAdapter",rspkr.HL.html5.handlers.release));rspkr.evt("onAPIStop",rspkr.HL.sync.lightCleanUp);},cleanUpHandler:function(a){rspkr.log("[rspkr.HL.cleanUpHandler] String is: "+a);"userclick"===a||"nosel"===a?rspkr.HL.sync.fullCleanUp():rspkr.HL.sync.lightCleanUp();},clientMarkup:f,serverMarkup:h,markedUpHTML:[],html5:{States:{BEGIN:0,STOPPED:1,USER_START_NOT_READY:2,USER_START_PLAYING:3,NOT_PLAYING:4,CURRENT:0,setState:function(a){this.CURRENT=a;rspkr.log("[rspkr.hl.html5.States.setState] Changing state from "+this.CURRENT+" to "+a,1);}},Events:{canPlay:!1,durationChange:!1,syncReady:!1,eventTimer:null,onCanPlay:function(){rspkr.log("onCanPlay fired!",1);this.canPlay=!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh();},2500);return !1;},checkCompletion:function(){this.canPlay&&this.durationChange&&this.syncReady&&(clearTimeout(this.eventTimer),this.eventTimer=null,rspkr.hl.html5.Events.resetAll(),rspkr.hl.html5.refresh());},onDurationChange:function(){rspkr.log("onDurationChange fired!",1);this.durationChange=!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh();},2500);},onSyncReady:function(){rspkr.log("onSyncReady fired!",1);this.syncReady=!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh();},2500);},resetAll:function(){this.syncReady=this.durationChange=this.canPlay=!1;}},lastcurrenttime:-1,currentsyncindex:0,lastevent:null,lastlastevent:null,lastlastlastevent:null,synclist:[],synclistindex:0,audioUrl:null,backupUrl:null,frameUrl:null,timer:null,postMessageData:[],runningRefresh:!1,handlers:{init:function(){rspkr.log("[rspkr.HL.html5.handlers.init]");rspkr.HL.html5.cronologyCheck={proxyCallsDone:!1,errorOccured:!1,quarantine:[]};rspkr.HL.html5.rshlendCall=!1;var d=Math.random(),c={};c.audioformat=rspkr.Common.data.browser.html5AudioFormat;c.requestgrouptype="html5iframe";c.requestgroup=d;window.rshlcontinue&&"function"==typeof window.rshlcontinue&&-1!=Object.keys(rspkr.Common.e).indexOf("onChunkResume")&&(c.chunk=1);rspkr.HL.html5.backupUrl=rspkr.Common.data.getAudioLink(c);(!0===rspkr.cfg.item("general.usePost")||0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)&&"iOS"!==rspkr.Common.data.browser.OS&&"Android"!==rspkr.Common.data.browser.OS&&"Windows Phone"!==rspkr.Common.data.browser.OS?rspkr.HL.html5.timer=setTimeout(function(){rspkr.HL.html5.initSyncFrame(c);rspkr.HL.html5.initAudio();clearTimeout(rspkr.HL.html5.timer);},2000):(rspkr.log("Normal audio init!"),rspkr.HL.html5.initSyncFrame(c),rspkr.HL.html5.initAudio());},play:function(){rspkr.log("[rspkr.HL.html5.handlers.play]");rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&rspkr.hl.html5.States.CURRENT==rspkr.hl.html5.States.STOPPED?(rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN),rspkr.PlayerAPI.playerRef.pause(),rspkr.HL.html5.handlers.runPostMessages()):rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&rspkr.hl.html5.States.CURRENT==rspkr.hl.html5.States.STOPPED?rspkr.hl.State.setState(rspkr.hl.State.RELOAD)?this.init():(rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN),rspkr.PlayerAPI.playerRef.pause(),rspkr.HL.html5.handlers.runPostMessages()):(rspkr.hl.html5.States.CURRENT=rspkr.hl.html5.States.USER_START_PLAYING,rspkr.hl.html5.refresh());},pause:function(){rspkr.hl.html5.States.setState(rspkr.hl.html5.States.NOT_PLAYING);rspkr.hl.html5.lastcurrenttime=0;},release:function(){rspkr.log("[rspkr.HL.html5.handlers.release]");rspkr.HL.html5.synclist=[];rspkr.HL.html5.synclistindex=0;rspkr.HL.html5.currentsyncindex=0;rspkr.HL.html5.lastcurrenttime=-1;rspkr.HL.html5.audioUrl=null;rspkr.HL.html5.backupUrl=null;rspkr.HL.html5.frameUrl=null;rspkr.HL.html5.postMessageData=[];rspkr.HL.html5.Events.resetAll();rspkr.PlayerAPI.playerRef&&rspkr.PlayerAPI.playerRef.removeEventListener("ended",rshlexit,!1);rspkr.PlayerAPI.playerRef=null;var a=document.getElementById("ReadSpeaker_sync_iframe");a&&(a.src="about:blank");},stop:function(){rspkr.hl.html5.States.setState(rspkr.hl.html5.States.STOPPED);rspkr.HL.html5.lastcurrenttime=-1;rspkr.HL.html5.currentsyncindex=0;},updateTime:function(){rspkr.log("[rspkr.HL.html5.handlers.updateTime]");rspkr.hl.html5.States.setState(rspkr.hl.html5.States.NOT_PLAYING);rspkr.HL.html5.lastcurrenttime=rspkr.PlayerAPI.playerRef.currentTime;rspkr.HL.html5.currentsyncindex=0;rspkr.HL.html5.handlers.setCurrentSyncIndex();rspkr.hl.html5.States.setState(rspkr.hl.html5.States.USER_START_PLAYING);},runPostMessages:function(){rspkr.log("[rspkr.HL.html5.handlers.runPostMessages]");var d=rspkr.HL.html5.postMessageData,c;for(c in d){null!==d[c-1]&&"rshlsetContent"==d[c]?rspkr.HL.sync.setContent(rspkr.Common.base64.decode(d[c-1])):null!==d[c-1]&&"rshlsetId"==d[c]?rspkr.HL.sync.setId(d[c-1]):"rshlinit"==d[c]&&(rspkr.HL.sync.init(),rspkr.PlayerAPI.playerRef.play(),rspkr.HL.html5.refresh());}},setCurrentSyncIndex:function(){if(0<rspkr.HL.html5.synclist.length&&rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex]){for(;rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex]&&20>=1*rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex][0]-1000*rspkr.PlayerAPI.playerRef.currentTime;){rspkr.HL.html5.currentsyncindex++;}}},totalTime:function(){var d=rspkr.PlayerAPI.playerRef;if(d){if("Opera"!==rspkr.Common.data.browser.name&&d.buffered&&d.buffered.end){try{return 0<d.buffered.length?d.buffered.end(d.buffered.length-1):d.buffered.end(0);}catch(c){return d.duration&&"infinity"!==d.duration.toString().toLowerCase()&&"NaN"!==d.duration?d.duration:d.currentTime+15;}}else{return d.duration&&"infinity"!==d.duration.toString.toLowerCase()&&"NaN"!==d.duration?d.duration:d.currentTime+15;}}}},initAudio:function(){rspkr.HL.html5.audioUrl||(rspkr.HL.html5.audioUrl=rspkr.HL.html5.backupUrl);rspkr.log("[rspkr.html5.initAudio] Audio URL: "+rspkr.HL.html5.audioUrl,1);/windows phone|ios|android/i.test(rspkr.c.data.browser.OS)&&"object"===typeof window.rspkr.audio&&null!==window.rspkr.audio?(rspkr.audio.src=rspkr.HL.html5.audioUrl,rspkr.PlayerAPI.playerRef=rspkr.audio,rspkr.log("[rs.hl.initAudio] Reusing existing audio element.",4)):rspkr.PlayerAPI.playerRef=new Audio(rspkr.HL.html5.audioUrl);var a=rspkr.PlayerAPI.playerRef;a.loop=!1;a.preload="auto";a.volume=parseFloat((rspkr.st.get("hlvol")||100)/100);rspkr.devt("onVolumeAdjusted",window);/ios|android|windows phone/i.test(rspkr.c.data.browser.OS)&&(rspkr.PlayerAPI.playerRef.play(),rspkr.PlayerAPI.playerRef.pause());a.addEventListener("canplay",function(){rspkr.hl.html5.Events.onCanPlay();},!1);a.addEventListener("durationchange",function(){rspkr.log("[rspkr.hl.html5.initAudio] Durationchange occurred",1);1==rspkr.HL.html5.handlers.totalTime()&&1==rspkr.PlayerAPI.playerRef.paused?rspkr.HL.html5.initAudio():(0===rspkr.HL.html5.handlers.totalTime()&&rspkr.pl.playerRef.play(),rspkr.hl.html5.Events.onDurationChange());},!1);rspkr.PlayerAPI.playerRef.addEventListener("ended",function(){rs.HL.chunking.continueHref?window.rshlcontinue():window.rshlexit("false");},!1);rspkr.pl.checkNetworkStatus();rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN);},initSyncFrame:function(d){if("none"!=rspkr.Common.data.sync){var c=null;document.getElementById("ReadSpeaker_sync_iframe")?c=document.getElementById("ReadSpeaker_sync_iframe"):(c=document.createElement("iframe"),c.setAttribute("id","ReadSpeaker_sync_iframe"),c.setAttribute("title","ReadSpeaker_sync_iframe"),c.setAttribute("aria-hidden","true"),c.height=0,c.width=0,c.style.display="none",document.body.appendChild(c));!rspkr.HL.html5.frameUrl&&(!0===rspkr.cfg.item("general.usePost")||0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)?rspkr.HL.html5.frameUrl=rspkr.HL.html5.backupUrl+"sync":rspkr.HL.html5.frameUrl||(d.audioformat="html5iframe",rspkr.HL.html5.frameUrl=rspkr.Common.data.getAudioLink(d));rspkr.log("[rspkr.HL.html5.initSyncFrame] Audio URL: "+rspkr.HL.html5.frameUrl);rspkr.HL.html5.frameUrl&&(c.src=rspkr.HL.html5.frameUrl,c.type="text/javascript");}else{rspkr.hl.html5.States.setState(rspkr.hl.html5.States.USER_START_PLAYING),rspkr.PlayerAPI.playerRef.play();}},removeSyncFrame:function(){var a=document.getElementById("ReadSpeaker_sync_iframe");a&&a.parentNode.removeChild(a);},receiveMessage:function(e){var d=!0;rspkr.cfg.item("general.servercall")&&(d=document.createElement("a"),$rs.setAttr(d,"href",rspkr.cfg.item("general.servercall")),d=!e.origin.match(d.hostname));if(e.origin.match(/readspeaker.?.com/gi)||e.origin.match(/79.136.80./gi)||e.origin.match(/173.205.5./gi)||e.origin.match(/2001:668:1F:2A/gi)||e.origin.match(/2001:9b0:2:703/gi)||e.origin.match(rspkr.cfg.item("general.domain"))||!d){if(!0===rspkr.cfg.item("general.usePost")){var j=rspkr.HL.html5.cronologyCheck;if("rshlend"===e.data&&j.quarantine&&0<j.quarantine.length){j.errorOccured=!1,j.cleanUpTimer=setInterval(function(){if(0<j.quarantine.length){var a=j.quarantine.shift();window.postMessage(a,"*");}else{clearInterval(j.cleanUpTimer);}},0);}else{if("rshlendpost"===e.data){j.proxyCallsDone=!0;}else{if((!j.proxyCallsDone||j.errorOccured)&&"http"!==e.data.substring(0,4)&&"rshlaudio"!==e.data&&"rshlhtml5sync"!==e.data&&"rshlfinished"!==e.data){j.errorOccured=!0;j.quarantine.push(e.data);return;}}}}rspkr.HL.html5.postMessageData.push(e.data);!/android|ios|windows phone/i.test(rspkr.Common.data.browser.OS)&&"rshlfinished"==e.data&&(rspkr.HL.html5.timer&&clearTimeout(rspkr.HL.html5.timer),rspkr.HL.html5.initSyncFrame(),rspkr.HL.html5.initAudio());if("rshlend"===e.data){rspkr.HL.html5.rshlendCall=!0,rspkr.c.post.removeIframe(),rspkr.HL.html5.removeSyncFrame();}else{if(-1!=e.data.indexOf("."+rspkr.Common.data.browser.html5AudioFormat)){e=rs.cfg.item("general.customProxy")?rs.cfg.item("general.customProxy")+encodeURIComponent(e.data):e.data;rspkr.HL.html5.audioUrl=e;return;}if(-1!=e.data.indexOf(".html5iframe")){e=rs.cfg.item("general.customProxy")?rs.cfg.item("general.customProxy")+encodeURIComponent(e.data):e.data;rspkr.HL.html5.frameUrl=e;return;}if("rshlaudio"==e.data||"rshlhtml5sync"==e.data){return;}null!=rspkr.HL.html5.lastevent&&"rshlsetContent"==e.data?(rspkr.HL.html5.synclist=[],rspkr.HL.html5.synclistindex=0,rspkr.HL.sync.setContent(rspkr.Common.base64.decode(rspkr.HL.html5.lastevent.data))):null!=rspkr.HL.html5.lastevent&&"rshlsetId"==e.data?rspkr.HL.sync.setId(rspkr.HL.html5.lastevent.data):null!=rspkr.HL.html5.lastevent&&"rshlReplace"==e.data?(rspkr.HL.html5.lastevent.data.match(/class=[^&|,]+/gi)&&(d=rspkr.HL.html5.lastevent.data.match(/class=[^&|,]+/gi)[0].replace("class=",""),rspkr.HL.sync.setClass(d)),rspkr.HL.html5.lastevent.data.match(/id=[^&|,]+/gi)&&(d=rspkr.HL.html5.lastevent.data.match(/id=[^&|,]+/gi)[0].replace("id=",""),rspkr.HL.sync.setId(d))):"rshlinit"==e.data?(rspkr.HL.sync.init(),rspkr.hl.html5.Events.onSyncReady()):null!=rspkr.HL.html5.lastlastlastevent&&null!=rspkr.HL.html5.lastlastevent&&null!=rspkr.HL.html5.lastevent&&"rshlsync"==e.data?(rspkr.HL.html5.synclist[rspkr.HL.html5.synclistindex]=[rspkr.HL.html5.lastlastlastevent.data,rspkr.HL.html5.lastlastevent.data,rspkr.HL.html5.lastevent.data],rspkr.HL.html5.synclistindex++):null!=rspkr.HL.html5.lastevent&&"rshlcontinue"==e.data?(rs.HL.chunking.continueHref=rspkr.HL.html5.lastevent.data,rs.HL.chunking.continueTime=rspkr.HL.html5.lastlastevent&&!isNaN(rspkr.HL.html5.lastlastevent.data)?rspkr.HL.html5.lastlastevent.data:-1,/ios|android|windows phone/i.test(rspkr.c.data.browser.OS)&&(rspkr.HL.chunking.continueTime=-1)):"rshlresume"==e.data&&(rspkr.HL.html5.synclist.length=0,rspkr.HL.html5.synclistindex=0,rspkr.HL.html5.currentsynclistindex=0,rspkr.HL.html5.currentsyncindex=0);}rspkr.HL.html5.lastlastlastevent=rspkr.HL.html5.lastlastevent;rspkr.HL.html5.lastlastevent=rspkr.HL.html5.lastevent;rspkr.HL.html5.lastevent=e;}},refresh:function(){var d=rspkr.PlayerAPI.playerRef,c=rspkr.HL.html5;d&&c.States.CURRENT!=c.States.STOPPED?(c.States.CURRENT==c.States.NOT_PLAYING&&setTimeout(function(){c.refresh();},500),0<d.currentTime&&parseInt(c.lastcurrenttime)>parseInt(Math.ceil(d.currentTime))?(rspkr.log("[rspkr.hl.html5.refresh] An error has occurred. Player is stopped.",2),rspkr.ui.getActivePlayer().stop(),c.runningRefresh=!1):(c.lastcurrenttime=d.currentTime,c.runningRefresh=!0,c.States.CURRENT==c.States.BEGIN?(rspkr.hl.html5.States.setState(c.States.USER_START_NOT_READY),setTimeout(function(){c.refresh();},200)):c.States.CURRENT==c.States.USER_START_NOT_READY?0<c.handlers.totalTime()&&(rspkr.HL.html5.rshlendCall||c.synclist[c.currentsyncindex]&&c.synclist[c.currentsyncindex][0]<1000*c.handlers.totalTime())?(rspkr.hl.html5.States.setState(c.States.USER_START_PLAYING),d.play(),setTimeout(function(){c.refresh();},50)):0===c.handlers.totalTime()?(d.play(),setTimeout(function(){c.refresh();},250)):c.synclist[c.currentsyncindex]?20>=1*c.synclist[c.currentsyncindex][0]-1000*d.currentTime?setTimeout(function(){c.refresh();},0):(d=1*c.synclist[c.currentsyncindex][0]-1000*d.currentTime-20,75<d?setTimeout(function(){c.refresh();},75):0>d?setTimeout(function(){c.refresh();},0):setTimeout(function(){c.refresh();},d)):setTimeout(function(){c.refresh();},75):c.States.CURRENT==c.States.USER_START_PLAYING&&(c.synclist[c.currentsyncindex]&&1*c.synclist[c.currentsyncindex][0]-20<1000*d.currentTime&&(rspkr.HL.sync.execute(c.synclist[c.currentsyncindex][1],c.synclist[c.currentsyncindex][2]),c.currentsyncindex++),c.synclist[c.currentsyncindex]?20>=1*c.synclist[c.currentsyncindex][0]-1000*d.currentTime?setTimeout(function(){c.refresh();},0):(d=1*c.synclist[c.currentsyncindex][0]-1000*d.currentTime-20,75<d?setTimeout(function(){c.refresh();},75):0>d?setTimeout(function(){c.refresh();},0):setTimeout(function(){c.refresh();},d)):setTimeout(function(){c.refresh();},75)))):(rspkr.log("[rspkr.hl.html5.refresh] Audio is undefined or player is stopped",2),c.runningRefresh=!1);}},Preserve:{cls:".rs_preserve",testElem:null,elementShelter:[],formShelter:[],formData:function(j,e,k,l,m){this.name=j;this.type=e;this.value=k;this.checked=l;this.selectedIndex=m;this.selectedOptions=[];},moveToShelter:function(k){rspkr.HL.Preserve.cls=rspkr.cfg.item("general.preserveElements")?rspkr.cfg.item("general.preserveElements"):rspkr.HL.Preserve.cls;rspkr.log("[rspkr.HL.Preserve.moveToShelter]");var j=[],m=[],o=null,q=[];if(k.childNodes){for(var p=$rs.findIn(k,rspkr.HL.Preserve.cls),p=$rs.isArray(p)?p:[p],o=0;o<p.length;o++){for(var r=o+1;r<p.length;r++){$rs.isArray($rs.findIn(p[o],p[r]))?$rs.isArray($rs.findIn(p[r],p[o]))||(p.splice(o,1),o--,r=p.length):(p.splice(r,1),r--);}}for(o=0;o<p.length;o++){q.push(p[o]);}}p=0;for(r=q.length;p<r;p++){o=$rs.get(q[p]).cloneNode(!1),q[p].parentNode.insertBefore(o,q[p]),j.push($rs.detach(q[p]));}rspkr.log("[rspkr.hl.Preserve] Moved "+p+" nodes to the shelter.");k=$rs.findIn(k,"input, select");for(p=0;p<k.length;p++){q=new rspkr.HL.Preserve.formData(k[p].name,k[p].type,k[p].value,k[p].checked,k[p].selectedIndex);if("select-multiple"==k[p].type){for(var o=k[p].options,r=[],s=0;s<o.length;s++){r.push(o[s].selected);}q.selectedOptions=r;}m.push(q);}rspkr.HL.Preserve.elementShelter.push(j);rspkr.HL.Preserve.formShelter.push(m);},restoreFromShelter:function(k){var j=[],l,n;rspkr.log("[rspkr.HL.Preserve.restoreFromShelter]");if(rspkr.HL.Preserve.elementShelter.length&&(n=rspkr.HL.Preserve.elementShelter.shift(),n.length)){if(k.childNodes){var o=$rs.findIn(k,rspkr.HL.Preserve.cls),o=$rs.isArray(o)?o:[o];for(l=0;l<o.length;l++){for(var m=l+1;m<o.length;m++){$rs.isArray($rs.findIn(o[l],o[m]))?$rs.isArray($rs.findIn(o[m],o[l]))||(o.splice(l,1),l--,m=o.length):(o.splice(m,1),m--);}}for(l=0;l<o.length;l++){j.push(o[l]);}}o=0;for(m=j.length;o<m;o++){l=n.shift(),j[o].parentNode.insertBefore(l,j[o]),j[o].parentNode.removeChild(j[o]);}}if(rspkr.HL.Preserve.formShelter.length&&(k=$rs.findIn(k,"input, select"),j=rspkr.HL.Preserve.formShelter.shift(),k.length&&j.length&&k.length===j.length)){for(o=0;o<k.length;o++){if(k[o].name===j[o].name){switch(k[o].type){case"text":k[o].value=j[o].value;break;case"password":k[o].value=j[o].value;break;case"radio":!0===j[o].checked&&(k[o].checked=!0);break;case"checkbox":k[o].checked=j[o].checked;break;case"select-one":k[o].selectedIndex=j[o].selectedIndex;break;case"select-multiple":for(n=k[o].options,l=0;l<n.length;l++){n[l].selected=j[o].selectedOptions[l];}}}}}},clearShelter:function(){rspkr.log("[rspkr.HL.Preserve.clearShelter]");rspkr.HL.Preserve.elementShelter=[];rspkr.HL.Preserve.formShelter=[];}},Restore:{Storage:{readClass:[],readId:[],restoreContent:[]},all:function(){rspkr.log("[rspkr.HL.Restore.all]");var j=rspkr.HL.Restore.Storage,k=[],l=null,n=/sync_(word|sent)/gi;if(!rspkr.cfg.item("general.premarkup")){rspkr.c.dispatchEvent("onBeforeContentChange",window);if(j.readId.length||j.restoreContent.length||j.readClass.length){var l=$rs.flatten?$rs.flatten(j.readClass):j.readClass,o=$rs.flatten?$rs.flatten(j.readId):j.readId,l=l.length?("."+l.join(",.")).split(","):[],l=o.length?l.concat(("#"+o.join(",#")).split(",")):l;if(rspkr.cfg.item("general.readidOrder")&&rspkr.cfg.item("general.usePost")){for(o=0;o<l.length;o++){var p=$rs.get(l[o]);$rs.isArray(p)&&0<p.length?k.concat(p):$rs.isArray(p)||k.push(p);}}else{o=0;for(p=l.length;o<p;o++){k.push($rs.get(l[o]));}k=$rs.flatten(k);}$rs.isArray(k)||(k=[k]);for(o=0;l=k[o];o++){!0===n.test(l.innerHTML)&&(rspkr.HL.Preserve.moveToShelter(l),l.innerHTML=j.restoreContent[o],rspkr.HL.Preserve.restoreFromShelter(l));}}else{rspkr.log("No stored content exists!",2);}rspkr.c.dispatchEvent("onAfterContentChange",window);}j.readId.length=0;j.readClass.length=0;},checkContent:function(){rspkr.log("[rspkr.hl.Restore.checkContent]",1);!1===this.hasMarkup()&&rspkr.hl.State.CURRENT==rspkr.hl.State.STOPPED&&rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&(this.clearRestoreContent(),this.setRestoreContent(),rspkr.pl.releaseAdapter(),rspkr.hl.State.setState(rspkr.hl.State.RELOAD));},hasMarkup:function(){var j=rspkr.HL.Restore.Storage,k=[],l=null,n=/sync_(word|sent)/gi,l=$rs.flatten?$rs.flatten(j.readClass):j.readClass,o=$rs.flatten?$rs.flatten(j.readId):j.readId,l=l.length?("."+l.join(",.")).split(","):[],l=o.length?l.concat(("#"+o.join(",#")).split(",")):l;if(rspkr.cfg.item("general.readidOrder")&&rspkr.cfg.item("general.usePost")){for(o=0;o<l.length;o++){var p=$rs.get(l[o]);$rs.isArray(p)&&0<p.length?k.concat(p):$rs.isArray(p)||k.push(p);}}else{k=$rs.get(l.join(","));}$rs.isArray(k)||(k=[k]);if(k.length&&j.restoreContent.length){for(o=0;l=k[o];o++){if(n.test(l.innerHTML)){return !0;}}}return !1;},clearRestoreContent:function(){rspkr.log("[rspkr.HL.Restore.clearRestoreContent] Called!");},setRestoreContent:function(){rspkr.log("[rspkr.HL.Restore.setRestoreContent] Called!");if("Explorer"===rs.c.data.browser.name&&9>=rs.c.data.browser.version){for(var j=document.body.getElementsByTagName("style"),k=0,o;o=j[k];k++){o.parentNode.removeChild(o);document.getElementsByTagName("head")[0].appendChild(o);var p=o.innerHTML;if(-1!=p.indexOf("@import")){for(var q=p.split("\n"),s,p=0,r;r=q[p];p++){if("@import"===r.substring(0,7)){p=r.replace(/;/g,"").replace("@import ","").replace("url(","").replace(")","").replace(/\"/g,"").replace(/\'/g,"").split(" ");for(q=0;q<p.length;q++){var t=p[q].replace(/ /g,"");if(t){s=t;break;}}break;}}o=o.sheet?o.sheet:o.styleSheet;o.insertRule?o.insertRule(r,0):o.addImport&&o.addImport(s);}}}j=rspkr.HL.Restore.Storage;k=[];s=/sync_(word|sent|user)/gi;r=j.restoreContent;0===j.readClass.length&&0===j.readId.length&&rspkr.HL.Restore.getReadData();if(0==j.readClass.length&&0==j.readId.length){rspkr.log("ERR: Could not set restore content or find the read area data",3);}else{o=$rs.flatten?$rs.flatten(j.readClass):j.readClass;p=$rs.flatten?$rs.flatten(j.readId):j.readId;o=o.length?("."+o.join(",.")).split(","):[];o=p.length?o.concat(("#"+p.join(",#")).split(",")):o;if(rspkr.cfg.item("general.readidOrder")&&rspkr.cfg.item("general.usePost")){for(p=0;p<o.length;p++){q=$rs.get(o[p]),$rs.isArray(q)&&0<q.length?k.concat(q):$rs.isArray(q)||k.push(q);}}else{k=$rs.get(o.join(","));}$rs.isArray(k)||(k=[k]);j.restoreContent=[];for(p=0;o=k[p];p++){!1===s.test(o.innerHTML)?j.restoreContent.push(o.innerHTML):0<r.length&&r[p]?j.restoreContent.push(r[p]):j.restoreContent.push(o.innerHTML);}}},getReadData:function(){rspkr.log("[rspkr.HL.Restore.getReadData]");var j=rspkr.HL.Restore.Storage,k;k=rspkr.ui.getActivePlayer()?$rs.findIn(rspkr.ui.getActivePlayer().getContainer(),".rsbtn_play"):$rs.findIn($rs.get("."+rs.ui.rsbtnClass),".rsbtn_play");$rs.isArray(k)||(k=[k]);for(var l=0,m=k.length;l<m;l++){var n=k[l].getAttribute("href").match(/readspeaker.?.com\/cgi-bin\/.*rsent/gi);rspkr.cfg.item("general.servercall")&&(n=n?n:-1<k[l].getAttribute("href").indexOf(rspkr.cfg.item("general.servercall")));k[l].getAttribute("href")&&-1!==(k[l].getAttribute("href").indexOf(rspkr.cfg.item("general.domain")+"/cgi-bin/"+rspkr.cfg.item("general.rsent"))||n)&&"rsSaveBtn"!==k[l].id&&"rs_selimg"!==k[l].id&&(-1!==k[l].getAttribute("href").search(/readclass=/)&&(n=k[l].getAttribute("href").match(/readclass=[^&]+/gi)[0].replace("readclass=",""),n=n.split(","),rspkr.HL.Restore.Storage.readClass.push(n)),-1!==k[l].getAttribute("href").search(/readid=/)&&(n=k[l].getAttribute("href").match(/readid=[^&]+/gi)[0].replace("readid=",""),n=n.split(","),rspkr.HL.Restore.Storage.readId.push(n)));}0===j.readClass.length&&0===j.readId.length&&(rspkr.c.data.params.hasOwnProperty("readid")?j.readId.push([rspkr.c.data.params.readid]):rspkr.c.data.params.hasOwnProperty("readclass")&&j.readClass.push([rspkr.c.data.params.readclass]));}},Scroll:{currentSpan:null,timer:null,useScroll:!1,userScrollTimer:null,stopped:!0,getScrollY:function(){var c=0;"number"==typeof document.pageYOffset?c=document.pageYOffset:document.documentElement&&document.documentElement.scrollTop&&0<document.documentElement.scrollTop?c=document.documentElement.scrollTop:document.body&&document.body.scrollTop&&(c=document.body.scrollTop);return c;},getWindowHeight:function(){var c=0;"number"==typeof window.innerHeight?c=window.innerHeight:document.documentElement&&document.documentElement.clientHeight&&0<document.documentElement.clientHeight?c=document.documentElement.clientHeight:document.body&&document.body.clientHeight&&(c=document.body.clientHeight);return c+30;},userScroll:function(){rspkr.HL.Scroll.timer&&(clearTimeout(rspkr.HL.Scroll.timer),rspkr.HL.Scroll.timer=null);rspkr.HL.Scroll.userScrollTimer&&clearTimeout(rspkr.HL.Scroll.userScrollTimer);rspkr.HL.Scroll.userScrollTimer=setTimeout(function(){rspkr.HL.Scroll.userScrollTimer=null;},5000);},stopTimer:function(){rspkr.log("[rspkr.Hl.Scroll.stopTimer] Called!");rspkr.HL.Scroll.timer&&(clearTimeout(rspkr.HL.Scroll.timer),rspkr.HL.Scroll.timer=null);rspkr.HL.Scroll.stopped=!0;},initScroll:function(){"scrollon"==rspkr.Common.Settings.get("hlscroll")?(rspkr.log("[rspkr.HL.Sroll.initScroll] Scroll initiated!"),rspkr.HL.Scroll.useScroll=!0,rspkr.evt("onUIClosePlayer",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUIStop",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUIPause",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUISliderMove",rspkr.HL.Scroll.userScroll),rspkr.evt("onFocusIn",rspkr.HL.Scroll.userScroll),rspkr.evt("onFocusOut",rspkr.HL.Scroll.userScroll),document.addEventListener?document.addEventListener("scroll",function(){setTimeout(function(){rspkr.HL.Scroll.userScroll();},0);},!1):document.attachEvent?document.attachEvent("onscroll",rspkr.HL.Scroll.userScroll):document.onscroll=rspkr.HL.Scroll.userScroll):this.useScroll=!1;},execScroll:function(c){this.useScroll&&(this.currentSpan=c,!0===this.stopped&&(this.stopped=!1),this.timer||(rspkr.log("[rspkr.hl.Scroll] execScroll"),this.timer=setTimeout(function(){rspkr.HL.Scroll.timer=null;rspkr.HL.Scroll.triggerScroll(rspkr.HL.Scroll.currentSpan);},500)));},triggerScroll:function(c){rspkr.log("[rspkr.HL.Scroll.triggerScroll] timer: "+rspkr.hl.Scroll.userScrollTimer+", stopped: "+rspkr.HL.Scroll.stopped);!rspkr.HL.Scroll.userScrollTimer&&!1===rspkr.HL.Scroll.stopped&&rspkr.u.scroll.scrollToElm(c);}},State:{CURRENT:1,READY:1,STOPPED:2,PLAYING:3,RELOAD:4,setState:function(c){this.CURRENT=c;rspkr.log("[rspkr.hl.html5.States.setState] Changing state from "+this.CURRENT+" to "+c,1);}},sync:{init:function(){rspkr.c.dispatchEvent("onBeforeSyncInit",window);g.hlChanged=!1;if(0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length){rspkr.log("[rspkr.HL._sync.init] client markup"),rspkr.HL.Type.CURRENT=rspkr.HL.Type.CLIENT_MARKUP,f.firstRun=1,"explorer"==b?document.selection.empty():f.preProcess.identifyElementsReplacementNode(document.body);}else{if(rspkr.log("[rspkr.HL._sync.init] server markup"),rspkr.HL.Type.CURRENT=rspkr.HL.Type.SERVER_MARKUP,"none"!=rspkr.Common.data.sync){var a=[],c=[],k=[];rspkr.c.data.params.hasOwnProperty("readid")&&rspkr.c.data.params.readid.length&&(k=k.concat(("#"+rspkr.c.data.params.readid.split(",").join(",#")).split(",")));rspkr.c.data.params.hasOwnProperty("readclass")&&rspkr.c.data.params.readclass.length&&(k=k.concat(("."+rspkr.c.data.params.readclass.split(",").join(",.")).split(",")));if(rspkr.cfg.item("general.readidOrder")&&rspkr.cfg.item("general.usePost")){for(var j=0;j<k.length;j++){var d=$rs.get(k[j]);$rs.isArray(d)&&0<d.length?a.concat(d):$rs.isArray(d)||a.push(d);}}else{a=$rs.get(k.join(","));}$rs.isArray(a)||(a=[a]);if("flash"==rspkr.PlayerAPI.adapter){for(k=rspkr.HL.markedUpHTML.join("").split("\x3c!--RSPEAK_STOP--\x3e"),j=0;k[j];j++){}}else{k=rspkr.HL.markedUpHTML;}for(j=0;d=a[j];j++){d=d.nodeName&&"TABLE"==d.nodeName?document.createElement("TABLE"):document.createElement("DIV"),d.innerHTML=k[j],c.push(d);}rspkr.log("[rspkr.HL.sync.init] readElements length: "+a.length);if(!rspkr.cfg.item("general.premarkup")){rspkr.c.dispatchEvent("onBeforeContentChange",window);for(j=0;j<a.length;j++){rspkr.HL.Preserve.moveToShelter(a[j]),a[j].innerHTML=c[j].innerHTML,rspkr.HL.Preserve.restoreFromShelter(a[j]);}rspkr.c.dispatchEvent("onAfterContentChange",window);rspkr.HL.Preserve.clearShelter();}}}rspkr.HL.markedUpHTML.length=0;rspkr.c.post.removeIframe();rspkr.c.dispatchEvent("onAfterSyncInit",window);},lightCleanUp:function(){rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.cleanUp();rspkr.log("[rspkr.HL._sync.lightCleanUp] Called! "+rspkr.HL.Type.CURRENT);rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&!0===g.hlChanged?f.postProcess.settingsCleanUp():rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&!1===g.hlChanged||0<rspkr.Common.data.selectedText.length?f.postProcess.lightCleanUp():rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&h.postProcess.lightCleanUp();},fullCleanUp:function(){rspkr.log("[rspkr.HL._sync.fullCleanUp] Called!");rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.cleanUp();rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&f.postProcess.fullCleanUp();h.postProcess.fullCleanUp();},setId:function(){rspkr.log("[rspkr.HL._sync.setId] Called!");},setClass:function(){rspkr.log("[rspkr.HL._sync.setClass] Called!");},setContent:function(c){rspkr.log("[rspkr.HL._sync.setContent] Called!");rspkr.HL.markedUpHTML.push(c);},execute:function(j,k){var l=rspkr.Common.Settings;if("none"!==l.get("hl")&&"hloff"!==l.get("hltoggle")){if(rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP){var m=$rs.hasClass($rs.get("#sync"+k),"sync_sent")?"sent":"word";if("sent"===l.get("hl")&&"word"===m||"word"===l.get("hl")&&"sent"===m){return;}}rspkr.c.dispatchEvent("onBeforeSync",window,[j,k]);rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP?!(l=rspkr.cfg.item("general.selectionEngine"))||"new"!==l&&"newcontent"!==l?rspkr.HL.clientMarkup.sync(j,k):rspkr.HL.clientMarkup.syncNew(j,k):rspkr.HL.serverMarkup.sync(j,k);rspkr.c.dispatchEvent("onAfterSync",window,[j,k]);}}},settings:g,Type:{CURRENT:0,DEFAULT:0,SERVER_MARKUP:1,CLIENT_MARKUP:2}};}();rspkr.HL.engine||(rspkr.HL.engine={});rspkr.HL.engine.explorer=function(){return{clientExtension:{firstRun:0,previousWord:{},previousSent:{},selectionRange:null,selectionHTML:null,selectedWordsRange:[],wordsRangeClasses:[],originalParentContent:"",originalParent:null,preProcess:{bookMarkIndex:1,endNode:null,endOffset:null,excludednodes:"table tr select option textarea ul ol dl thead tbody tfoot colgroup script map optgroup style noscript".split(" "),firstRun:0,inc:0,numberOfSelections:0,startNode:null,startOffset:null,init:function(){this.numberOfSelections++;var b;b="new"===rspkr.cfg.item("general.selectionEngine")||"newcontent"===rspkr.cfg.item("general.selectionEngine")?this.buildMarkupNew(rspkr.Common.data.selectedRange):this.buildMarkup(rspkr.Common.data.selectedRange);b.replace(/  +/g," ");rspkr.Common.data.selectedHTML=b;rspkr.hl.clientMarkup.originalParent=rspkr.c.data.selectedRange.parentElement();rspkr.hl.clientMarkup.originalParentContent=rspkr.c.data.selectedRange.parentElement().innerHTML;},buildMarkup:function(j){for(var t=rspkr.c.data.getParam("lang"),y=!1,w=null,o=rspkr.cfg.item("general.sentOnlyLang"),C=0;C<o.length;C++){if(t&&t.toLowerCase()===o[C]){y=!0;break;}}var t=j.duplicate(),C=0,o="",B=1,A=0,z=0,E="",D="",F=null;j.moveStart("word",-1);j.moveStart("word",1);t.isEqual(j)||j.moveStart("word",-1);t=j.duplicate();j.moveEnd("word",1);j.moveEnd("word",-1);t.isEqual(j)||j.moveEnd("word",1);rspkr.HL.clientMarkup.selectionRange=j.duplicate();var M=j.parentElement(),I=j.duplicate();I.collapse(!1);t=j.duplicate();t.collapse();for(y&&(w=j.text.split(RegExp(decodeURIComponent("%e3%80%81")+"|"+decodeURIComponent("%e3%80%82")+"|"+decodeURIComponent("%DB%94")+"|"+decodeURIComponent("%D8%8C"))));j.inRange(t)&&0!=j.compareEndPoints("EndToEnd",t);){z++;C++;if(10000<C){break;}if(y){if(t=j.duplicate(),w[z-1]){t.findText(w[z-1]);}else{break;}}else{t.collapse(!1),t.expand("word",1);}D=E="";I.collapse(!1);var G=t.duplicate();G.collapse(!1);if(0==I.compareEndPoints("StartToStart",G)&&0==I.compareEndPoints("EndToEnd",G)&&G.htmlText==I.htmlText&&/\W/.test(G.text)){A++;if(2>A){t.move("character",1);}else{if(4>A){t.move("character",2);}else{if(6>A){t.move("word",1);}else{if(8>A){t.move("word",2);}else{if(10>A){t.move("sentence",1);}else{if(12>A){t.move("sentence",2);}else{break;}}}}}}t.collapse(!1);}else{A=0;if(-1===z){return t;}rspkr.HL.clientMarkup.selectedWordsRange[z]=t.duplicate();I=t.text;G=t.htmlText;t.collapse(!1);var L;1===B?(F=t.duplicate(),L=this.iterateParentTree(F.parentElement(),document.body,M,0)):L=this.iterateParentTree(t.parentElement(),F.parentElement(),M,0);for(var K=this.iterateParentTree(F.parentElement(),t.parentElement(),M,0),H=t.parentElement(),J=0;J<L&&20>J;J++){H.className.match("sync_")||(E=H.outerHTML.match("<[^>]*>")[0]+E),H=H.parentElement;}H=F.parentElement();for(J=0;J<K&&20>J;J++){H.className.match("sync_")||(D+="</"+H.tagName+">"),H=H.parentElement;}if(0!=L||0!=K){F=t.duplicate();}1===B?(o+=E,B=0):o+=D+E;""!=G.replace("sync_sent_highlighted","")&&(o+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user" id="sync'+z+'">'+I+"</"+rspkr.Common.data.browser.syncContainer+">");I=t.duplicate();}}o+="\x3c!-- f --\x3e";K=this.iterateParentTree(F.parentElement(),document.body,M,0);H=F.parentElement();for(J=0;J<K;J++){H.className.match("sync_")||(o+="</"+H.tagName+">"),H=H.parentElement;}t.collapse();return o;},buildMarkupNew:function(j){for(var y=rspkr.c.data.getParam("lang"),A=!1,z=rspkr.cfg.item("general.sentOnlyLang"),o=0;o<z.length;o++){if(y&&y.toLowerCase()===z[o]){A=!0;break;}}var y=j.duplicate(),z="",E=1,D=0,C=0,B="",G="",F="",H=null,o=0;rspkr.HL.clientMarkup.selectionRange=j.duplicate();var Q=j.parentElement(),K=j.duplicate(),B=j.duplicate();K.collapse(!1);y.collapse();var I=[],G=B.duplicate(),F=B.duplicate();B.moveStart("sentence",-1);B.moveStart("sentence",1);G.isEqual(B)||B.moveStart("sentence",-1);G=B.duplicate();B.moveEnd("sentence",1);B.moveEnd("sentence",-1);G.isEqual(B)||B.moveEnd("sentence",1);G=B.duplicate();F.collapse(!0);for(B.collapse(!0);G.inRange(B)&&0!=G.compareEndPoints("EndToEnd",B);){F.expand("sentence",1);if(!0===F.isEqual(B)||0===F.compareEndPoints("EndToEnd",B)){break;}B.expand("sentence",1);I.push(F.duplicate());}for(;!1===j.inRange(I[0])&&0!=j.compareEndPoints("StartToStart",I[0]);){I[0].moveStart("word",1);}for(;!1===j.inRange(I[I.length-1])&&0!=j.compareEndPoints("EndToEnd",I[I.length-1]);){I[I.length-1].moveEnd("word",-1);}for(var O=0;O<I.length;O++){for(F="";I[O].inRange(y)&&0!=I[O].compareEndPoints("EndToEnd",y);){C++;o++;if(10000<o){break;}A?(y=j.duplicate(),y.findText(null[C-1])):(y.collapse(!1),y.expand("word",1));G=B="";K.collapse(!1);var N=y.duplicate();N.collapse(!1);if(0==K.compareEndPoints("StartToStart",N)&&0==K.compareEndPoints("EndToEnd",N)&&N.htmlText==K.htmlText){D++;if(2>D){y.move("character",1);}else{if(4>D){y.move("character",2);}else{if(6>D){y.move("word",1);}else{if(8>D){y.move("word",2);}else{if(10>D){y.move("sentence",1);}else{if(12>D){y.move("sentence",2);}else{break;}}}}}}y.collapse(!1);}else{D=0;if(-1===C){return y;}rspkr.HL.clientMarkup.selectedWordsRange[C]=y.duplicate();rspkr.HL.clientMarkup.wordsRangeClasses[C]="word";K=y.text;N=y.htmlText;y.collapse(!1);var J;1===E?(H=y.duplicate(),J=this.iterateParentTree(H.parentElement(),document.body,Q,0)):J=this.iterateParentTree(y.parentElement(),H.parentElement(),Q,0);for(var L=this.iterateParentTree(H.parentElement(),y.parentElement(),Q,0),M=y.parentElement(),P=0;P<J&&20>P;P++){M.className.match("sync_")||(B=M.outerHTML.match("<[^>]*>")[0]+B),M=M.parentElement;}M=H.parentElement();for(P=0;P<L&&20>P;P++){M.className.match("sync_")||(G+="</"+M.tagName+">"),M=M.parentElement;}if(0!=J||0!=L){H=y.duplicate();}1===E?(F+=B,E=0):F+=G+B;""!=N.replace("sync_sent_highlighted","")&&(F+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_word" id="sync'+C+'">'+K+"</"+rspkr.Common.data.browser.syncContainer+">");K=y.duplicate();}}C++;rspkr.HL.clientMarkup.selectedWordsRange[C]=I[O];rspkr.HL.clientMarkup.wordsRangeClasses[C]="sent";z+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_sent" id="sync'+C+'">';z+=F;z+="</"+rspkr.Common.data.browser.syncContainer+">\n";}L=this.iterateParentTree(H.parentElement(),document.body,Q,0);M=H.parentElement();for(P=0;P<L;P++){M.className.match("sync_")||(z+="</"+M.tagName+">"),M=M.parentElement;}y.collapse();return z;},iterateParentTree:function(f,h,k,j){for(var g=h;null!==g;){if(f==k||f==g){return j;}g=g.parentElement;}j++;return this.iterateParentTree(f.parentElement,h,k,j);}},postProcess:{lightCleanUp:function(){rspkr.log("[clientMarkup.postProcess.lightCleanUp] called!");for(var f=rspkr.Common.data.browser.syncContainer.replace(/(:|\.|\[|\]|,)/g,"\\$1"),l=$rs.get(f+".sync_sent,"+f+".sync_word,"+f+".sync_sent_highlighted,"+f+".sync_word_highlighted,"+f+".sync_user,"+f+".synctemp,"+f+'[class*="ffsent"]'),l=$rs.isArray(l)?l:[l],f=l.length-1;-1<f;f--){l[f].className=l[f].className.replace("sync_sent_highlighted","sync_sent"),l[f].className=l[f].className.replace("sync_word_highlighted","sync_word"),-1===l[f].className.toLowerCase().indexOf("sync_user")&&(l[f].removeAttribute("id"),l[f].removeAttribute("color"));}var l=rspkr.HL.clientMarkup.previousWord.range,n=rspkr.HL.clientMarkup.previousWord.forecolor,m=rspkr.HL.clientMarkup.previousWord.backcolor,j=rspkr.HL.clientMarkup.previousSent.range,q=rspkr.HL.clientMarkup.previousSent.forecolor,p=rspkr.HL.clientMarkup.previousSent.backcolor;if(0<l.length){for(var f=0,o=l.length;f<o;f++){null!==m[f]&&(l[f].execCommand("backcolor",0,m[f]),null!==n[f]&&l[f]&&l[f].execCommand("forecolor",0,n[f]));}}if(0<j.length){for(f=0,o=j.length;f<o;f++){null!==p[f]&&(j[f].execCommand("backcolor",0,p[f]),null!==q[f]&&j[f]&&j[f].execCommand("forecolor",0,q[f]));}}rspkr.hl.clientMarkup.lastWord=null;},settingsCleanUp:function(){this.lightCleanUp();},fullCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.fullCleanUp] called!");if(null===rspkr.hl.clientMarkup.originalParent){this.lightCleanUp();}else{var b=rspkr.hl.clientMarkup.originalParent;rspkr.hl.Preserve.moveToShelter(b);b.innerHTML=rspkr.hl.clientMarkup.originalParentContent;rspkr.hl.Preserve.restoreFromShelter(b);}rspkr.hl.clientMarkup.selectedWordsRange=[];rspkr.hl.clientMarkup.selectionRange=null;rspkr.hl.clientMarkup.originalParentContent="";rspkr.hl.clientMarkup.originalParent=null;rspkr.hl.clientMarkup.lastWord=null;}},sync:function(f,h){var l=!1,j;0===(f&2)&&(l=0!=(f&1)?!0:!1);1===this.firstRun&&(this.previousWord.range=[],this.previousWord.backcolor=[],this.previousWord.forecolor=[],this.previousSent.range=[],this.previousSent.backcolor=[],this.previousSent.forecolor=[]);j=this.selectedWordsRange[h];if(1===this.firstRun){this.firstRun=0;if(0<this.previousSent.range.length){for(var g=0,m=this.previousSent.range.length;g<m;g++){this.previousSent.range[g].execCommand("backcolor",0,this.previousSent.backcolor[g]),null!==this.previousSent.forecolor[g]&&this.previousSent.range[g].execCommand("forecolor",0,this.previousSent.forecolor[g]);}this.previousSent.range=[];this.previousSent.backcolor=[];this.previousSent.forecolor=[];}rspkr.HL.clientMarkup.selectionRange&&"wordsent"===rspkr.st.get("hl")&&(this.previousSent.range.push(rspkr.HL.clientMarkup.selectionRange),this.previousSent.backcolor.push(rspkr.HL.clientMarkup.selectionRange.queryCommandValue("backcolor")),this.previousSent.forecolor.push(rspkr.HL.clientMarkup.selectionRange.queryCommandValue("forecolor")),this.selectionRange.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.selectionRange.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext")));}if(!l&&0<this.previousWord.range.length){for(g=0;g<this.previousWord.range.length;g++){"word"==rspkr.st.get("hl")||"sent"==rspkr.st.get("hl")?this.previousWord.range[g].execCommand("backcolor",0,this.previousWord.backcolor[g]):this.previousWord.range[g].execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.previousWord.range[g].execCommand("forecolor",0,this.previousWord.forecolor[g]);}this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[];}this.previousWord.backcolor.push(j.queryCommandValue("backcolor"));this.previousWord.forecolor.push(j.queryCommandValue("forecolor"));this.previousWord.range.push(j);"sent"==rspkr.st.get("hl")?(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.sentHL(j,f),j.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent"))):(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.wordHL(j,f),j.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword")));this.lastWord=j;rspkr.HL.customHL&&rspkr.HL.customHL.active();j.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"));},syncNew:function(b,f){var h=!1;0===(b&2)&&(h=0!=(b&1)?!0:!1);1===this.firstRun&&(this.previousWord.range=[],this.previousWord.backcolor=[],this.previousWord.forecolor=[],this.previousSent.range=[],this.previousSent.backcolor=[],this.previousSent.forecolor=[],this.firstRun=0);var g=this.selectedWordsRange[f];if(g&&"word"===this.wordsRangeClasses[f]&&("word"==rspkr.st.get("hl")||"wordsent"==rspkr.st.get("hl"))){if(0<this.previousWord.range.length&&!h){for(h=0;h<this.previousWord.range.length;h++){"word"==rspkr.st.get("hl")||"sent"==rspkr.st.get("hl")?this.previousWord.range[h].execCommand("backcolor",0,this.previousWord.backcolor[h]):this.previousWord.range[h].execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.previousWord.range[h].execCommand("forecolor",0,this.previousWord.forecolor[h]);}this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[];}this.previousWord.backcolor.push(g.queryCommandValue("backcolor"));this.previousWord.forecolor.push(g.queryCommandValue("forecolor"));this.previousWord.range.push(g);g.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword"));this.lastWord=g;g.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"));}else{if(g&&"sent"===this.wordsRangeClasses[f]&&("sent"==rspkr.st.get("hl")||"wordsent"==rspkr.st.get("hl"))){if(0<this.previousWord.range.length){for(h=0;h<this.previousWord.range.length;h++){this.previousWord.range[h].execCommand("backcolor",0,this.previousWord.backcolor[h]),this.previousWord.range[h].execCommand("forecolor",0,this.previousWord.forecolor[h]);}this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[];}if(0<this.previousSent.range.length){for(h=0;h<this.previousSent.range.length;h++){this.previousSent.range[h].execCommand("backcolor",0,this.previousSent.backcolor[h]),this.previousSent.range[h].execCommand("forecolor",0,this.previousSent.forecolor[h]);}this.previousSent.range=[];this.previousSent.backcolor=[];this.previousSent.forecolor=[];}this.previousSent.backcolor.push(g.queryCommandValue("backcolor"));this.previousSent.forecolor.push(g.queryCommandValue("forecolor"));this.previousSent.range.push(g);g.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent"));g.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"));}}}}};}();rspkr.HL.engine.gecko=function(){return{clientExtension:{preProcess:{bookMarkIndex:1,endNode:null,endOffset:null,excludednodes:"table tr select option textarea ul ol dl thead tbody tfoot colgroup script map optgroup style noscript".split(" "),firstRun:0,inc:0,numberOfSelections:0,startNode:null,startOffset:null,init:function(){this.numberOfSelections++;var b="",b=rspkr.Common.data.selectedRange;this.startNode=b.startContainer;this.endNode=b.endContainer;this.startOffset=this.modifyOffsetStartOfWord(this.startNode,b.startOffset);this.endOffset=this.modifyOffsetEndOfWord(this.endNode,b.endOffset);b=this.buildMarkup(b.commonAncestorContainer);b.replace(/  +/g," ");window.getSelection().removeAllRanges();rspkr.Common.data.selectedHTML=b;},buildMarkup:function(f){this.firstRun=1;var h="",l=this.inc;if(3==f.nodeType){h+=this.textMarkup(f);}else{var j,g="";if(f.hasChildNodes()){for(j=0;j<f.childNodes.length;j++){var m=f.childNodes.item(j);m==this.startNode&&(this.inc=1);f==this.startNode&&j==this.startOffset&&(this.inc=1);8!=m.nodeType&&(g+=this.buildMarkup(m));if(f==this.endNode&&j==this.endOffset){this.inc=0;break;}if(m==this.endNode){this.inc=0;break;}}}(l||this.inc)&&(!f.className||f.className.replace("sync")===f.className&&$rs.getAttr(f,"id")&&$rs.getAttr(f,"id").replace("sync")===$rs.getAttr(f,"id"))?(l=document.createElement("div"),l.appendChild(f.cloneNode(!0)),tempdivtag=l.innerHTML.match("<[^>]*>"),null!==tempdivtag&&0<tempdivtag.length?(h+=tempdivtag[0],h=h+g+("</"+f.nodeName+">")):h+=g):h+=g;if(f.hasChildNodes()){for(j=0;j<f.childNodes.length;j++){if(f===this.endNode&&j===this.endOffset){this.inc=0;break;}if(m===this.endNode){this.inc=0;break;}}}}return h;},textMarkup:function(f){var l=!0,n="",m,j="",q="",p=f.nodeValue;f===this.startNode&&-1!==this.startOffset&&f===this.endNode&&-1!==this.endOffset?(j=f.nodeValue.substring(0,this.startOffset),p=f.nodeValue.substring(this.startOffset,this.endOffset),q=f.nodeValue.substring(this.endOffset),this.inc=1):f===this.startNode&&-1!==this.startOffset?(j=f.nodeValue.substring(0,this.startOffset),p=f.nodeValue.substring(this.startOffset),this.inc=1):f===this.endNode&&-1!==this.endOffset&&(p=f.nodeValue.substring(0,this.endOffset),q=f.nodeValue.substring(this.endOffset),this.inc=1);if(!this.inc){return"";}for(m=0;m<this.excludednodes.length;m++){if(f.parentNode&&f.parentNode.nodeName.toLowerCase()===this.excludednodes[m]){l=!1;n=this.htmlencode(p);break;}}l&&(n=!(n=rspkr.cfg.item("general.selectionEngine"))||"new"!==n&&"newcontent"!==n?this.markupSentences(this.htmlencode(p),null):this.markupSentencesNew(this.htmlencode(p),null));f===this.endNode&&-1!==this.endOffset&&(this.inc=0);if(rs.cfg.item("general.enableSkipAlways")){m=f;for(var o=!1;m.parentNode;){if(/rs_skip_always/i.test(m.className)){o=!0;break;}m=m.parentNode;}o&&(n='<span class="rs_skip_always">'+n+"</span>");}l&&null!==f.parentNode&&""!==p&&(l=this.createreplacementnode(j+n+q,getComputedStyle(f.parentNode,null)),f.parentNode.insertBefore(l,f),f.parentNode.removeChild(f));return n;},markupSentencesNew:function(f){f=this.splitString(f,[", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")]);if(!f){return"";}for(var h="",k="",j=!1,g=0;g<f.length;g++){h+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_sent cj'+this.numberOfSelections+'" ',h+='id="sync'+this.bookMarkIndex+++'">',this.endsWithSpace(f[g])?(j=!0,k=f[g].slice(0,-1)):k=f[g],h+=this.markupWords(k),h+="</"+rspkr.Common.data.browser.syncContainer+">",!0===j&&(h+=" "),j=!1;}return h;},markupSentences:function(f){f=this.splitString(f,[", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")]);if(!f){return"";}for(var h="",k="",j=!1,g=0;g<f.length;g++){h+="<"+rspkr.Common.data.browser.syncContainer+' class="ffsent'+this.numberOfSelections+" cj"+this.numberOfSelections+'" ',h+='id="sync'+this.bookMarkIndex+++'">',this.endsWithSpace(f[g])?(j=!0,k=f[g].slice(0,-1)):k=f[g],h+=this.markupWords(k),!0===j&&(h+=" "),h+="</"+rspkr.Common.data.browser.syncContainer+">",j=!1;}return h;},markupWords:function(f){f=this.splitString(f," ");if(!f){return"";}for(var h="",k="",j=!1,g=0;g<f.length;g++){h+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_word ck'+this.numberOfSelections+'"',h+=' id="sync'+this.bookMarkIndex+++'">',this.endsWithSpace(f[g])?(j=!0,k=f[g].slice(0,-1)):k=f[g],h+=k,h+="</"+rspkr.Common.data.browser.syncContainer+">",!0===j&&(h+=" "),j=!1;}return h;},trim:function(b){return b.replace(/^\s+|\s+$/g,"");},htmlencode:function(b){var d=document.createElement("div");b=document.createTextNode(b);d.appendChild(b);return d.innerHTML;},identifyElementsReplacementNode:function(b){b.tagName&&b.tagName.toLowerCase()==rspkr.Common.data.browser.syncContainer&&b.id&&(rspkr.HL.clientMarkup.selectedWordsRange[b.id]=b);if(b.hasChildNodes()){for(var d=0;d<b.childNodes.length;d++){this.identifyElementsReplacementNode(b.childNodes[d]);}}},createreplacementnode:function(b){var d=document.createElement(rspkr.Common.data.browser.syncContainer);d.innerHTML=b;d.setAttribute("class","synctemp cl"+this.numberOfSelections);return d;},modifyOffsetStartOfWord:function(b,f){for(var h=[" ",", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")];b.nodeValue&&0!=f;){for(var g=0;g<h.length;g++){if(breakstr=h[g],0==b.nodeValue.substring(f).indexOf(breakstr)){return f;}}f--;}return f;},modifyOffsetEndOfWord:function(b,f){for(var h=[" ",", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")];b.nodeValue&&f!=b.nodeValue.length;){for(var g=0;g<h.length;g++){if(breakstr=h[g],0==b.nodeValue.substring(f-1).indexOf(breakstr)){return f;}}f++;}return f;},returnClassArraySubstring:function(b){b=$rs.get("."+b);return $rs.isArray(b)?b:[b];},splitString:function(j,m){for(var o=[""],n=0,l=0;l<j.length;l++){for(var s=0;s<m.length;s++){for(var r=m[s],q=!0,p=0;p<r.length;p++){if(0>j.length-(l+p)||r[r.length-p-1]!=j[l-p-1]){q=!1;break;}}q&&(n++,o[n]="");}o[n]+=j[l];}return o;},endsWithSpace:function(b){return -1!==b.indexOf(" ",b.length-1);}},postProcess:{cleanUpSpans:function(){rspkr.log("[ClientMarkup.postProcess.cleanUpSpans] called!");var b=rspkr.Common.data.browser.syncContainer.replace(/(:|\.|\[|\]|,)/g,"\\$1"),b=$rs.get(b+".sync_sent,"+b+".sync_word,"+b+".sync_sent_highlighted,"+b+".sync_word_highlighted,"+b+".sync_user,"+b+".synctemp,"+b+'[class*="ffsent"]'),d,b=$rs.isArray(b)?b:[b];for(i=b.length-1;-1<i;i--){d=document.createDocumentFragment(),d.textContent=b[i].textContent,b[i].parentNode.replaceChild(d,b[i]);}},lightCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.lightCleanUp] called!!");var b=rspkr.Common.data.browser.syncContainer.replace(/(:|\.|\[|\]|,)/g,"\\$1"),b=$rs.get(b+".sync_sent,"+b+".sync_word,"+b+".sync_sent_highlighted,"+b+".sync_word_highlighted,"+b+".sync_user,"+b+".synctemp,"+b+'[class*="ffsent"]'),b=$rs.isArray(b)?b:[b];for(i=b.length-1;-1<i;i--){rspkr.HL.chunking.continueHref||(b[i].className=b[i].className.replace("sync_sent_highlighted","sync_sent")),b[i].className=b[i].className.replace("sync_word_highlighted","sync_word"),!rspkr.HL.chunking.continueHref&&-1===b[i].className.toLowerCase().indexOf("sync_user")&&b[i].removeAttribute("id");}},settingsCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.settingsCleanUp] called!");var f=rspkr.HL.clientMarkup.previousWord.element,h=rspkr.HL.clientMarkup.previousWord.className,k=rspkr.HL.clientMarkup.previousSent.element,j=rspkr.HL.clientMarkup.previousSent.className;if(0<f.length){for(var g in f){f[g].className=h[g];}rspkr.HL.clientMarkup.previousWord.element=[];rspkr.HL.clientMarkup.previousWord.className=[];}if(0<k.length){for(g in k){k[g].className=j[g];}rspkr.HL.clientMarkup.previousSent.element=[];rspkr.HL.clientMarkup.previousSent.className=[];}},fullCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.fullCleanUp] called!");var f=rspkr.HL.clientMarkup.previousWord.element,h=rspkr.HL.clientMarkup.previousWord.className,k=rspkr.HL.clientMarkup.previousSent.element,j=rspkr.HL.clientMarkup.previousSent.className;if(0<f.length){for(var g in f){f[g].className=h[g];}rspkr.HL.clientMarkup.previousWord.element=[];rspkr.HL.clientMarkup.previousWord.className=[];}if(0<k.length){for(g in k){k[g].className=j[g];}rspkr.HL.clientMarkup.previousSent.element=[];rspkr.HL.clientMarkup.previousSent.className=[];}this.cleanUpSpans();rspkr.Common.data.selectedHTML="";}},sync:function(b,f){var h=!1,g;0==(b&2)&&(h=0!=(b&1)?!0:!1);1==this.firstRun&&(this.previousWord.element=[],this.previousWord.className=[],this.previousSent.element=[],this.previousSent.className=[]);g=this.selectedWordsRange["sync"+f];if(g.className.replace("word","")!=g.className){rspkr.log("inside");if(0<this.previousWord.element.length&&0<this.previousWord.className.length&&!h){for(h=0;h<this.previousWord.element.length;h++){this.previousWord.element[h].className=this.previousWord.className[h];}this.previousWord.element=[];this.previousWord.className=[];}this.previousWord.element.push(g);this.previousWord.className.push(g.className);"sent"===rspkr.st.get("hl")?g.className=g.className.replace("sync_sent","sync_user sync_sent_highlighted"):(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.wordHL(g,b),g.className=g.className.replace("sync_word","sync_user sync_word_highlighted"));}g&&rspkr.HL.Scroll.execScroll(g);if(1==this.firstRun){this.firstRun=0;if(0<this.previousSent.element.length){for(h=0;h<this.previousSent.element.length;h++){this.previousSent.element[h].className=this.previousSent.className[h];}this.previousSent.element=[];this.previousSent.className=[];}if("wordsent"==rspkr.st.get("hl")){for(g=this.preProcess.returnClassArraySubstring("ffsent"+this.preProcess.numberOfSelections+" "),h=0;h<g.length;h++){this.previousSent.element[h]=g[h],this.previousSent.className[h]=g[h].className,g[h].className="ffsent"+this.preProcess.numberOfSelections+" sync_sent_highlighted";}}}},syncNew:function(b,f){var h;1==this.firstRun&&(this.previousWord.element=[],this.previousWord.className=[],this.previousSent.element=[],this.previousSent.className=[],this.firstRun=0);h=document.getElementById("sync"+f);if(h.className.replace("word","")!=h.className&&("word"===rspkr.st.get("hl")||"wordsent"===rspkr.st.get("hl"))){if(0<this.previousWord.element.length&&0<this.previousWord.className.length){for(var g=0;g<this.previousWord.element.length;g++){this.previousWord.element[g].className=this.previousWord.className[g];}this.previousWord.element=[];this.previousWord.className=[];}this.previousWord.element.push(h);this.previousWord.className.push(h.className);h.className="sync_user sync_word_highlighted";}else{if(h.className.replace("sent","")!=h.className&&("sent"===rspkr.st.get("hl")||"wordsent"===rspkr.st.get("hl"))){if(0<this.previousSent.element.length&&0<this.previousSent.className.length){for(g=0;g<this.previousSent.element.length;g++){this.previousSent.element[g].className=this.previousSent.className[g];}this.previousSent.element=[];this.previousSent.className=[];}this.previousSent.element.push(h);this.previousSent.className.push(h.className);h.className=h.className.replace("sync_sent","sync_user sync_sent_highlighted");}}h&&rspkr.HL.Scroll.execScroll(h);}}};}();