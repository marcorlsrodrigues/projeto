ReadSpeaker.Common.Settings=function(){var a={form:{key:"data-rsform-key",prev:"data-rsform-prev",valyes:"data-rsform-trueval",valno:"data-rsform-falseval"}},d={},c=function(f){return rspkr.Common.cookie.readKey(rspkr.pub.Config.item("general.cookieName"),f)||rspkr.pub.Config.item("settings."+f);},e=function(f,g){var i=c(f);if(g!=i){var h=rspkr.c.cookie.updateKey(rspkr.cfg.item("general.cookieName"),f,g);rspkr.cfg.item("settings."+f,g);rspkr.devt("onSettingsChanged",window,[f,g,i]);return h;}return null;},b={controls:{xp:function(f){return rspkr.st.r().expandPhrase(f);},helpButton:'<img src="'+rspkr.baseUrl+'img/help.png" alt="" border="0" />',select:function(g,i,m,j){var l=[],n="hl"!==g?!1:rspkr.cfg.isSentOnly&&rspkr.cfg.isSentOnly(rspkr.c.data.params.lang);l.push('<label for="',j,'">',this.xp(i.phrase),"</label>");l.push('<select id="',j,'" name="',j,'" ',a.form.prev,'="',m,'" ',a.form.key,'="',g,'">');for(var o=0,p=i.options.length;o<p;o++){"hl"===g&&n&&!/\bsent|none/i.test(i.options[o].value)||("hl"===g&&n&&"sent"===i.options[o].value&&"none"!==m&&(m="sent"),l.push('<option value="',i.options[o].value,'"',m==i.options[o].value?' selected="selected"':"",i.options[o].dims?' data-rsform-dims="'+i.options[o].dims.join(",")+'"':"",i.options[o].hides?' data-rsform-hides="'+i.options[o].hides.join(",")+'"':"",">",this.xp(i.options[o].phrase),"</option>"));}l.push("</select>");i.info&&(l.push('<button type="button" id="rstoggle_',j,'" class="rsform-info-toggle" data-rsform-toggles="rscontainer_',j,'" title="',this.xp("ph_help"),": ",this.xp(i.phrase),'">'+this.helpButton+"</button>"),l.push("&rlm;"),l.push('<div id="rscontainer_',j,'" class="rsform-info-container" aria-live="polite">',this.xp(i.info),"</div>"),rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.info,context:rspkr.st.r().handlers,params:[j]}));rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.select,context:rspkr.st.r().handlers,params:[j]});return l.join("");},checkbox:function(f,g,j,h){var i=j==g.options.truevalue;rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.checkbox,context:rspkr.st.r().handlers,params:[h]});return['<label for="'+h+'">',this.xp(g.phrase),'</label><input type="checkbox" id="',h,'" name="',h,'"',i?' checked="checked"':"",a.form.valyes,'="',g.options.truevalue,'" ',a.form.valno,'="',g.options.falsevalue,'" ',a.form.prev,'="',j,'" ',a.form.key,'="',f,'" />'].join("");},radio:function(g,i,l,j){var k=[];k.push('<fieldset class="rsform-radio-label" aria-level="2">');k.push("<legend>",this.xp(i.phrase));i.info&&(k.push('<button id="rstoggle_',j,'" type="button" class="rsform-info-toggle" data-rsform-toggles="rscontainer_',j,'" title="',this.xp("ph_help"),": ",this.xp(i.phrase),'">'+this.helpButton+"</button>"),k.push("&rlm;"));k.push("</legend>");for(var m=0,n=i.options.length;m<n;m++){k.push('<input type="radio" id="',j,"_",m,'" name="',j,'" title="',this.xp(i.phrase),": ",this.xp(i.options[m].phrase),'" value="',i.options[m].value,'"'),k.push(" ",a.form.prev,'="',l,'" ',a.form.key,'="',g,'"'),k.push(l==i.options[m].value?' checked="checked"':""),i.options[m].dims&&k.push(' data-rsform-dims="',i.options[m].dims.join(","),'"'),k.push(" />"),k.push("&lrm;"),k.push('<label for="',j,"_",m,'">',this.xp(i.options[m].phrase),"</label>");}i.info&&(k.push('<div id="rscontainer_',j,'" class="rsform-info-container" aria-live="polite">',this.xp(i.info),"</div>"),rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.info,context:rspkr.st.r().handlers,params:[j]}));k.push("</fieldset>");rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.radio,context:rspkr.st.r().handlers,params:[j,m]});return k.join("");},info:function(f,g){return['<div class="rsform-infotext">',this.xp(g.phrase),"</div>"].join("");},slider_h:function(f,g,i,h){rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.slider_h,context:rspkr.st.r().handlers,params:[g,h,i]});d[h]=g;return['<span class="rsform-slider-label">',this.xp(g.phrase),'</span><div id="',h,'" class="rsform-slider rsimg" ',a.form.key,'="',f,'" ',a.form.prev,'="',i,'"></div>'].join("");},colorpicker:function(g,h,k,i){var j=[];j.push('<fieldset class="rsform-colorlist-label" aria-level="2">');j.push("<legend>",this.xp(h.phrase));h.info&&(j.push('<button type="button" id="rstoggle_',i,'" class="rsform-info-toggle" data-rsform-toggles="rscontainer_',i,'" title="',this.xp("ph_help"),": ",this.xp(h.phrase),'">'+this.helpButton+"</button>"),j.push("&rlm;"));j.push("</legend>");j.push('<ul id="',i,'" class="rsform-colorlist" ',a.form.prev,'="',k,'" ',a.form.key,'="',g,'">');g=0;for(var l=h.options.length;g<l;g++){j.push("<li",k==h.options[g].value?' class="rsform-colorlist-active"':"",">");j.push('<a href="javascript: void(0);"');j.push(k==h.options[g].value?' tabIndex="0"':' tabIndex="-1"');j.push(' title="'+this.xp(h.phrase)+": "+this.xp(h.options[g].phrase)+'"');j.push(' data-rsform-value="',h.options[g].value,'"');if("underline"==h.options[g].value||"none"==h.options[g].value){j.push(' class="'),"underline"==h.options[g].value&&j.push("rsform-colorlist-style-underline "),"none"==h.options[g].value&&j.push("rsform-colorlist-style-none "),j.push('"');}j.push(' role="button"');j.push('><span class="rsform-colorlist-box"');"#"==h.options[g].value.substr(0,1)&&j.push(' style="background: ',h.options[g].value,';"');j.push("></span>");j.push('<span class="rsform-colorlist-label');"underline"==h.options[g].value?j.push('" style="text-decoration: underline;'):/#/.test(h.options[g].value)&&j.push(" rsform-colorlist-style-color");j.push('">',this.xp(h.options[g].phrase),"</span></a>");j.push("</li>");}j.push("</ul>");j.push('<div style="clear: both;"></div>');h.info&&(j.push('<div id="rscontainer_',i,'" class="rsform-info-container" aria-live="polite">',this.xp(h.info),"</div>"),rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.info,context:rspkr.st.r().handlers,params:[i]}));j.push("</fieldset>");rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.colorpicker,context:rspkr.st.r().handlers,params:[i]});return j.join("");},restore:function(f,g,i,h){rspkr.evt("onSettingsLoaded",{func:rspkr.st.r().handlers.restore,context:rspkr.st.r().handlers,params:[h]});return["<div>",this.xp(g.phrase),'</div><input type="button" id="',h,'" value="',this.xp("ph_"+f),'" class="rsform-button" role="button"></input>'].join("");}},handlers:{info:function(f){$rs.regEvent($rs.get("#rstoggle_"+f),"click",this.changed.info);},select:function(f){$rs.regEvent($rs.get("#"+f),"change",this.changed.select);},checkbox:function(f){$rs.regEvent($rs.get("#"+f),"click",this.changed.checkbox);},radio:function(f,g){for(var h=0;h<g;h++){$rs.regEvent($rs.get("#"+f+"_"+h),"click",this.changed.radio);}},slider_h:function(g,h,k){var i=new ReadSpeaker.ui.Slider,j={};if(g.options){for(var l in g.options){g.options.hasOwnProperty(l)&&(j[l]=rspkr.st.r().expandPhrase(g.options[l]));}}j.initval=g.converter?g.converter(k):k||0;j.start=function(){};j.drop=this.changed.slider_h;i.init($rs.get("#"+h),j);},colorpicker:function(f){$rs.regEvent("#"+f+" li a","keydown",function(g){var i=$rs.closest(this,"li"),h;37==g.keyCode?h=i.previousSibling:39==g.keyCode&&(h=i.nextSibling);h&&(g=$rs.findIn(h,"a"),g.focus(),g.click());});$rs.regEvent("#"+f+" li a","click",this.changed.colorpicker);$rs.css($rs.get("#"+f),"display","block");},restore:function(f){$rs.regEvent("#"+f,"click",function(){if(rs.cfg.defaultsettings){for(var g in rs.cfg.defaultsettings){if(rs.cfg.defaultsettings.hasOwnProperty(g)){var j=rs.cfg.defaultsettings[g];rspkr.st.r().handlers.updateSetting(g,j);var h=$rs.get("input[value="+j+"]");if($rs.isArray(h)){if(h=$rs.get("select[data-rsform-key="+g+"]"),$rs.isArray(h)){if(h=$rs.get("ul[data-rsform-key="+g+"]"),!$rs.isArray(h)){var i=$rs.findIn(h,".rsform-colorlist-active");$rs.removeClass(i,"rsform-colorlist-active");j=$rs.findIn(h,"a[data-rsform-value="+j+"]").parentNode;$rs.addClass(j,"rsform-colorlist-active");}}else{h.value=j;}}else{h.checked=!0;}}}rspkr.Common.Settings.r().handlers.changed.afterdim();}});},changed:{dimmed:[],hidden:[],disable:function(f,g){g=g||"dimmed";var j=$rs.findIn(f,"input, select, textarea, ul.rsform-colorlist");$rs.addClass(f,g);if("dimmed"==g){for(var h=0,i=j.length;h<i;h++){"ul"!=j[h].tagName.toLowerCase()&&(j[h].disabled=!0);}}},enable:function(f,g){g=g||"dimmed";var j=$rs.findIn(f,"input, select, textarea");$rs.removeClass(f,g);if("dimmed"==g){for(var h=0,i=j.length;h<i;h++){j[h].disabled=!1;}}},add:function(g,h,k,i){g[h]||(g[h]=[]);for(var j=0,l=k.length;j<l;j++){this.disable($rs.get("#rscontrol_"+k[j]),i),g[h].push($rs.get("#rscontrol_"+k[j]));}},release:function(f,g,j){if(f[g]){for(var h=0,i=f[g].length;h<i;h++){this.enable(f[g][h],j);}f[g]=[];}},dim:function(f,g){this.undim(f);this.add(this.dimmed,f,$rs.isArray(g)?g:[g],"dimmed");},undim:function(f){this.release(this.dimmed,f,"dimmed");},afterdim:function(){for(var f=$rs.get("#rslightbox_content .rsform-row"),g,i=0,h=f.length;i<h;i++){g=$rs.getAttr(f[i],"data-rsform-type"),g=this.dimmees[g]?this.dimmees[g](f[i]):null,"string"==typeof g?this.dim(f[i].id.replace("rscontrol_",""),g.split(",")):1===g&&this.undim(f[i].id.replace("rscontrol_",""));}},addButtonEvents:function(f){$rs.regEvent($rs.get("#rslightbox_buttons .rssettings-button-close"),"click",f.hide);},dimmees:{radio:function(f){f=$rs.findIn(f,"input[type=radio]");for(var g,j=!1,h=0,i=f.length;h<i;h++){if(f[h].checked){g=f[h];break;}}g&&(j=$rs.getAttr(g,"data-rsform-dims")||1);return j;},select:function(f){f=$rs.findIn(f,"option");for(var g,j=!1,h=0,i=f.length;h<i;h++){if(f[h].selected){g=f[h];break;}}g&&(j=$rs.getAttr(g,"data-rsform-dims")||1);return j;}},info:function(f){$rs.hasClass(f.target.parentNode,"dimmed")||$rs.hasClass(f.target.parentNode.parentNode,"dimmed")||(f=$rs.get("#"+$rs.getAttr(this,"data-rsform-toggles")),$rs.css(f,"display","none"==$rs.css(f,"display")?"block":"none"));return !1;},select:function(){this.value!==$rs.getAttr(this,a.form.prev)&&rspkr.st.r().handlers.updateSetting.apply(rspkr.st.r().handlers,[$rs.getAttr(this,a.form.key),this.value,this]);return !0;},checkbox:function(){var f=this.checked?$rs.getAttr(this,a.form.valyes):$rs.getAttr(this,a.form.valno);f!==$rs.getAttr(this,a.form.prev)&&rspkr.st.r().handlers.updateSetting.apply(rspkr.st.r().handlers,[$rs.getAttr(this,a.form.key),f,this]);return !0;},radio:function(){this.value!==$rs.getAttr(this,a.form.prev)&&(rspkr.st.r().handlers.updateSetting.apply(rspkr.st.r().handlers,[$rs.getAttr(this,a.form.key),this.value,this]),$rs.setAttr($rs.findIn(this.parentNode,"input[name="+this.name+"]"),a.form.prev,this.value));return !0;},slider_h:function(f,g){var j=g.parent,h=d[g.rsid],h=h.converter?h.converter(parseInt(f)):parseInt(f),i=$rs.getAttr(j,a.form.prev);h!==i&&rspkr.st.r().handlers.updateSetting.apply(rspkr.st.r().handlers,[$rs.getAttr(j,a.form.key),h,j]);},colorpicker:function(f){f.originalEvent&&f.originalEvent.preventDefault&&f.originalEvent.preventDefault();var g=f.target.parentNode.parentNode,i=f.target.parentNode;if(!$rs.hasClass(f.target.parentNode.parentNode.parentNode,"dimmed")&&$rs.getAttr(f.target,"data-rsform-value")!==$rs.getAttr(g,a.form.prev)){$rs.removeClass($rs.findIn(g,"li"),"rsform-colorlist-active");rspkr.st.r().handlers.updateSetting.apply(rspkr.st.r().handlers,[$rs.getAttr(g,a.form.key),$rs.getAttr(f.target,"data-rsform-value"),g]);$rs.addClass(i,"rsform-colorlist-active");for(var g=$rs.findIn(g,"a"),i=0,h;h=g[i];i++){$rs.setAttr(h,"tabIndex","-1");}$rs.setAttr(f.target,"tabIndex",0);}}},updateSetting:function(f,g,i){rspkr.log("[rspkr.st] Setting updated: "+f+" | New value: "+g);e(f,g);if(i){f=$rs.closest(i,".rsform-row");var h=$rs.css(f,"background-color");rspkr.u.hl(f,function(){$rs.css(this,"background-color",h);});$rs.setAttr($rs.get(i),a.form.prev,g);}}},expandPhrase:function(f){if("string"==typeof f&&"ph_"==f.substr(0,3)){f=f.substr(3);var g=rspkr.cfg.getPhrase(f);return void 0!==g?g:f;}return f;},row:function(g,h,k){if(/hlword|hltoggle/i.test(g)&&rspkr.cfg.isSentOnly&&rspkr.cfg.isSentOnly(rspkr.c.data.params.lang)){return"";}var i=rspkr.cfg.item("ui.settings.formrow").join("\n"),j={},l=ReadSpeaker.getID();k=this.controls[h.type](g,h,k,l);j.rsCONTROL_IDrs=g;j.rsCONTROLrs=k;j.rsCONTROL_TYPErs=h.type;j.rsCONTROL_CLASSESrs=h.classes?h.classes.join(" "):"";return this.replaceTokens(i,j);},group:function(f){var g=rspkr.cfg.item("ui.settings.formsection").join("\n"),j={},h=[],i;for(i in f.items){f.items.hasOwnProperty(i)&&h.push(this.row(i,f.items[i],c(i)));}j.rsSECTION_IDrs=ReadSpeaker.getID();j.rsSECTION_HEADINGrs=this.controls.xp(f.phrase);j.rsSECTION_ROWSrs=h.join("\n");return this.replaceTokens(g,j);},replaceTokens:function(f,g){var i=f,h;for(h in g){g.hasOwnProperty(h)&&(i=i.replace(RegExp(h,"igm"),g[h]));}return i;}};return{meta:{revision:"3975"},r:function(){return b;},e:a,init:function(){for(var f=["ReadSpeakerHL","ReadSpeakerHLicon","ReadSpeakerHLspeed"],g="",j=!1,h=0,i=f.length;h<i;h++){if(g=rspkr.Common.cookie.read(f[h])){rspkr.Common.cookie.updateKey(rspkr.pub.Config.item("general.cookieName"),f[h].substr(11).toLowerCase(),g),j=!0;}rspkr.Common.cookie.erase(f[h]);}j&&rspkr.log("[rspkr.st] Transferred legacy cookie.");rspkr.Common.dispatchEvent("onSettingsInitialized");rspkr.log("[rspkr.st] Initialized!");rspkr.Common.addEvent("onSettingsLoaded",{func:rspkr.Common.Settings.r().handlers.changed.afterdim,context:rspkr.Common.Settings.r().handlers.changed,params:[]});rspkr.Common.addEvent("onSettingsChanged",{func:rspkr.Common.Settings.r().handlers.changed.afterdim,context:rspkr.Common.Settings.r().handlers.changed,params:[]});},get:function(f){return c(f);},getAll:function(){return rspkr.Common.cookie.readKeyAll(rspkr.pub.Config.item("general.cookieName"));},set:function(f,g){return e(f,g);},getHTML:function(){var g=rspkr.cfg,h=[],k=g.item("ui.settings.form").join("\n"),i={},j=g.getSettingsConf(),l;for(l in j){j.hasOwnProperty(l)&&h.push(b.group(j[l]));}j="";rspkr.ui.getActivePlayer()&&rspkr.cfg.item("ui.listenBtn")&&(j=document.createElement("div"),j.innerHTML=g.item("ui.listenBtn").join(""),g=rspkr.ui.getActivePlayer().getHref(),g=g.replace(/readid=[^&]+/gi,"readid=rslightbox_content"),g=g.replace(/&url=[^&]+/gi,""),$rs.setAttr($rs.findIn(j,".rsbtn_play"),"href",g),j=b.replaceTokens(j.innerHTML,{rsLISTENrs:b.controls.xp("ph_listen")}));i.rsSETTINGS_HEADINGrs=b.controls.xp("ph_settings");i.rsLISTEN_BUTTONrs=rs.cfg.item("ui.settingsListenButton")&&"rsbtn"===rs.ui.rsbtnClass?j:"";i.rsSECTIONS_STARTrs="";i.rsSECTIONSrs=h.join("");i.rsSECTIONS_ENDrs="";return b.replaceTokens(k,i);},getButtons:function(){var f=rspkr.cfg.item("ui.settings.formbuttons").join("\n"),g={};g.rsSETTINGS_BUTTON_CLOSErs=b.controls.xp("ph_close");return b.replaceTokens(f,g);}};}();