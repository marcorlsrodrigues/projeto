ReadSpeaker.PlayerAPI=function(){var f={audioFormat:"flv",minver:8,check:function(){return rspkr.c.data.browser.flashVersion.split(",").shift()>=this.minver?!0:!1;}},g={prioritize:!1,audioFormat:null,check:function(){return rspkr.c.data.browser.html5Support?(this.audioFormat=rspkr.c.data.browser.html5AudioFormat,this.prioritize=rspkr.c.data.browser.html5Priority,!0):!1;}},h="",i=function(d,e){for(var k in e){d[k]=e[k];}},j={meta:{revision:"3975"},init:function(){rspkr.log("[rspkr.pl] Initialized!");rspkr.Common.addEvent("onModsLoaded",function(){rspkr.Common.Detect.init();rspkr.PlayerAPI.setAdapter();});},setAdapter:function(){h=g.check()&&f.check()?g.prioritize?"html5":"flash":g.check()?"html5":f.check()?"flash":"fallback";"html5"==h?(rspkr.log("[rspkr.pl] Using adapter "+h,1),i(j,rspkr.pl.html5.adapter)):"flash"==h?(rspkr.log("[rspkr.pl] Using adapter "+h,1),i(j,rspkr.pl.flash.adapter)):(rspkr.log("[rspkr.pl] No adapter detected - using fallback!",3),i(j,rspkr.pl.fallback.adapter));},getProduct:function(){return ReadSpeaker.HL?ReadSpeaker.HL:ReadSpeaker.XP?ReadSpeaker.XP:!1;}};return j;}();ReadSpeaker.PlayerAPI.flash=function(){return{init:function(){ReadSpeaker.log("PlayerAPI.flash heartbeat!");},adapter:{adapter:"flash",playerRef:null,timerCallBack:null,timerContext:null,loadTimer:null,progressStarted:!1,networkCheckCounter:0,play:function(){if(this.playerRef){try{this.playerRef.rs_player_play(),rspkr.devt("onAPIPlay",window);}catch(b){ReadSpeaker.log("error: "+b);}}else{this.initAdapter();}},pause:function(){if(rspkr.pl.playerRef){try{this.playerRef.rs_player_pause(),rspkr.devt("onAPIPause",window);}catch(b){rspkr.log("error: "+b,3);}}},stop:function(){if(rspkr.pl.playerRef){try{this.playerRef.rs_player_stop(),rspkr.devt("onAPIStop",window);}catch(b){rspkr.log("error: "+b,3);}}},volUp:function(){rspkr.pl.playerRef&&(this.playerRef.rs_player_volup(),rspkr.devt("onAPIVolumeUp",window));},volDown:function(){rspkr.pl.playerRef&&(this.playerRef.rs_player_voldown(),rspkr.devt("onAPIVolumeDown",window));},mute:function(){rspkr.pl.playerRef&&(this.playerRef.rs_player_mute(),rspkr.devt("onAPIMute",window));},forward:function(){rspkr.pl.playerRef&&(this.playerRef.rs_player_jumpff(),rspkr.devt("onAPIFastForward",window));},rewind:function(){rspkr.pl.playerRef&&(this.playerRef.rs_player_jumpbb(),rspkr.devt("onAPIRewind",window));},setVolume:function(b){rspkr.log("[setVolume]",4);rspkr.pl.playerRef&&(this.playerRef.setVolume?(this.playerRef.setVolume(b),rspkr.devt("onAPISetVolume",window)):window.setTimeout(function(){rspkr.pl.setVolume(b);},10));},setProgress:function(c){if(rspkr.pl.playerRef){try{this.playerRef.setProgress(c),rspkr.devt("onAPISetProgress",window);}catch(d){}}},getProgress:function(d,e,f){rspkr.pl.playerRef&&(this.timerCallBack=e,this.timerContext=f||e,rspkr.pl.playerRef&&"function"==typeof rspkr.pl.playerRef.getProgress?(clearTimeout(this.loadTimer),rspkr.pl.playerRef.getProgress(d,"rspkr.pl.timer",500),this.progressStarted=!0):this.progressStarted||(this.loadTimer=window.setTimeout(function(){rspkr.pl.getProgress(d,e,f);},500)),rspkr.devt("onAPIGetProgress",window));},timer:function(c){c=c.split("|");if("function"==typeof this.timerCallBack){try{this.timerCallBack.apply(this.timerContext,[c]);}catch(d){}}},checkNetworkStatus:function(){3<rspkr.pl.networkCheckCounter||setTimeout(function(){if(rspkr.pl.playerRef){rspkr.pl.networkCheckCounter++;try{rspkr.log("[rspkr.pl.checkNetworkStatus] "+rspkr.pl.playerRef.rs_player_networkStatus(),1);}catch(b){rs.pl.checkNetworkStatus();return;}3===rspkr.pl.playerRef.rs_player_networkStatus()?(rspkr.log("[rspkr.pl] Cannot load audio!",3),rspkr.ui.showOverlay("loaderror"),rspkr.devt("onAudioLoadError",window)):0===rs.PlayerAPI.playerRef.rs_player_networkStatus()&&rs.pl.checkNetworkStatus();}},rspkr.cfg.item("general.audioTimeout")||750);},initAdapter:function(){var d=encodeURIComponent(rspkr.c.data.getAudioLink({audioformat:"flv"}));this.progressStarted=!1;this.releaseAdapter();var e=document.getElementById("rs_player_holder");e||(e=document.createElement("div"),$rs.setAttr(e,"id","rs_player_holder"),document.body.appendChild(e));d=['<object id="readspeaker_flash_player" '+(document.selection?'classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"':'type="application/x-shockwave-flash" data="'+ReadSpeaker.pub.Config.item("flash.flashSrc")+"?flv="+d+'&autoplay=1" ')+'style="height: 1px; width: 1px;">','<param name="movie" value="'+rspkr.cfg.item("flash.flashSrc")+"?flv="+d+'&autoplay=1" />','<param name="quality" value="high" />','<param name="autostart" value="true" />','<param name="allowScriptAccess" value="'+rspkr.cfg.item("flash.allowScriptAccess")+'" />','<param name="loop" value="false" /></object>'];e.innerHTML=d.join("\n");$rs.setAttr(e,"style","position: fixed; bottom: 0px; right: 0px;");var f=function(b){4===b&&rspkr.pl.playerRef&&rspkr.pl.playerRef.setVolume&&(rspkr.pl.playerRef.setVolume(rspkr.st.get("hlvol")||"100"),document.attachEvent?$rs.get("#readspeaker_flash_player").detachEvent("onreadystatechange",f):document.addEventListener&&$rs.get("#readspeaker_flash_player").removeEventListener("load",function(){f(4);},!1));};document.attachEvent?($rs.get("#readspeaker_flash_player").attachEvent("onreadystatechange",f),rspkr.devt("onVolumeAdjusted",window)):document.addEventListener&&$rs.get("#readspeaker_flash_player").addEventListener("load",function(){f(4);},!1);rspkr.pl.playerRef=document.getElementById("readspeaker_flash_player");rspkr.devt("onAPIInitAdapter",window);rspkr.pl.checkNetworkStatus();},releaseAdapter:function(){if(rspkr.pl.playerRef){try{rspkr.pl.playerRef.rs_player_stop(),rspkr.devt("onAPIStop",window);}catch(c){ReadSpeaker.log("error: "+c);}var d=$rs.get("#rs_player_holder");d.removeChild(rspkr.pl.playerRef);document.body.removeChild(d);rspkr.pl.playerRef=null;rspkr.devt("onAPIReleaseAdapter",window);}},reloadAdapter:function(){this.initAdapter();rspkr.devt("onAPIReloadAdapter",window);}}};}();ReadSpeaker.PlayerAPI.html5=function(){return{init:function(){ReadSpeaker.log("PlayerAPI.html5 heartbeat!");},adapter:{adapter:"html5",playerRef:null,timerCallBack:null,timerContext:null,bufferedTime:null,play:function(){ReadSpeaker.log("[rspkr.pl.play]");rspkr.HL.chunking&&rspkr.HL.chunking.close();rspkr.HL.chunking&&rspkr.HL.chunking.chunkEnded?(rspkr.HL.chunking.chunkEnded=!1,rspkr.c.dispatchEvent("onChunkResume",window)):this.playerRef?(this.playerRef.play(),rspkr.devt("onAPIPlay",window)):this.initAdapter();},pause:function(){this.playerRef&&(rspkr.pl.playerRef.pause(),rspkr.devt("onAPIPause",window));},stop:function(){rspkr.pl.playerRef&&(rspkr.pl.playerRef.pause(),0<rspkr.pl.playerRef.readyState&&(rspkr.pl.playerRef.currentTime=0),rspkr.devt("onAPIStop",window));},volUp:function(){this.playerRef&&(this.playerRef.volume=Math.min(1,this.playerRef.volume+0.2),rspkr.st.set("hlvol",100*this.playerRef.volume),rspkr.devt("onAPIVolumeUp",window));},volDown:function(){this.playerRef&&(this.playerRef.volume=Math.max(0,this.playerRef.volume-0.2),rspkr.st.set("hlvol",100*this.playerRef.volume),rspkr.devt("onAPIVolumeDown",window));},mute:function(){this.playerRef&&(this.playerRef.volume=0,rspkr.devt("onAPIMute",window));},forward:function(){this.playerRef&&(this.playerRef.currentTime=this.playerRef.currentTime+5<this.playerRef.duration?this.playerRef.currentTime+5:this.playerRef.duration,rspkr.devt("onAPIFastForward",window));},rewind:function(){this.playerRef&&(this.playerRef.currentTime=0<this.playerRef.currentTime-5?this.playerRef.currentTime-5:0,rspkr.devt("onAPIRewind",window));},setVolume:function(b){rspkr.log("[setVolume] "+b,4);this.playerRef&&(this.playerRef.volume=parseFloat(b/100),rspkr.devt("onAPISetVolume",window));},setProgress:function(c){if(this.playerRef){c=parseInt(c);var d=parseInt(ReadSpeaker.PlayerAPI.getProduct().html5.handlers.totalTime());this.playerRef.currentTime=c<d&&c<this.playerRef.duration?c:this.playerRef.duration;rspkr.HL&&rspkr.HL.html5&&rspkr.HL.html5.lastcurrenttime&&(rspkr.HL.html5.lastcurrenttime=0);rspkr.devt("onAPISetProgress",window);}},getProgress:function(d,e,f){this.playerRef&&(0==d?rspkr.pl.playerRef.removeEventListener("timeupdate",rspkr.pl.timer,!1):(this.timerCallBack=e,this.timerContext=f||e,rspkr.pl.playerRef.addEventListener("timeupdate",rspkr.pl.timer,!1),rspkr.devt("onAPIGetProgress",window)));},timer:function(){if(rspkr.pl.playerRef){var e=1000*parseInt(rspkr.pl.playerRef.currentTime);rspkr.pl.bufferedTime=1000*parseInt(ReadSpeaker.PlayerAPI.getProduct().html5.handlers.totalTime());var f=[e,rspkr.pl.bufferedTime];if(rspkr.hl.html5&&rspkr.hl.html5.synclist&&rspkr.hl.html5.synclist[rspkr.hl.html5.synclist.length-1]){var g=rspkr.hl.html5.synclist[rspkr.hl.html5.synclist.length-1][0];rspkr.pl.bufferedTime>g&&(f=[e,g]);}if("function"==typeof rspkr.pl.timerCallBack){try{rspkr.pl.timerCallBack.apply(rspkr.pl.timerContext,[f]);}catch(h){rspkr.log("timeupdate error",2);}}}},checkNetworkStatus:function(){var b=rs.pl.playerRef;rs.pl.errorCount=rs.pl.errorCount||0;rs.pl.networkStates=rs.pl.networkStates||[0,0,0,0];setTimeout(function(){if(b){rs.pl.networkStates[b.networkState]++;rs.pl.networkStates[4]=b.buffered&&b.buffered.length&&0<b.buffered.end(0)?b.buffered.end(0):!1;rs.pl.networkStates[5]=b.duration&&b.duration&&!isNaN(b.duration)&&0<b.duration?b.duration:!1;if(3===b.networkState){rs.pl.errorCount++,10<rs.pl.errorCount&&!rs.pl.networkStates[4]&&!rs.pl.networkStates[5]?(rspkr.log("[rspkr.pl] Cannot load audio!",3),rspkr.ui.showOverlay("loaderror"),rspkr.devt("onAudioLoadError",window)):rspkr.pl.checkNetworkStatus();}else{if(2===b.networkState){rs.pl.errorCount=0;var a=0<b.buffered.length?b.buffered.end(b.buffered.length-1):0,d=b.duration||0;(0==d||a<d)&&rspkr.pl.checkNetworkStatus();}else{rs.pl.errorCount=0;}}rspkr.log(rs.pl.networkStates,5);}},rspkr.cfg.item("general.audioTimeout")||750);},initAdapter:function(){rspkr.devt("onAPIInitAdapter",window);},releaseAdapter:function(){if(rspkr.pl.playerRef){rspkr.pl.playerRef.pause();try{0<rspkr.pl.playerRef.readyState&&(rspkr.pl.playerRef.currentTime=0);}catch(b){}rspkr.pl.playerRef=null;rspkr.devt("onAPIReleaseAdapter",window);}},reloadAdapter:function(){this.releaseAdapter();this.initAdapter();rspkr.devt("onAPIReloadAdapter",window);}}};}();rspkr.PlayerAPI.fallback=function(){return{init:function(){ReadSpeaker.log("PlayerAPI.fallback heartbeat!");},adapter:{adapter:"fallback"}};}();