(function(a){var b="normal";var h;function c(){a("#ToolPanelContent").bind("panelReady",function(m,n){if(n==="print"||n==="save"||n==="email"||n==="emailalert"){g();}});j();g();}function g(){h=a("advanced-pane").is(":visible");if(!h){a(".evt-adv-options").addClass("collapsed");}else{a(".evt-adv-options").addClass("expanded");}k();var m=a("#DojoEditor textarea");if(m.length){m.epeditor({toolbarOptions:[["Bold","Italic","Underline","-","NumberedList","BulletedList","-","Outdent","Indent","-","Undo","Redo"]],height:"100px"});CKEDITOR.on("instanceReady",function(){setTimeout(function(){a(".button.primary-action").focus();},100);});}}function j(){a("#printEmailDialog input[name='FormatType']").live("click",function(m){if(this.value==="custom"){a("#customFormats").show();a(".customFormats-pane").show(b);}else{a(".customFormats-pane").hide(b);a("#customFormats").hide();}});a(".evt-adv-options").live("click",function(m){if(h){a(".evt-adv-options").addClass("collapsed").removeClass("expanded");a(".advanced-pane").hide(b);}else{a(".evt-adv-options").removeClass("collapsed").addClass("expanded");a(".advanced-pane").show(b);}h=!h;return false;});a("#printEmailDialog .cancel").live("click",function(m){a("#ToolPanelContent").trigger("panelClose",a(m.target).data("panel"));});a("#printEmailDialog .confirm button").live("click",function(m){m.preventDefault();a("#ToolPanelContent").trigger("panelClose",a("#printEmailDialog .cancel").data("panel"));});a("#printEmailDialog .mobile-continue").live("click",function(m){m.preventDefault();if(document.referrer){location.href=document.referrer;}else{history.back();}});a("#printEmailDialog input[type='submit']").live("click",function(m){l(m);});a("#printEmailDialog").live("keypress",function(m){if(m.which===13&&a(m.target).is("input")){l(m);}});a("#printEmailDialog select[name='IndustryFormat'], #printEmailDialog select[name='StandardFormat']").live("change",function(m){if(a(this).attr("name")==="StandardFormat"){a("input[name='FormatType'][value='standard']").trigger("click");}else{if(a(this).attr("name")==="IndustryFormat"){a("input[name='FormatType'][value='industry']").trigger("click");}}});}function l(q){if(a("#emailTrigger").length){d();q.preventDefault();}else{if(a("#submitEmailAlert").length){e();q.preventDefault();}else{var o=a("#printEmailDialog input[name='RecordId']");var n=ep.clientData.currentRecord;if(n&&n.Db&&n.Term&&n.Tag){var p=ep.utilities.buildRouteKey(n.Db,n.Term,n.Tag);var m=a("#printEmailDialog").data("form");m.action=m.action+"/"+ep.utilities.urlSafeEncodeBase64(p);if(o&&o.length>0){o.val(p);}}}}}function f(m){if(a(m).is(".mobile-content")){a("#printEmailDialog").html(m);a(".topnav").children().hide();}else{a("#printEmailDialog").append(m);}}function i(n){var m;if("email"===n){m='<div class="whiteout epmodal"><div class="confirm"><h2 class="panel-header color-p2"> '+ep.messages.err_sending_email+'</h2><p class="export-email-conf">'+ep.messages.your_message_may_not_contain_html_markup+'</p><button title="Close" class="button pref-save-btn primary-action close">'+ep.messages.Close+"</button></div></div>";}else{m='<div class="whiteout epmodal"><div class="confirm email-alert"><h2 class="panel-header color-p2"> '+ep.messages.alert_error+'</h2><button title="Close" class="button pref-save-btn primary-action close">'+ep.messages.ok+"</button></div></div>";}a("#printEmailDialog").append(m);}function d(){if(!a("form").validate().form()){return;}a("#printEmailDialog input[type='submit']").attr("disabled","disabled");var n="";if(a("#emailFolderItemIds").length>0){n=ep.utilities.buildAjaxRequestPath("delivery/sendfolderitememail");}else{n=ep.utilities.buildAjaxRequestPath("delivery/sendemail",ep.clientData.currentRecord);}var m=a("#printEmailDialog *").serialize();a.ajax({type:"POST",url:n,data:m,success:function(o){f(o);}}).fail(function(){i("email");a("#printEmailDialog").one("click","button.close",function(o){a(this).closest(".epmodal").hide();a("#printEmailDialog input[type='submit']").attr("disabled",false);return false;});});}function e(){if(!a("form").validate().form()){return;}a("#printEmailDialog input[type='submit']").attr("disabled","disabled");var m=jQuery("#printEmailDialog").data("alertdata");var n=ep.utilities.buildAjaxRequestPath("alert/SendAlertEmail",ep.clientData.currentRecord)+"&theAlertName="+m.theAlertName+"&theAlertType="+m.theAlertType+"&theAlertSearchString="+m.theAlertSearchString+"&theEmailAddress="+a("#email").val()+"&theAlertFrequency="+a("#alertFrequency").val();a.ajax({type:"POST",url:n,success:function(o){f(o);}}).fail(function(){i("emailAlert ");a("#printEmailDialog").one("click","button.close",function(o){a(this).closest(".epmodal").hide();a("#printEmailDialog input[type='submit']").attr("disabled",false);return false;});});}function k(){var m=a("form");m.data("validator",null);if(a("#emailTrigger").length){var n={};if(ep.messages&&ep.messages.field_required&&ep.messages.email_invalid_error){n={From:{required:ep.messages.field_required,email:ep.messages.email_invalid_error},To:{required:ep.messages.field_required,multiemail:ep.messages.email_invalid_error},Subject:{html:ep.messages.your_subject_may_not_contain_html_markup},Comments:{html:ep.messages.your_comments_may_not_contain_html_markup}};}m.validate({rules:{From:{required:true,email:true},To:{required:true,multiemail:true},Subject:{html:true},Comments:{html:true}},onfocusout:false,onsubmit:false,messages:n});}else{m.validate({rules:{email:{required:true,email:true}},messages:{email:{required:ep.messages.verify_email,email:ep.messages.verify_email}},onfocusout:false,onsubmit:false});}}a(c);})(jQuery);