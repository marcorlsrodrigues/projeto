(function(a){var j=null;var m=ep.clientData.rtacTimeout+5;var k="summary";var e=15;function b(){if(ep.clientData.rtacView){k=ep.clientData.rtacView;}var n=a("[data-rtac]");if(n.length){g(n);}a("#mainContentArea").delegate(".rtac-link","click",function(o){o.preventDefault();g(a(o.currentTarget));a(o.currentTarget).removeClass("rtac-link");});ep.subscribe("moreResultsLoaded",function(p){var o=p.find("[data-rtac]");if(o.length){g(o);}},true);}function g(p){var o=[];p.each(function(r,q){o.push(a(q).data("rtac"));});p.addClass("loading");var n=p.first().data("rtacerror");a.ajax({url:ep.utilities.buildAjaxRequestPath("RealTimeAvailability/"+k,k==="detail"?ep.clientData.currentRecord:null),type:"POST",data:ep.util.JSON.stringify({rtacData:o}),contentType:"application/json; charset=utf-8",context:p,timeout:m*1000,error:function(s,q,r){h(this,n,p);},statusCode:{204:function(s,q,r){h(this,n,p);}},success:function(q,r,s){if(s.status!==204){f(q,p);l(this);p.removeClass("loading");d(p);}}});}function d(n){n.each(function(){if(a(this).find(".rtac-empty").length){a(this).closest(".rtac.toggle-container").hide();}});}function f(o,p){var n=a("<div>").html(o).find("[id^='rtac_']");if(!n.length){d(p);return;}n.each(function(t,r){var s=a(r);var q=a("#"+s.attr("id"));if(q.length){q.removeClass("loading");q.first().html(s.html());}});}function h(n,o,p){n.removeClass("loading");if(o){n.replaceWith(o);}d(p);if(k==="detail"){l(n);}}function l(n){if(k==="summary"){a(n).each(a.proxy(function(q,o){var p=a(o).find("a.rtac-citation-link").first();if(p.length){p.click(a.proxy(i,this));}},this));}if(k==="detail"||k==="summary"){a(n).each(a.proxy(function(q,p){var o=a("#rtac_"+a(p).data("rtac").RecordAN);if(o.length){p=o;}a(p).click(a.proxy(c,this));},this));}a(".rtac.treelist-heading").on("click",function(o){o.preventDefault();a(this).toggleClass("expanded");});}function i(u){u.preventDefault();var p=a(u.target).parents(".result-list-record").find("a[id^='Result_']").first();var q=a(u.target).closest(".rtac, .rtac-item").prop("id");if(ep.clientData.isMobile){var r=a(u.target).closest(".record-info").find(".record-title a").prop("href");window.location.href=r.indexOf("#")!==-1?r:r+"#"+q;}else{if(p.length){var o=p.attr("onclick");if(o){try{if(o.startsWith("function")){o=o.substring(o.indexOf("{")+1,o.lastIndexOf("}"));}var n=o.substring(o.indexOf("(")+1,o.lastIndexOf(")")).split(",");for(var t=0;t<3;t++){n[t]=n[t].substring(n[t].indexOf("'")+1,n[t].lastIndexOf("'"));}n[1]=n[1]+"||scrollTo~~"+q;__doLinkPostBack(n[0],n[1],n[2]);}catch(s){p.onclick();}}}}return false;}function c(r){var n=a(r.target);var q=n.closest("[id^='rtac_']").first();var p=q.find("tbody").children();if(n.is("a.rtac-show-all")){r.preventDefault();p.not(".sel-rtac-first").toggle();}else{if(n.is("a.rtac-show-less")){r.preventDefault();var o=p.length;p.not(".sel-rtac-first").toggle();if(o>=e){q.scrollTo();}}}}a(b);})(jQuery);